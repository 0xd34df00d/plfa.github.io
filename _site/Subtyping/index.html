<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Subtyping: Records | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Subtyping: Records" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Subtyping/" />
<meta property="og:url" content="https://plfa.github.io/Subtyping/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Subtyping/","headline":"Subtyping: Records","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">The Book</a>
                <a class="page-link" href="/Announcements/">Announcements</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
                <a class="page-link" href="/Citing/">Citing</a>
                <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Subtyping: Records</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/More/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Subtyping.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Bisimulation/">Next</a>
    
</p>


  <div class="post-content">
      <pre class="Agda"><a id="134" class="Keyword">module</a> <a id="141" href="/Subtyping/" class="Module">plfa.part2.Subtyping</a> <a id="162" class="Keyword">where</a>
</pre>
<p>This chapter introduces <em>subtyping</em>, a concept that plays an important
role in object-oriented languages. Subtyping enables code to be more
reusable by allowing it to work on objects of many different
types. Thus, subtyping provides a kind of polymorphism. In general, a
type <code class="language-plaintext highlighter-rouge">A</code> can be a subtype of another type <code class="language-plaintext highlighter-rouge">B</code>, written <code class="language-plaintext highlighter-rouge">A &lt;: B</code>, when
an object of type <code class="language-plaintext highlighter-rouge">A</code> has all the capabilities expected of something
of type <code class="language-plaintext highlighter-rouge">B</code>. Or put another way, a type <code class="language-plaintext highlighter-rouge">A</code> can be a subtype of type
<code class="language-plaintext highlighter-rouge">B</code> when it is safe to substitute something of type <code class="language-plaintext highlighter-rouge">A</code> into code that
expects something of type <code class="language-plaintext highlighter-rouge">B</code>.  This is know as the <em>Liskov
Substitution Principle</em>. Given this semantic meaning of subtyping, a
subtype relation should always be reflexive and transitive. When
<code class="language-plaintext highlighter-rouge">A</code> is a subtype of <code class="language-plaintext highlighter-rouge">B</code>, that is, <code class="language-plaintext highlighter-rouge">A &lt;: B</code>, we may also refer to
<code class="language-plaintext highlighter-rouge">B</code> as a supertype of <code class="language-plaintext highlighter-rouge">A</code>.</p>

<p>To formulate a type system for a language with subtyping, one simply
adds the <em>subsumption rule</em>, which states that a term of type <code class="language-plaintext highlighter-rouge">A</code>
can also have type <code class="language-plaintext highlighter-rouge">B</code> if <code class="language-plaintext highlighter-rouge">A</code> is a subtype of <code class="language-plaintext highlighter-rouge">B</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>⊢&lt;: : ∀{Γ M A B}
  → Γ ⊢ M ⦂ A
→ A &lt;: B
    -----------
  → Γ ⊢ M ⦂ B
</code></pre></div></div>

<p>In this chapter we study subtyping in the relatively simple context of
records and record types.  A <em>record</em> is a grouping of named values,
called <em>fields</em>. For example, one could represent a point on the
Cartesian plane with the following record.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ x = 4, y = 1 }
</code></pre></div></div>

<p>A <em>record type</em> gives a type for each field. In the following, we
specify that the fields <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> both have type <code class="language-plaintext highlighter-rouge">ℕ</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ x : `ℕ,  y : `ℕ }
</code></pre></div></div>

<p>One record type is a subtype of another if it has all of the fields of
the supertype and if the types of those fields are subtypes of the
corresponding fields in the supertype. So, for example, a point in
three dimensions is a subtype of a point in two dimensions.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ x : `ℕ,  y : `ℕ, z : `ℕ } &lt;: { x : `ℕ,  y : `ℕ }
</code></pre></div></div>

<p>The elimination form for records is field access (aka. projection),
written <code class="language-plaintext highlighter-rouge">M # l</code>, and whose dynamic semantics is defined by the
following reduction rule, which says that accessing the field <code class="language-plaintext highlighter-rouge">lⱼ</code>
returns the value stored at that field.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{l₁=v₁, ..., lⱼ=vⱼ, ..., lᵢ=vᵢ} # lⱼ —→  vⱼ
</code></pre></div></div>

<p>In this chapter we add records and record types to the simply typed
lambda calculus (STLC) and prove type safety. It is instructive to see
how the proof of type safety changes to handle subtyping.  Also, the
presence of subtyping makes the choice between extrinsic and intrinsic
typing more interesting by. If we wish to include the subsumption
rule, then we cannot use intrinsically typed terms, as intrinsic terms
only allow for syntax-directed rules, and subsumption is not syntax
directed.  A standard alternative to the subsumption rule is to
instead use subtyping in the typing rules for the elimination forms,
an approach called algorithmic typing. Here we choose to include the
subsumption rule and extrinsic typing, but we give an exercise at the
end of the chapter so the reader can explore algorithmic typing with
intrinsic terms.</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="3177" class="Keyword">open</a> <a id="3182" class="Keyword">import</a> <a id="3189" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="3200" class="Keyword">using</a> <a id="3206" class="Symbol">(</a><a id="3207" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#279" class="Datatype">⊥</a><a id="3208" class="Symbol">;</a> <a id="3210" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a><a id="3216" class="Symbol">)</a>
<a id="3218" class="Keyword">open</a> <a id="3223" class="Keyword">import</a> <a id="3230" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.Irrelevant.html" class="Module">Data.Empty.Irrelevant</a> <a id="3252" class="Keyword">renaming</a> <a id="3261" class="Symbol">(</a><a id="3262" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.Irrelevant.html#327" class="Function">⊥-elim</a> <a id="3269" class="Symbol">to</a> <a id="3272" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.Irrelevant.html#327" class="Function">⊥-elimi</a><a id="3279" class="Symbol">)</a>
<a id="3281" class="Keyword">open</a> <a id="3286" class="Keyword">import</a> <a id="3293" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.html" class="Module">Data.Fin</a> <a id="3302" class="Keyword">using</a> <a id="3308" class="Symbol">(</a><a id="3309" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a><a id="3312" class="Symbol">;</a> <a id="3314" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="3318" class="Symbol">;</a> <a id="3320" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a><a id="3323" class="Symbol">)</a>
<a id="3325" class="Keyword">open</a> <a id="3330" class="Keyword">import</a> <a id="3337" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.html" class="Module">Data.Nat</a> <a id="3346" class="Keyword">using</a> <a id="3352" class="Symbol">(</a><a id="3353" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="3354" class="Symbol">;</a> <a id="3356" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="3360" class="Symbol">;</a> <a id="3362" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="3365" class="Symbol">;</a> <a id="3367" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#895" class="Datatype Operator">_≤_</a><a id="3370" class="Symbol">;</a> <a id="3372" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#918" class="InductiveConstructor">z≤n</a><a id="3375" class="Symbol">;</a> <a id="3377" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#960" class="InductiveConstructor">s≤s</a><a id="3380" class="Symbol">;</a> <a id="3382" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#1005" class="Function Operator">_&lt;_</a><a id="3385" class="Symbol">;</a> <a id="3387" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">_+_</a><a id="3390" class="Symbol">)</a>
<a id="3392" class="Keyword">open</a> <a id="3397" class="Keyword">import</a> <a id="3404" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>
    <a id="3428" class="Keyword">using</a> <a id="3434" class="Symbol">(</a><a id="3435" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#15115" class="Function">m+n≤o⇒m≤o</a><a id="3444" class="Symbol">;</a> <a id="3446" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#15250" class="Function">m+n≤o⇒n≤o</a><a id="3455" class="Symbol">;</a> <a id="3457" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#6284" class="Function">n≤0⇒n≡0</a><a id="3464" class="Symbol">;</a> <a id="3466" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3355" class="Function">≤-pred</a><a id="3472" class="Symbol">;</a> <a id="3474" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3632" class="Function">≤-refl</a><a id="3480" class="Symbol">;</a> <a id="3482" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3815" class="Function">≤-trans</a><a id="3489" class="Symbol">;</a> <a id="3491" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#14955" class="Function">m≤m+n</a><a id="3496" class="Symbol">;</a> <a id="3498" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#59581" class="Function">n≤m+n</a><a id="3503" class="Symbol">)</a>
<a id="3505" class="Keyword">open</a> <a id="3510" class="Keyword">import</a> <a id="3517" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="3530" class="Keyword">using</a> <a id="3536" class="Symbol">(</a><a id="3537" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_×_</a><a id="3540" class="Symbol">;</a> <a id="3542" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a><a id="3547" class="Symbol">;</a> <a id="3549" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a><a id="3554" class="Symbol">;</a> <a id="3556" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ-syntax</a><a id="3564" class="Symbol">)</a> <a id="3566" class="Keyword">renaming</a> <a id="3575" class="Symbol">(</a><a id="3576" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="3580" class="Symbol">to</a> <a id="3583" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="3588" class="Symbol">)</a>
<a id="3590" class="Keyword">open</a> <a id="3595" class="Keyword">import</a> <a id="3602" href="https://agda.github.io/agda-stdlib/v1.1/Data.String.html" class="Module">Data.String</a> <a id="3614" class="Keyword">using</a> <a id="3620" class="Symbol">(</a><a id="3621" href="Agda.Builtin.String.html#206" class="Postulate">String</a><a id="3627" class="Symbol">;</a> <a id="3629" href="https://agda.github.io/agda-stdlib/v1.1/Data.String.Properties.html#2569" class="Function Operator">_≟_</a><a id="3632" class="Symbol">)</a>
<a id="3634" class="Keyword">open</a> <a id="3639" class="Keyword">import</a> <a id="3646" href="https://agda.github.io/agda-stdlib/v1.1/Data.Unit.html" class="Module">Data.Unit</a> <a id="3656" class="Keyword">using</a> <a id="3662" class="Symbol">(</a><a id="3663" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="3664" class="Symbol">;</a> <a id="3666" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a><a id="3668" class="Symbol">)</a>
<a id="3670" class="Keyword">open</a> <a id="3675" class="Keyword">import</a> <a id="3682" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.html" class="Module">Data.Vec</a> <a id="3691" class="Keyword">using</a> <a id="3697" class="Symbol">(</a><a id="3698" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a><a id="3701" class="Symbol">;</a> <a id="3703" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a><a id="3705" class="Symbol">;</a> <a id="3707" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">_∷_</a><a id="3710" class="Symbol">;</a> <a id="3712" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a><a id="3718" class="Symbol">)</a>
<a id="3720" class="Keyword">open</a> <a id="3725" class="Keyword">import</a> <a id="3732" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Propositional.html" class="Module">Data.Vec.Membership.Propositional</a> <a id="3766" class="Keyword">using</a> <a id="3772" class="Symbol">(</a><a id="3773" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Setoid.html#824" class="Function Operator">_∈_</a><a id="3776" class="Symbol">)</a>
<a id="3778" class="Keyword">open</a> <a id="3783" class="Keyword">import</a> <a id="3790" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.DecPropositional.html" class="Module">Data.Vec.Membership.DecPropositional</a> <a id="3827" href="https://agda.github.io/agda-stdlib/v1.1/Data.String.Properties.html#2569" class="Function Operator">_≟_</a> <a id="3831" class="Keyword">using</a> <a id="3837" class="Symbol">(</a>_∈?_<a id="3842" class="Symbol">)</a>
<a id="3844" class="Keyword">open</a> <a id="3849" class="Keyword">import</a> <a id="3856" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Propositional.Properties.html" class="Module">Data.Vec.Membership.Propositional.Properties</a> <a id="3901" class="Keyword">using</a> <a id="3907" class="Symbol">(</a><a id="3908" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Propositional.Properties.html#1165" class="Function">∈-lookup</a><a id="3916" class="Symbol">)</a>
<a id="3918" class="Keyword">open</a> <a id="3923" class="Keyword">import</a> <a id="3930" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html" class="Module">Data.Vec.Relation.Unary.Any</a> <a id="3958" class="Keyword">using</a> <a id="3964" class="Symbol">(</a><a id="3965" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#991" class="InductiveConstructor">here</a><a id="3969" class="Symbol">;</a> <a id="3971" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#1058" class="InductiveConstructor">there</a><a id="3976" class="Symbol">)</a>
<a id="3978" class="Keyword">import</a> <a id="3985" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="4023" class="Symbol">as</a> <a id="4026" class="Module">Eq</a>
<a id="4029" class="Keyword">open</a> <a id="4034" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="4037" class="Keyword">using</a> <a id="4043" class="Symbol">(</a><a id="4044" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_≡_</a><a id="4047" class="Symbol">;</a> <a id="4049" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="4053" class="Symbol">;</a> <a id="4055" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="4058" class="Symbol">;</a> <a id="4060" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a><a id="4065" class="Symbol">;</a> <a id="4067" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="4071" class="Symbol">)</a>
<a id="4073" class="Keyword">open</a> <a id="4078" class="Keyword">import</a> <a id="4085" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="4102" class="Keyword">using</a> <a id="4108" class="Symbol">(</a><a id="4109" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="4112" class="Symbol">;</a> <a id="4114" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="4117" class="Symbol">;</a> <a id="4119" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="4121" class="Symbol">;</a> <a id="4123" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬_</a><a id="4125" class="Symbol">)</a>
</pre>
<h2 id="syntax">Syntax</h2>

<p>The syntax includes that of the STLC with a few additions regarding
records that we explain in the following sections.</p>

<pre class="Agda"><a id="4267" class="Keyword">infixl</a> <a id="4274" class="Number">5</a> <a id="4276" href="/Subtyping/#16512" class="InductiveConstructor Operator">_,_</a>
<a id="4280" class="Keyword">infix</a> <a id="4286" class="Number">4</a> <a id="4288" href="/Subtyping/#7073" class="Function Operator">_⊆_</a>
<a id="4292" class="Keyword">infix</a> <a id="4298" class="Number">5</a> <a id="4300" href="/Subtyping/#9216" class="Datatype Operator">_&lt;:_</a>
<a id="4305" class="Keyword">infix</a>  <a id="4312" class="Number">4</a> <a id="4314" href="/Subtyping/#18166" class="Datatype Operator">_⊢_⦂_</a>
<a id="4320" class="Keyword">infix</a> <a id="4326" class="Number">4</a> <a id="4328" href="/Subtyping/#18103" class="Datatype Operator">_⊢*_⦂_</a>
<a id="4335" class="Keyword">infix</a>  <a id="4342" class="Number">4</a> <a id="4344" href="/Subtyping/#16690" class="Datatype Operator">_∋_⦂_</a>
<a id="4350" class="Keyword">infix</a>  <a id="4357" class="Number">4</a> <a id="4359" href="/Subtyping/#25267" class="Datatype Operator">Canonical_⦂_</a>

<a id="4373" class="Keyword">infixr</a> <a id="4380" class="Number">7</a> <a id="4382" href="/Subtyping/#8387" class="InductiveConstructor Operator">_⇒_</a>

<a id="4387" class="Keyword">infix</a>  <a id="4394" class="Number">5</a> <a id="4396" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ_</a>
<a id="4399" class="Keyword">infix</a>  <a id="4406" class="Number">5</a> <a id="4408" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ_</a>
<a id="4411" class="Keyword">infixl</a> <a id="4418" class="Number">7</a> <a id="4420" href="/Subtyping/#17528" class="InductiveConstructor Operator">_·_</a>
<a id="4424" class="Keyword">infix</a>  <a id="4431" class="Number">8</a> <a id="4433" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc_</a>
<a id="4439" class="Keyword">infix</a>  <a id="4446" class="Number">9</a> <a id="4448" href="/Subtyping/#17450" class="InductiveConstructor Operator">`_</a>
<a id="4451" class="Keyword">infixl</a> <a id="4458" class="Number">7</a> <a id="4460" href="/Subtyping/#17820" class="InductiveConstructor Operator">_#_</a>
<a id="4464" class="Keyword">infix</a> <a id="4470" class="Number">5</a> <a id="4472" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛_⦂_｝</a>
<a id="4478" class="Keyword">infix</a> <a id="4484" class="Number">5</a> <a id="4486" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛_:=_｝</a>

<a id="4494" class="Keyword">infix</a> <a id="4500" class="Number">5</a> <a id="4502" href="/Subtyping/#22639" class="Function Operator">_[_]</a>
<a id="4507" class="Keyword">infix</a> <a id="4513" class="Number">2</a> <a id="4515" href="/Subtyping/#23491" class="Datatype Operator">_—→_</a>
</pre>
<h2 id="record-fields-and-their-properties">Record Fields and their Properties</h2>

<p>We represent field names as strings.</p>

<pre class="Agda"><a id="Name"></a><a id="4606" href="/Subtyping/#4606" class="Function">Name</a> <a id="4611" class="Symbol">:</a> <a id="4613" class="PrimitiveType">Set</a>
<a id="4617" href="/Subtyping/#4606" class="Function">Name</a> <a id="4622" class="Symbol">=</a> <a id="4624" href="Agda.Builtin.String.html#206" class="Postulate">String</a>
</pre>
<p>A record is traditionally written as follows</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ l₁ = M₁, ..., lᵢ = Mᵢ }
</code></pre></div></div>

<p>so a natural representation is a list of label-term pairs.
However, we find it more convenient to represent records as a pair of
vectors (Agda’s <code class="language-plaintext highlighter-rouge">Vec</code> type), one vector of fields and one vector of terms:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>l₁, ..., lᵢ
M₁, ..., Mᵢ
</code></pre></div></div>

<p>This representation has the advantage that the traditional subscript
notation <code class="language-plaintext highlighter-rouge">lᵢ</code> corresponds to indexing into a vector.</p>

<p>Likewise, a record type, traditionally written as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ l₁ : A₁, ..., lᵢ : Aᵢ }
</code></pre></div></div>

<p>will be represented as a pair of vectors, one vector of fields and one
vector of types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>l₁, ..., lᵢ
A₁, ..., Aᵢ
</code></pre></div></div>

<p>The field names of a record type must be distinct, which we define as
follows.</p>
<pre class="Agda"><a id="distinct"></a><a id="5361" href="/Subtyping/#5361" class="Function">distinct</a> <a id="5370" class="Symbol">:</a> <a id="5372" class="Symbol">∀{</a><a id="5374" href="/Subtyping/#5374" class="Bound">A</a> <a id="5376" class="Symbol">:</a> <a id="5378" class="PrimitiveType">Set</a><a id="5381" class="Symbol">}{</a><a id="5383" href="/Subtyping/#5383" class="Bound">n</a><a id="5384" class="Symbol">}</a> <a id="5386" class="Symbol">→</a> <a id="5388" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="5392" href="/Subtyping/#5374" class="Bound">A</a> <a id="5394" href="/Subtyping/#5383" class="Bound">n</a> <a id="5396" class="Symbol">→</a> <a id="5398" class="PrimitiveType">Set</a>
<a id="5402" href="/Subtyping/#5361" class="Function">distinct</a> <a id="5411" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="5414" class="Symbol">=</a> <a id="5416" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a>
<a id="5418" href="/Subtyping/#5361" class="Function">distinct</a> <a id="5427" class="Symbol">(</a><a id="5428" href="/Subtyping/#5428" class="Bound">x</a> <a id="5430" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="5432" href="/Subtyping/#5432" class="Bound">xs</a><a id="5434" class="Symbol">)</a> <a id="5436" class="Symbol">=</a> <a id="5438" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">¬</a> <a id="5440" class="Symbol">(</a><a id="5441" href="/Subtyping/#5428" class="Bound">x</a> <a id="5443" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Setoid.html#824" class="Function Operator">∈</a> <a id="5445" href="/Subtyping/#5432" class="Bound">xs</a><a id="5447" class="Symbol">)</a> <a id="5449" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">×</a> <a id="5451" href="/Subtyping/#5361" class="Function">distinct</a> <a id="5460" href="/Subtyping/#5432" class="Bound">xs</a>
</pre>
<p>For vectors of distinct elements, lookup is injective.</p>
<pre class="Agda"><a id="distinct-lookup-inj"></a><a id="5527" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="5547" class="Symbol">:</a> <a id="5549" class="Symbol">∀</a> <a id="5551" class="Symbol">{</a><a id="5552" href="/Subtyping/#5552" class="Bound">n</a><a id="5553" class="Symbol">}{</a><a id="5555" href="/Subtyping/#5555" class="Bound">ls</a> <a id="5558" class="Symbol">:</a> <a id="5560" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="5564" href="/Subtyping/#4606" class="Function">Name</a> <a id="5569" href="/Subtyping/#5552" class="Bound">n</a><a id="5570" class="Symbol">}{</a><a id="5572" href="/Subtyping/#5572" class="Bound">i</a> <a id="5574" href="/Subtyping/#5574" class="Bound">j</a> <a id="5576" class="Symbol">:</a> <a id="5578" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="5582" href="/Subtyping/#5552" class="Bound">n</a><a id="5583" class="Symbol">}</a>
   <a id="5588" class="Symbol">→</a> <a id="5590" href="/Subtyping/#5361" class="Function">distinct</a> <a id="5599" href="/Subtyping/#5555" class="Bound">ls</a>  <a id="5603" class="Symbol">→</a>  <a id="5606" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="5613" href="/Subtyping/#5555" class="Bound">ls</a> <a id="5616" href="/Subtyping/#5572" class="Bound">i</a> <a id="5618" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="5620" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="5627" href="/Subtyping/#5555" class="Bound">ls</a> <a id="5630" href="/Subtyping/#5574" class="Bound">j</a>
   <a id="5635" class="Symbol">→</a> <a id="5637" href="/Subtyping/#5572" class="Bound">i</a> <a id="5639" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="5641" href="/Subtyping/#5574" class="Bound">j</a>
<a id="5643" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="5663" class="Symbol">{</a><a id="5664" class="Argument">ls</a> <a id="5667" class="Symbol">=</a> <a id="5669" href="/Subtyping/#5669" class="Bound">x</a> <a id="5671" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="5673" href="/Subtyping/#5673" class="Bound">ls</a><a id="5675" class="Symbol">}</a> <a id="5677" class="Symbol">{</a><a id="5678" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="5682" class="Symbol">}</a> <a id="5684" class="Symbol">{</a><a id="5685" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="5689" class="Symbol">}</a> <a id="5691" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="5693" href="/Subtyping/#5693" class="Bound">x∉ls</a> <a id="5698" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5700" href="/Subtyping/#5700" class="Bound">dls</a> <a id="5704" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="5706" href="/Subtyping/#5706" class="Bound">lsij</a> <a id="5711" class="Symbol">=</a> <a id="5713" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="5718" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="5738" class="Symbol">{</a><a id="5739" class="Argument">ls</a> <a id="5742" class="Symbol">=</a> <a id="5744" href="/Subtyping/#5744" class="Bound">x</a> <a id="5746" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="5748" href="/Subtyping/#5748" class="Bound">ls</a><a id="5750" class="Symbol">}</a> <a id="5752" class="Symbol">{</a><a id="5753" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="5757" class="Symbol">}</a> <a id="5759" class="Symbol">{</a><a id="5760" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="5764" href="/Subtyping/#5764" class="Bound">j</a><a id="5765" class="Symbol">}</a> <a id="5767" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="5769" href="/Subtyping/#5769" class="Bound">x∉ls</a> <a id="5774" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5776" href="/Subtyping/#5776" class="Bound">dls</a> <a id="5780" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="5782" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="5787" class="Symbol">=</a>
    <a id="5793" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="5800" class="Symbol">(</a><a id="5801" href="/Subtyping/#5769" class="Bound">x∉ls</a> <a id="5806" class="Symbol">(</a><a id="5807" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Propositional.Properties.html#1165" class="Function">∈-lookup</a> <a id="5816" href="/Subtyping/#5764" class="Bound">j</a> <a id="5818" href="/Subtyping/#5748" class="Bound">ls</a><a id="5820" class="Symbol">))</a>
<a id="5823" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="5843" class="Symbol">{</a><a id="5844" class="Argument">ls</a> <a id="5847" class="Symbol">=</a> <a id="5849" href="/Subtyping/#5849" class="Bound">x</a> <a id="5851" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="5853" href="/Subtyping/#5853" class="Bound">ls</a><a id="5855" class="Symbol">}</a> <a id="5857" class="Symbol">{</a><a id="5858" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="5862" href="/Subtyping/#5862" class="Bound">i</a><a id="5863" class="Symbol">}</a> <a id="5865" class="Symbol">{</a><a id="5866" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="5870" class="Symbol">}</a> <a id="5872" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="5874" href="/Subtyping/#5874" class="Bound">x∉ls</a> <a id="5879" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5881" href="/Subtyping/#5881" class="Bound">dls</a> <a id="5885" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="5887" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="5892" class="Symbol">=</a>
    <a id="5898" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">⊥-elim</a> <a id="5905" class="Symbol">(</a><a id="5906" href="/Subtyping/#5874" class="Bound">x∉ls</a> <a id="5911" class="Symbol">(</a><a id="5912" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Propositional.Properties.html#1165" class="Function">∈-lookup</a> <a id="5921" href="/Subtyping/#5862" class="Bound">i</a> <a id="5923" href="/Subtyping/#5853" class="Bound">ls</a><a id="5925" class="Symbol">))</a>
<a id="5928" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="5948" class="Symbol">{</a><a id="5949" class="Argument">ls</a> <a id="5952" class="Symbol">=</a> <a id="5954" href="/Subtyping/#5954" class="Bound">x</a> <a id="5956" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="5958" href="/Subtyping/#5958" class="Bound">ls</a><a id="5960" class="Symbol">}</a> <a id="5962" class="Symbol">{</a><a id="5963" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="5967" href="/Subtyping/#5967" class="Bound">i</a><a id="5968" class="Symbol">}</a> <a id="5970" class="Symbol">{</a><a id="5971" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="5975" href="/Subtyping/#5975" class="Bound">j</a><a id="5976" class="Symbol">}</a> <a id="5978" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="5980" href="/Subtyping/#5980" class="Bound">x∉ls</a> <a id="5985" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="5987" href="/Subtyping/#5987" class="Bound">dls</a> <a id="5991" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="5993" href="/Subtyping/#5993" class="Bound">lsij</a> <a id="5998" class="Symbol">=</a>
    <a id="6004" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a> <a id="6009" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="6013" class="Symbol">(</a><a id="6014" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="6034" href="/Subtyping/#5987" class="Bound">dls</a> <a id="6038" href="/Subtyping/#5993" class="Bound">lsij</a><a id="6042" class="Symbol">)</a>
</pre>
<p>We shall need to convert from an irrelevant proof of distinctness to a
relevant one. In general, the laundering of irrelevant proofs into
relevant ones is easy to do when the predicate in question is
decidable. The following is a decision procedure for whether a vector
is distinct.</p>
<pre class="Agda"><a id="distinct?"></a><a id="6336" href="/Subtyping/#6336" class="Function">distinct?</a> <a id="6346" class="Symbol">:</a> <a id="6348" class="Symbol">∀{</a><a id="6350" href="/Subtyping/#6350" class="Bound">n</a><a id="6351" class="Symbol">}</a> <a id="6353" class="Symbol">→</a> <a id="6355" class="Symbol">(</a><a id="6356" href="/Subtyping/#6356" class="Bound">xs</a> <a id="6359" class="Symbol">:</a> <a id="6361" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="6365" href="/Subtyping/#4606" class="Function">Name</a> <a id="6370" href="/Subtyping/#6350" class="Bound">n</a><a id="6371" class="Symbol">)</a> <a id="6373" class="Symbol">→</a> <a id="6375" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a> <a id="6379" class="Symbol">(</a><a id="6380" href="/Subtyping/#5361" class="Function">distinct</a> <a id="6389" href="/Subtyping/#6356" class="Bound">xs</a><a id="6391" class="Symbol">)</a>
<a id="6393" href="/Subtyping/#6336" class="Function">distinct?</a> <a id="6403" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="6406" class="Symbol">=</a> <a id="6408" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="6412" href="Agda.Builtin.Unit.html#174" class="InductiveConstructor">tt</a>
<a id="6415" href="/Subtyping/#6336" class="Function">distinct?</a> <a id="6425" class="Symbol">(</a><a id="6426" href="/Subtyping/#6426" class="Bound">x</a> <a id="6428" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="6430" href="/Subtyping/#6430" class="Bound">xs</a><a id="6432" class="Symbol">)</a>
    <a id="6438" class="Keyword">with</a> <a id="6443" href="/Subtyping/#6426" class="Bound">x</a> <a id="6445" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.DecSetoid.html#834" class="Function Operator">∈?</a> <a id="6448" href="/Subtyping/#6430" class="Bound">xs</a>
<a id="6451" class="Symbol">...</a> <a id="6455" class="Symbol">|</a> <a id="6457" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="6461" href="/Subtyping/#6461" class="Bound">x∈xs</a> <a id="6466" class="Symbol">=</a> <a id="6468" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="6471" class="Symbol">λ</a> <a id="6473" href="/Subtyping/#6473" class="Bound">z</a> <a id="6475" class="Symbol">→</a> <a id="6477" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="6483" href="/Subtyping/#6473" class="Bound">z</a> <a id="6485" href="/Subtyping/#6461" class="Bound">x∈xs</a>
<a id="6490" class="Symbol">...</a> <a id="6494" class="Symbol">|</a> <a id="6496" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="6499" href="/Subtyping/#6499" class="Bound">x∉xs</a>
    <a id="6509" class="Keyword">with</a> <a id="6514" href="/Subtyping/#6336" class="Function">distinct?</a> <a id="6524" class="Bound">xs</a>
<a id="6527" class="Symbol">...</a> <a id="6531" class="Symbol">|</a> <a id="6533" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="6537" href="/Subtyping/#6537" class="Bound">dxs</a> <a id="6541" class="Symbol">=</a> <a id="6543" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="6547" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="6549" class="Bound">x∉xs</a> <a id="6555" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="6557" href="/Subtyping/#6537" class="Bound">dxs</a> <a id="6561" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="6563" class="Symbol">...</a> <a id="6567" class="Symbol">|</a> <a id="6569" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="6572" href="/Subtyping/#6572" class="Bound">¬dxs</a> <a id="6577" class="Symbol">=</a> <a id="6579" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="6582" class="Symbol">λ</a> <a id="6584" href="/Subtyping/#6584" class="Bound">x₁</a> <a id="6587" class="Symbol">→</a> <a id="6589" href="/Subtyping/#6572" class="Bound">¬dxs</a> <a id="6594" class="Symbol">(</a><a id="6595" href="Agda.Builtin.Sigma.html#237" class="Field">proj₂</a> <a id="6601" href="/Subtyping/#6584" class="Bound">x₁</a><a id="6603" class="Symbol">)</a>
</pre>
<p>With this decision procedure in hand, we define the following
function for laundering irrelevant proofs of distinctness into
relevant ones.</p>
<pre class="Agda"><a id="distinct-relevant"></a><a id="6754" href="/Subtyping/#6754" class="Function">distinct-relevant</a> <a id="6772" class="Symbol">:</a> <a id="6774" class="Symbol">∀</a> <a id="6776" class="Symbol">{</a><a id="6777" href="/Subtyping/#6777" class="Bound">n</a><a id="6778" class="Symbol">}{</a><a id="6780" href="/Subtyping/#6780" class="Bound">fs</a> <a id="6783" class="Symbol">:</a> <a id="6785" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="6789" href="/Subtyping/#4606" class="Function">Name</a> <a id="6794" href="/Subtyping/#6777" class="Bound">n</a><a id="6795" class="Symbol">}</a> <a id="6797" class="Symbol">.(</a><a id="6799" href="/Subtyping/#6799" class="Bound">d</a> <a id="6801" class="Symbol">:</a> <a id="6803" href="/Subtyping/#5361" class="Function">distinct</a> <a id="6812" href="/Subtyping/#6780" class="Bound">fs</a><a id="6814" class="Symbol">)</a> <a id="6816" class="Symbol">→</a> <a id="6818" href="/Subtyping/#5361" class="Function">distinct</a> <a id="6827" href="/Subtyping/#6780" class="Bound">fs</a>
<a id="6830" href="/Subtyping/#6754" class="Function">distinct-relevant</a> <a id="6848" class="Symbol">{</a><a id="6849" href="/Subtyping/#6849" class="Bound">n</a><a id="6850" class="Symbol">}{</a><a id="6852" href="/Subtyping/#6852" class="Bound">fs</a><a id="6854" class="Symbol">}</a> <a id="6856" href="/Subtyping/#6856" class="Bound">d</a>
    <a id="6862" class="Keyword">with</a> <a id="6867" href="/Subtyping/#6336" class="Function">distinct?</a> <a id="6877" href="/Subtyping/#6852" class="Bound">fs</a>
<a id="6880" class="Symbol">...</a> <a id="6884" class="Symbol">|</a> <a id="6886" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="6890" href="/Subtyping/#6890" class="Bound">dfs</a> <a id="6894" class="Symbol">=</a> <a id="6896" href="/Subtyping/#6890" class="Bound">dfs</a>
<a id="6900" class="Symbol">...</a> <a id="6904" class="Symbol">|</a> <a id="6906" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="6909" href="/Subtyping/#6909" class="Bound">¬dfs</a> <a id="6914" class="Symbol">=</a> <a id="6916" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.Irrelevant.html#327" class="Function">⊥-elimi</a> <a id="6924" class="Symbol">(</a><a id="6925" href="/Subtyping/#6909" class="Bound">¬dfs</a> <a id="6930" class="Bound">d</a><a id="6931" class="Symbol">)</a>
</pre>
<p>The fields of one record are a <em>subset</em> of the fields of another
record if every field of the first is also a field of the second.</p>
<pre class="Agda"><a id="_⊆_"></a><a id="7073" href="/Subtyping/#7073" class="Function Operator">_⊆_</a> <a id="7077" class="Symbol">:</a> <a id="7079" class="Symbol">∀{</a><a id="7081" href="/Subtyping/#7081" class="Bound">n</a> <a id="7083" href="/Subtyping/#7083" class="Bound">m</a><a id="7084" class="Symbol">}</a> <a id="7086" class="Symbol">→</a> <a id="7088" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7092" href="/Subtyping/#4606" class="Function">Name</a> <a id="7097" href="/Subtyping/#7081" class="Bound">n</a> <a id="7099" class="Symbol">→</a> <a id="7101" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7105" href="/Subtyping/#4606" class="Function">Name</a> <a id="7110" href="/Subtyping/#7083" class="Bound">m</a> <a id="7112" class="Symbol">→</a> <a id="7114" class="PrimitiveType">Set</a>
<a id="7118" href="/Subtyping/#7118" class="Bound">xs</a> <a id="7121" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="7123" href="/Subtyping/#7123" class="Bound">ys</a> <a id="7126" class="Symbol">=</a> <a id="7128" class="Symbol">(</a><a id="7129" href="/Subtyping/#7129" class="Bound">x</a> <a id="7131" class="Symbol">:</a> <a id="7133" href="/Subtyping/#4606" class="Function">Name</a><a id="7137" class="Symbol">)</a> <a id="7139" class="Symbol">→</a> <a id="7141" href="/Subtyping/#7129" class="Bound">x</a> <a id="7143" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Setoid.html#824" class="Function Operator">∈</a> <a id="7145" href="/Subtyping/#7118" class="Bound">xs</a> <a id="7148" class="Symbol">→</a> <a id="7150" href="/Subtyping/#7129" class="Bound">x</a> <a id="7152" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Setoid.html#824" class="Function Operator">∈</a> <a id="7154" href="/Subtyping/#7123" class="Bound">ys</a>
</pre>
<p>This subset relation is reflexive and transitive.</p>
<pre class="Agda"><a id="⊆-refl"></a><a id="7216" href="/Subtyping/#7216" class="Function">⊆-refl</a> <a id="7223" class="Symbol">:</a> <a id="7225" class="Symbol">∀{</a><a id="7227" href="/Subtyping/#7227" class="Bound">n</a><a id="7228" class="Symbol">}{</a><a id="7230" href="/Subtyping/#7230" class="Bound">ls</a> <a id="7233" class="Symbol">:</a> <a id="7235" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7239" href="/Subtyping/#4606" class="Function">Name</a> <a id="7244" href="/Subtyping/#7227" class="Bound">n</a><a id="7245" class="Symbol">}</a> <a id="7247" class="Symbol">→</a> <a id="7249" href="/Subtyping/#7230" class="Bound">ls</a> <a id="7252" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="7254" href="/Subtyping/#7230" class="Bound">ls</a>
<a id="7257" href="/Subtyping/#7216" class="Function">⊆-refl</a> <a id="7264" class="Symbol">{</a><a id="7265" href="/Subtyping/#7265" class="Bound">n</a><a id="7266" class="Symbol">}{</a><a id="7268" href="/Subtyping/#7268" class="Bound">ls</a><a id="7270" class="Symbol">}</a> <a id="7272" class="Symbol">=</a> <a id="7274" class="Symbol">λ</a> <a id="7276" href="/Subtyping/#7276" class="Bound">x</a> <a id="7278" href="/Subtyping/#7278" class="Bound">x∈ls</a> <a id="7283" class="Symbol">→</a> <a id="7285" href="/Subtyping/#7278" class="Bound">x∈ls</a>

<a id="⊆-trans"></a><a id="7291" href="/Subtyping/#7291" class="Function">⊆-trans</a> <a id="7299" class="Symbol">:</a> <a id="7301" class="Symbol">∀{</a><a id="7303" href="/Subtyping/#7303" class="Bound">l</a> <a id="7305" href="/Subtyping/#7305" class="Bound">n</a> <a id="7307" href="/Subtyping/#7307" class="Bound">m</a><a id="7308" class="Symbol">}{</a><a id="7310" href="/Subtyping/#7310" class="Bound">ns</a>  <a id="7314" class="Symbol">:</a> <a id="7316" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7320" href="/Subtyping/#4606" class="Function">Name</a> <a id="7325" href="/Subtyping/#7305" class="Bound">n</a><a id="7326" class="Symbol">}{</a><a id="7328" href="/Subtyping/#7328" class="Bound">ms</a>  <a id="7332" class="Symbol">:</a> <a id="7334" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7338" href="/Subtyping/#4606" class="Function">Name</a> <a id="7343" href="/Subtyping/#7307" class="Bound">m</a><a id="7344" class="Symbol">}{</a><a id="7346" href="/Subtyping/#7346" class="Bound">ls</a>  <a id="7350" class="Symbol">:</a> <a id="7352" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7356" href="/Subtyping/#4606" class="Function">Name</a> <a id="7361" href="/Subtyping/#7303" class="Bound">l</a><a id="7362" class="Symbol">}</a>
   <a id="7367" class="Symbol">→</a> <a id="7369" href="/Subtyping/#7310" class="Bound">ns</a> <a id="7372" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="7374" href="/Subtyping/#7328" class="Bound">ms</a>  <a id="7378" class="Symbol">→</a>  <a id="7381" href="/Subtyping/#7328" class="Bound">ms</a> <a id="7384" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="7386" href="/Subtyping/#7346" class="Bound">ls</a>  <a id="7390" class="Symbol">→</a>  <a id="7393" href="/Subtyping/#7310" class="Bound">ns</a> <a id="7396" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="7398" href="/Subtyping/#7346" class="Bound">ls</a>
<a id="7401" href="/Subtyping/#7291" class="Function">⊆-trans</a> <a id="7409" class="Symbol">{</a><a id="7410" href="/Subtyping/#7410" class="Bound">l</a><a id="7411" class="Symbol">}{</a><a id="7413" href="/Subtyping/#7413" class="Bound">n</a><a id="7414" class="Symbol">}{</a><a id="7416" href="/Subtyping/#7416" class="Bound">m</a><a id="7417" class="Symbol">}{</a><a id="7419" href="/Subtyping/#7419" class="Bound">ns</a><a id="7421" class="Symbol">}{</a><a id="7423" href="/Subtyping/#7423" class="Bound">ms</a><a id="7425" class="Symbol">}{</a><a id="7427" href="/Subtyping/#7427" class="Bound">ls</a><a id="7429" class="Symbol">}</a> <a id="7431" href="/Subtyping/#7431" class="Bound">ns⊆ms</a> <a id="7437" href="/Subtyping/#7437" class="Bound">ms⊆ls</a> <a id="7443" class="Symbol">=</a> <a id="7445" class="Symbol">λ</a> <a id="7447" href="/Subtyping/#7447" class="Bound">x</a> <a id="7449" href="/Subtyping/#7449" class="Bound">z</a> <a id="7451" class="Symbol">→</a> <a id="7453" href="/Subtyping/#7437" class="Bound">ms⊆ls</a> <a id="7459" href="/Subtyping/#7447" class="Bound">x</a> <a id="7461" class="Symbol">(</a><a id="7462" href="/Subtyping/#7431" class="Bound">ns⊆ms</a> <a id="7468" href="/Subtyping/#7447" class="Bound">x</a> <a id="7470" href="/Subtyping/#7449" class="Bound">z</a><a id="7471" class="Symbol">)</a>
</pre>
<p>If <code class="language-plaintext highlighter-rouge">y</code> is an element of vector <code class="language-plaintext highlighter-rouge">xs</code>, then <code class="language-plaintext highlighter-rouge">y</code> is at some index <code class="language-plaintext highlighter-rouge">i</code> of
the vector.</p>
<pre class="Agda"><a id="lookup-∈"></a><a id="7564" href="/Subtyping/#7564" class="Function">lookup-∈</a> <a id="7573" class="Symbol">:</a> <a id="7575" class="Symbol">∀{</a><a id="7577" href="/Subtyping/#7577" class="Bound">ℓ</a><a id="7578" class="Symbol">}{</a><a id="7580" href="/Subtyping/#7580" class="Bound">A</a> <a id="7582" class="Symbol">:</a> <a id="7584" class="PrimitiveType">Set</a> <a id="7588" href="/Subtyping/#7577" class="Bound">ℓ</a><a id="7589" class="Symbol">}{</a><a id="7591" href="/Subtyping/#7591" class="Bound">n</a><a id="7592" class="Symbol">}</a> <a id="7594" class="Symbol">{</a><a id="7595" href="/Subtyping/#7595" class="Bound">xs</a> <a id="7598" class="Symbol">:</a> <a id="7600" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7604" href="/Subtyping/#7580" class="Bound">A</a> <a id="7606" href="/Subtyping/#7591" class="Bound">n</a><a id="7607" class="Symbol">}{</a><a id="7609" href="/Subtyping/#7609" class="Bound">y</a><a id="7610" class="Symbol">}</a>
   <a id="7615" class="Symbol">→</a> <a id="7617" href="/Subtyping/#7609" class="Bound">y</a> <a id="7619" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Membership.Setoid.html#824" class="Function Operator">∈</a> <a id="7621" href="/Subtyping/#7595" class="Bound">xs</a>
   <a id="7627" class="Symbol">→</a> <a id="7629" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="7632" href="/Subtyping/#7632" class="Bound">i</a> <a id="7634" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="7636" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="7640" href="/Subtyping/#7591" class="Bound">n</a> <a id="7642" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="7644" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="7651" href="/Subtyping/#7595" class="Bound">xs</a> <a id="7654" href="/Subtyping/#7632" class="Bound">i</a> <a id="7656" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="7658" href="/Subtyping/#7609" class="Bound">y</a>
<a id="7660" href="/Subtyping/#7564" class="Function">lookup-∈</a> <a id="7669" class="Symbol">{</a><a id="7670" class="Argument">xs</a> <a id="7673" class="Symbol">=</a> <a id="7675" href="/Subtyping/#7675" class="Bound">x</a> <a id="7677" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="7679" href="/Subtyping/#7679" class="Bound">xs</a><a id="7681" class="Symbol">}</a> <a id="7683" class="Symbol">(</a><a id="7684" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#991" class="InductiveConstructor">here</a> <a id="7689" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="7693" class="Symbol">)</a> <a id="7695" class="Symbol">=</a> <a id="7697" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="7699" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a> <a id="7704" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="7706" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="7711" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="7713" href="/Subtyping/#7564" class="Function">lookup-∈</a> <a id="7722" class="Symbol">{</a><a id="7723" class="Argument">xs</a> <a id="7726" class="Symbol">=</a> <a id="7728" href="/Subtyping/#7728" class="Bound">x</a> <a id="7730" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="7732" href="/Subtyping/#7732" class="Bound">xs</a><a id="7734" class="Symbol">}</a> <a id="7736" class="Symbol">(</a><a id="7737" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#1058" class="InductiveConstructor">there</a> <a id="7743" href="/Subtyping/#7743" class="Bound">y∈xs</a><a id="7747" class="Symbol">)</a>
    <a id="7753" class="Keyword">with</a> <a id="7758" href="/Subtyping/#7564" class="Function">lookup-∈</a> <a id="7767" href="/Subtyping/#7743" class="Bound">y∈xs</a>
<a id="7772" class="Symbol">...</a> <a id="7776" class="Symbol">|</a> <a id="7778" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="7780" href="/Subtyping/#7780" class="Bound">i</a> <a id="7782" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="7784" href="/Subtyping/#7784" class="Bound">xs[i]=y</a> <a id="7792" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="7794" class="Symbol">=</a> <a id="7796" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="7798" class="Symbol">(</a><a id="7799" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="7803" href="/Subtyping/#7780" class="Bound">i</a><a id="7804" class="Symbol">)</a> <a id="7806" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="7808" href="/Subtyping/#7784" class="Bound">xs[i]=y</a> <a id="7816" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>If one vector <code class="language-plaintext highlighter-rouge">ns</code> is a subset of another <code class="language-plaintext highlighter-rouge">ms</code>, then for any element
<code class="language-plaintext highlighter-rouge">lookup ns i</code>, there is an equal element in <code class="language-plaintext highlighter-rouge">ms</code> at some index.</p>
<pre class="Agda"><a id="lookup-⊆"></a><a id="7960" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="7969" class="Symbol">:</a> <a id="7971" class="Symbol">∀{</a><a id="7973" href="/Subtyping/#7973" class="Bound">n</a> <a id="7975" href="/Subtyping/#7975" class="Bound">m</a> <a id="7977" class="Symbol">:</a> <a id="7979" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="7980" class="Symbol">}{</a><a id="7982" href="/Subtyping/#7982" class="Bound">ns</a> <a id="7985" class="Symbol">:</a> <a id="7987" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="7991" href="/Subtyping/#4606" class="Function">Name</a> <a id="7996" href="/Subtyping/#7973" class="Bound">n</a><a id="7997" class="Symbol">}{</a><a id="7999" href="/Subtyping/#7999" class="Bound">ms</a> <a id="8002" class="Symbol">:</a> <a id="8004" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="8008" href="/Subtyping/#4606" class="Function">Name</a> <a id="8013" href="/Subtyping/#7975" class="Bound">m</a><a id="8014" class="Symbol">}{</a><a id="8016" href="/Subtyping/#8016" class="Bound">i</a> <a id="8018" class="Symbol">:</a> <a id="8020" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="8024" href="/Subtyping/#7973" class="Bound">n</a><a id="8025" class="Symbol">}</a>
   <a id="8030" class="Symbol">→</a> <a id="8032" href="/Subtyping/#7982" class="Bound">ns</a> <a id="8035" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="8037" href="/Subtyping/#7999" class="Bound">ms</a>
   <a id="8043" class="Symbol">→</a> <a id="8045" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Σ[</a> <a id="8048" href="/Subtyping/#8048" class="Bound">k</a> <a id="8050" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">∈</a> <a id="8052" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="8056" href="/Subtyping/#7975" class="Bound">m</a> <a id="8058" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="8060" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="8067" href="/Subtyping/#7982" class="Bound">ns</a> <a id="8070" href="/Subtyping/#8016" class="Bound">i</a> <a id="8072" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="8074" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="8081" href="/Subtyping/#7999" class="Bound">ms</a> <a id="8084" href="/Subtyping/#8048" class="Bound">k</a>
<a id="8086" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="8095" class="Symbol">{</a><a id="8096" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="8100" href="/Subtyping/#8100" class="Bound">n</a><a id="8101" class="Symbol">}</a> <a id="8103" class="Symbol">{</a><a id="8104" href="/Subtyping/#8104" class="Bound">m</a><a id="8105" class="Symbol">}</a> <a id="8107" class="Symbol">{</a><a id="8108" href="/Subtyping/#8108" class="Bound">x</a> <a id="8110" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="8112" href="/Subtyping/#8112" class="Bound">ns</a><a id="8114" class="Symbol">}</a> <a id="8116" class="Symbol">{</a><a id="8117" href="/Subtyping/#8117" class="Bound">ms</a><a id="8119" class="Symbol">}</a> <a id="8121" class="Symbol">{</a><a id="8122" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="8126" class="Symbol">}</a> <a id="8128" href="/Subtyping/#8128" class="Bound">ns⊆ms</a>
    <a id="8138" class="Keyword">with</a> <a id="8143" href="/Subtyping/#7564" class="Function">lookup-∈</a> <a id="8152" class="Symbol">(</a><a id="8153" href="/Subtyping/#8128" class="Bound">ns⊆ms</a> <a id="8159" href="/Subtyping/#8108" class="Bound">x</a> <a id="8161" class="Symbol">(</a><a id="8162" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#991" class="InductiveConstructor">here</a> <a id="8167" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="8171" class="Symbol">))</a>
<a id="8174" class="Symbol">...</a> <a id="8178" class="Symbol">|</a> <a id="8180" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="8182" href="/Subtyping/#8182" class="Bound">k</a> <a id="8184" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="8186" href="/Subtyping/#8186" class="Bound">ms[k]=x</a> <a id="8194" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="8196" class="Symbol">=</a>
      <a id="8204" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="8206" href="/Subtyping/#8182" class="Bound">k</a> <a id="8208" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="8210" class="Symbol">(</a><a id="8211" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="8215" href="/Subtyping/#8186" class="Bound">ms[k]=x</a><a id="8222" class="Symbol">)</a> <a id="8224" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
<a id="8226" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="8235" class="Symbol">{</a><a id="8236" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="8240" href="/Subtyping/#8240" class="Bound">n</a><a id="8241" class="Symbol">}</a> <a id="8243" class="Symbol">{</a><a id="8244" href="/Subtyping/#8244" class="Bound">m</a><a id="8245" class="Symbol">}</a> <a id="8247" class="Symbol">{</a><a id="8248" href="/Subtyping/#8248" class="Bound">x</a> <a id="8250" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="8252" href="/Subtyping/#8252" class="Bound">ns</a><a id="8254" class="Symbol">}</a> <a id="8256" class="Symbol">{</a><a id="8257" href="/Subtyping/#8257" class="Bound">ms</a><a id="8259" class="Symbol">}</a> <a id="8261" class="Symbol">{</a><a id="8262" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="8266" href="/Subtyping/#8266" class="Bound">i</a><a id="8267" class="Symbol">}</a> <a id="8269" href="/Subtyping/#8269" class="Bound">x∷ns⊆ms</a> <a id="8277" class="Symbol">=</a>
    <a id="8283" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="8292" class="Symbol">{</a><a id="8293" href="/Subtyping/#8240" class="Bound">n</a><a id="8294" class="Symbol">}</a> <a id="8296" class="Symbol">{</a><a id="8297" href="/Subtyping/#8244" class="Bound">m</a><a id="8298" class="Symbol">}</a> <a id="8300" class="Symbol">{</a><a id="8301" href="/Subtyping/#8252" class="Bound">ns</a><a id="8303" class="Symbol">}</a> <a id="8305" class="Symbol">{</a><a id="8306" href="/Subtyping/#8257" class="Bound">ms</a><a id="8308" class="Symbol">}</a> <a id="8310" class="Symbol">{</a><a id="8311" href="/Subtyping/#8266" class="Bound">i</a><a id="8312" class="Symbol">}</a> <a id="8314" class="Symbol">(λ</a> <a id="8317" href="/Subtyping/#8317" class="Bound">x</a> <a id="8319" href="/Subtyping/#8319" class="Bound">z</a> <a id="8321" class="Symbol">→</a> <a id="8323" href="/Subtyping/#8269" class="Bound">x∷ns⊆ms</a> <a id="8331" href="/Subtyping/#8317" class="Bound">x</a> <a id="8333" class="Symbol">(</a><a id="8334" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Relation.Unary.Any.html#1058" class="InductiveConstructor">there</a> <a id="8340" href="/Subtyping/#8319" class="Bound">z</a><a id="8341" class="Symbol">))</a>
</pre>
<h2 id="types">Types</h2>

<pre class="Agda"><a id="8363" class="Keyword">data</a> <a id="Type"></a><a id="8368" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="8373" class="Symbol">:</a> <a id="8375" class="PrimitiveType">Set</a> <a id="8379" class="Keyword">where</a>
  <a id="Type._⇒_"></a><a id="8387" href="/Subtyping/#8387" class="InductiveConstructor Operator">_⇒_</a>   <a id="8393" class="Symbol">:</a> <a id="8395" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="8400" class="Symbol">→</a> <a id="8402" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="8407" class="Symbol">→</a> <a id="8409" href="/Subtyping/#8368" class="Datatype">Type</a>
  <a id="Type.`ℕ"></a><a id="8416" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>    <a id="8422" class="Symbol">:</a> <a id="8424" href="/Subtyping/#8368" class="Datatype">Type</a>
  <a id="Type.｛_⦂_｝"></a><a id="8431" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛_⦂_｝</a> <a id="8437" class="Symbol">:</a> <a id="8439" class="Symbol">{</a><a id="8440" href="/Subtyping/#8440" class="Bound">n</a> <a id="8442" class="Symbol">:</a> <a id="8444" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="8445" class="Symbol">}</a> <a id="8447" class="Symbol">(</a><a id="8448" href="/Subtyping/#8448" class="Bound">ls</a> <a id="8451" class="Symbol">:</a> <a id="8453" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="8457" href="/Subtyping/#4606" class="Function">Name</a> <a id="8462" href="/Subtyping/#8440" class="Bound">n</a><a id="8463" class="Symbol">)</a> <a id="8465" class="Symbol">(</a><a id="8466" href="/Subtyping/#8466" class="Bound">As</a> <a id="8469" class="Symbol">:</a> <a id="8471" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="8475" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="8480" href="/Subtyping/#8440" class="Bound">n</a><a id="8481" class="Symbol">)</a> <a id="8483" class="Symbol">→</a> <a id="8485" class="Symbol">.{</a><a id="8487" href="/Subtyping/#8487" class="Bound">d</a> <a id="8489" class="Symbol">:</a> <a id="8491" href="/Subtyping/#5361" class="Function">distinct</a> <a id="8500" href="/Subtyping/#8448" class="Bound">ls</a><a id="8502" class="Symbol">}</a> <a id="8504" class="Symbol">→</a> <a id="8506" href="/Subtyping/#8368" class="Datatype">Type</a>
</pre>
<p>In addition to function types <code class="language-plaintext highlighter-rouge">A ⇒ B</code> and natural numbers <code class="language-plaintext highlighter-rouge">ℕ</code>, we
have the record type <code class="language-plaintext highlighter-rouge">｛ ls ⦂ As ｝</code>, where <code class="language-plaintext highlighter-rouge">ls</code> is a vector of field
names and <code class="language-plaintext highlighter-rouge">As</code> is a vector of types, as discussed above.  We require
that the field names be distinct, but we do not want the details of
the proof of distinctness to affect whether two record types are
equal, so we declare that parameter to be irrelevant by placing a <code class="language-plaintext highlighter-rouge">.</code>
in front of it.</p>

<h2 id="subtyping">Subtyping</h2>

<p>The subtyping relation, written <code class="language-plaintext highlighter-rouge">A &lt;: B</code>, defines when an implicit
cast is allowed via the subsumption rule. The following data type
definition specifies the subtyping rules for natural numbers,
functions, and record types. We discuss each rule below.</p>

<pre class="Agda"><a id="9211" class="Keyword">data</a> <a id="_&lt;:_"></a><a id="9216" href="/Subtyping/#9216" class="Datatype Operator">_&lt;:_</a> <a id="9221" class="Symbol">:</a> <a id="9223" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="9228" class="Symbol">→</a> <a id="9230" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="9235" class="Symbol">→</a> <a id="9237" class="PrimitiveType">Set</a> <a id="9241" class="Keyword">where</a>
  <a id="_&lt;:_.&lt;:-nat"></a><a id="9249" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a> <a id="9256" class="Symbol">:</a> <a id="9258" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a> <a id="9261" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9264" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>

  <a id="_&lt;:_.&lt;:-fun"></a><a id="9270" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="9277" class="Symbol">:</a> <a id="9279" class="Symbol">∀{</a><a id="9281" href="/Subtyping/#9281" class="Bound">A</a> <a id="9283" href="/Subtyping/#9283" class="Bound">B</a> <a id="9285" href="/Subtyping/#9285" class="Bound">C</a> <a id="9287" href="/Subtyping/#9287" class="Bound">D</a> <a id="9289" class="Symbol">:</a> <a id="9291" href="/Subtyping/#8368" class="Datatype">Type</a><a id="9295" class="Symbol">}</a>
    <a id="9301" class="Symbol">→</a> <a id="9303" href="/Subtyping/#9285" class="Bound">C</a> <a id="9305" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9308" href="/Subtyping/#9281" class="Bound">A</a>  <a id="9311" class="Symbol">→</a> <a id="9313" href="/Subtyping/#9283" class="Bound">B</a> <a id="9315" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9318" href="/Subtyping/#9287" class="Bound">D</a>
      <a id="9326" class="Comment">----------------</a>
    <a id="9347" class="Symbol">→</a> <a id="9349" href="/Subtyping/#9281" class="Bound">A</a> <a id="9351" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="9353" href="/Subtyping/#9283" class="Bound">B</a> <a id="9355" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9358" href="/Subtyping/#9285" class="Bound">C</a> <a id="9360" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="9362" href="/Subtyping/#9287" class="Bound">D</a>

  <a id="_&lt;:_.&lt;:-rcd"></a><a id="9367" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="9374" class="Symbol">:</a>  <a id="9377" class="Symbol">∀{</a><a id="9379" href="/Subtyping/#9379" class="Bound">m</a><a id="9380" class="Symbol">}{</a><a id="9382" href="/Subtyping/#9382" class="Bound">ks</a> <a id="9385" class="Symbol">:</a> <a id="9387" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="9391" href="/Subtyping/#4606" class="Function">Name</a> <a id="9396" href="/Subtyping/#9379" class="Bound">m</a><a id="9397" class="Symbol">}{</a><a id="9399" href="/Subtyping/#9399" class="Bound">Ss</a> <a id="9402" class="Symbol">:</a> <a id="9404" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="9408" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="9413" href="/Subtyping/#9379" class="Bound">m</a><a id="9414" class="Symbol">}.{</a><a id="9417" href="/Subtyping/#9417" class="Bound">d1</a> <a id="9420" class="Symbol">:</a> <a id="9422" href="/Subtyping/#5361" class="Function">distinct</a> <a id="9431" href="/Subtyping/#9382" class="Bound">ks</a><a id="9433" class="Symbol">}</a>
             <a id="9448" class="Symbol">{</a><a id="9449" href="/Subtyping/#9449" class="Bound">n</a><a id="9450" class="Symbol">}{</a><a id="9452" href="/Subtyping/#9452" class="Bound">ls</a> <a id="9455" class="Symbol">:</a> <a id="9457" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="9461" href="/Subtyping/#4606" class="Function">Name</a> <a id="9466" href="/Subtyping/#9449" class="Bound">n</a><a id="9467" class="Symbol">}{</a><a id="9469" href="/Subtyping/#9469" class="Bound">Ts</a> <a id="9472" class="Symbol">:</a> <a id="9474" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="9478" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="9483" href="/Subtyping/#9449" class="Bound">n</a><a id="9484" class="Symbol">}.{</a><a id="9487" href="/Subtyping/#9487" class="Bound">d2</a> <a id="9490" class="Symbol">:</a> <a id="9492" href="/Subtyping/#5361" class="Function">distinct</a> <a id="9501" href="/Subtyping/#9452" class="Bound">ls</a><a id="9503" class="Symbol">}</a>
    <a id="9509" class="Symbol">→</a> <a id="9511" href="/Subtyping/#9452" class="Bound">ls</a> <a id="9514" href="/Subtyping/#7073" class="Function Operator">⊆</a> <a id="9516" href="/Subtyping/#9382" class="Bound">ks</a>
    <a id="9523" class="Symbol">→</a> <a id="9525" class="Symbol">(∀{</a><a id="9528" href="/Subtyping/#9528" class="Bound">i</a> <a id="9530" class="Symbol">:</a> <a id="9532" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="9536" href="/Subtyping/#9449" class="Bound">n</a><a id="9537" class="Symbol">}{</a><a id="9539" href="/Subtyping/#9539" class="Bound">j</a> <a id="9541" class="Symbol">:</a> <a id="9543" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="9547" href="/Subtyping/#9379" class="Bound">m</a><a id="9548" class="Symbol">}</a> <a id="9550" class="Symbol">→</a> <a id="9552" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="9559" href="/Subtyping/#9382" class="Bound">ks</a> <a id="9562" href="/Subtyping/#9539" class="Bound">j</a> <a id="9564" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="9566" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="9573" href="/Subtyping/#9452" class="Bound">ls</a> <a id="9576" href="/Subtyping/#9528" class="Bound">i</a>
                               <a id="9609" class="Symbol">→</a> <a id="9611" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="9618" href="/Subtyping/#9399" class="Bound">Ss</a> <a id="9621" href="/Subtyping/#9539" class="Bound">j</a> <a id="9623" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9626" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="9633" href="/Subtyping/#9469" class="Bound">Ts</a> <a id="9636" href="/Subtyping/#9528" class="Bound">i</a><a id="9637" class="Symbol">)</a>
      <a id="9645" class="Comment">------------------------------------------------------</a>
    <a id="9704" class="Symbol">→</a> <a id="9706" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="9708" href="/Subtyping/#9382" class="Bound">ks</a> <a id="9711" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="9713" href="/Subtyping/#9399" class="Bound">Ss</a> <a id="9716" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="9718" class="Symbol">{</a><a id="9719" href="/Subtyping/#9417" class="Bound">d1</a><a id="9721" class="Symbol">}</a> <a id="9723" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="9726" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="9728" href="/Subtyping/#9452" class="Bound">ls</a> <a id="9731" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="9733" href="/Subtyping/#9469" class="Bound">Ts</a> <a id="9736" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="9738" class="Symbol">{</a><a id="9739" href="/Subtyping/#9487" class="Bound">d2</a><a id="9741" class="Symbol">}</a>
</pre>
<p>The rule <code class="language-plaintext highlighter-rouge">&lt;:-nat</code> says that <code class="language-plaintext highlighter-rouge">ℕ</code> is a subtype of itself.</p>

<p>The rule <code class="language-plaintext highlighter-rouge">&lt;:-fun</code> is the traditional rule for function types, which is
best understood with the below diagram. It answers the question, when
can a function of type <code class="language-plaintext highlighter-rouge">A ⇒ B</code> be used in place of a function of type
<code class="language-plaintext highlighter-rouge">C ⇒ D</code>. It will be called with an argument of type <code class="language-plaintext highlighter-rouge">C</code>, so we need to
convert from <code class="language-plaintext highlighter-rouge">C</code> to <code class="language-plaintext highlighter-rouge">A</code>. We then call the function to get the result
of type <code class="language-plaintext highlighter-rouge">B</code>. Finally, we need to convert from <code class="language-plaintext highlighter-rouge">B</code> to <code class="language-plaintext highlighter-rouge">D</code>. Note that
the direction of subtyping for the parameters is swapped (<code class="language-plaintext highlighter-rouge">C &lt;: A</code>), a
phenomenon named contra-variance.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C &lt;: A
⇓    ⇓
D :&gt; B
</code></pre></div></div>

<p>The record subtyping rule (<code class="language-plaintext highlighter-rouge">&lt;:-rcd</code>) characterizes when a record of
one type can safely be used in place of another record type.  The
first premise of the rule expresses <em>width subtyping</em> by requiring
that all the field names in <code class="language-plaintext highlighter-rouge">ls</code> are also in <code class="language-plaintext highlighter-rouge">ks</code>. So it allows the
hiding of fields when going from a subtype to a supertype.
The second premise of the record subtyping rule (<code class="language-plaintext highlighter-rouge">&lt;:-rcd</code>) expresses
<em>depth subtyping</em>, that is, it allows the types of the fields to
change according to subtyping. The following is an abbreviation for
this premise.</p>
<pre class="Agda"><a id="_⦂_&lt;:_⦂_"></a><a id="10912" href="/Subtyping/#10912" class="Function Operator">_⦂_&lt;:_⦂_</a> <a id="10921" class="Symbol">:</a> <a id="10923" class="Symbol">∀</a> <a id="10925" class="Symbol">{</a><a id="10926" href="/Subtyping/#10926" class="Bound">m</a> <a id="10928" href="/Subtyping/#10928" class="Bound">n</a><a id="10929" class="Symbol">}</a> <a id="10931" class="Symbol">→</a> <a id="10933" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="10937" href="/Subtyping/#4606" class="Function">Name</a> <a id="10942" href="/Subtyping/#10926" class="Bound">m</a> <a id="10944" class="Symbol">→</a> <a id="10946" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="10950" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="10955" href="/Subtyping/#10926" class="Bound">m</a> <a id="10957" class="Symbol">→</a> <a id="10959" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="10963" href="/Subtyping/#4606" class="Function">Name</a> <a id="10968" href="/Subtyping/#10928" class="Bound">n</a> <a id="10970" class="Symbol">→</a> <a id="10972" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="10976" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="10981" href="/Subtyping/#10928" class="Bound">n</a> <a id="10983" class="Symbol">→</a> <a id="10985" class="PrimitiveType">Set</a>
<a id="10989" href="/Subtyping/#10912" class="Function Operator">_⦂_&lt;:_⦂_</a> <a id="10998" class="Symbol">{</a><a id="10999" href="/Subtyping/#10999" class="Bound">m</a><a id="11000" class="Symbol">}{</a><a id="11002" href="/Subtyping/#11002" class="Bound">n</a><a id="11003" class="Symbol">}</a> <a id="11005" href="/Subtyping/#11005" class="Bound">ks</a> <a id="11008" href="/Subtyping/#11008" class="Bound">Ss</a> <a id="11011" href="/Subtyping/#11011" class="Bound">ls</a> <a id="11014" href="/Subtyping/#11014" class="Bound">Ts</a> <a id="11017" class="Symbol">=</a> <a id="11019" class="Symbol">(∀{</a><a id="11022" href="/Subtyping/#11022" class="Bound">i</a> <a id="11024" class="Symbol">:</a> <a id="11026" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="11030" href="/Subtyping/#11002" class="Bound">n</a><a id="11031" class="Symbol">}{</a><a id="11033" href="/Subtyping/#11033" class="Bound">j</a> <a id="11035" class="Symbol">:</a> <a id="11037" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="11041" href="/Subtyping/#10999" class="Bound">m</a><a id="11042" class="Symbol">}</a>
    <a id="11048" class="Symbol">→</a> <a id="11050" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="11057" href="/Subtyping/#11005" class="Bound">ks</a> <a id="11060" href="/Subtyping/#11033" class="Bound">j</a> <a id="11062" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="11064" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="11071" href="/Subtyping/#11011" class="Bound">ls</a> <a id="11074" href="/Subtyping/#11022" class="Bound">i</a>  <a id="11077" class="Symbol">→</a>  <a id="11080" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="11087" href="/Subtyping/#11008" class="Bound">Ss</a> <a id="11090" href="/Subtyping/#11033" class="Bound">j</a> <a id="11092" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="11095" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="11102" href="/Subtyping/#11014" class="Bound">Ts</a> <a id="11105" href="/Subtyping/#11022" class="Bound">i</a><a id="11106" class="Symbol">)</a>
</pre>
<h2 id="subtyping-is-reflexive">Subtyping is Reflexive</h2>

<p>In this section we prove that subtyping is reflexive, that is, <code class="language-plaintext highlighter-rouge">A &lt;:
A</code> for any type <code class="language-plaintext highlighter-rouge">A</code>. The proof does not go by induction on the type
<code class="language-plaintext highlighter-rouge">A</code> because of the <code class="language-plaintext highlighter-rouge">&lt;:-rcd</code> rule. We instead use induction on the size
of the type. So we first define size of a type, and the size of a
vector of types, as follows.</p>
<pre class="Agda"><a id="ty-size"></a><a id="11447" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11455" class="Symbol">:</a> <a id="11457" class="Symbol">(</a><a id="11458" href="/Subtyping/#11458" class="Bound">A</a> <a id="11460" class="Symbol">:</a> <a id="11462" href="/Subtyping/#8368" class="Datatype">Type</a><a id="11466" class="Symbol">)</a> <a id="11468" class="Symbol">→</a> <a id="11470" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
<a id="vec-ty-size"></a><a id="11472" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="11484" class="Symbol">:</a> <a id="11486" class="Symbol">∀</a> <a id="11488" class="Symbol">{</a><a id="11489" href="/Subtyping/#11489" class="Bound">n</a> <a id="11491" class="Symbol">:</a> <a id="11493" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="11494" class="Symbol">}</a> <a id="11496" class="Symbol">→</a> <a id="11498" class="Symbol">(</a><a id="11499" href="/Subtyping/#11499" class="Bound">As</a> <a id="11502" class="Symbol">:</a> <a id="11504" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="11508" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="11513" href="/Subtyping/#11489" class="Bound">n</a><a id="11514" class="Symbol">)</a> <a id="11516" class="Symbol">→</a> <a id="11518" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>

<a id="11521" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11529" class="Symbol">(</a><a id="11530" href="/Subtyping/#11530" class="Bound">A</a> <a id="11532" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="11534" href="/Subtyping/#11534" class="Bound">B</a><a id="11535" class="Symbol">)</a> <a id="11537" class="Symbol">=</a> <a id="11539" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="11543" class="Symbol">(</a><a id="11544" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11552" href="/Subtyping/#11530" class="Bound">A</a> <a id="11554" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">+</a> <a id="11556" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11564" href="/Subtyping/#11534" class="Bound">B</a><a id="11565" class="Symbol">)</a>
<a id="11567" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11575" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a> <a id="11578" class="Symbol">=</a> <a id="11580" class="Number">1</a>
<a id="11582" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11590" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="11592" href="/Subtyping/#11592" class="Bound">ls</a> <a id="11595" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="11597" href="/Subtyping/#11597" class="Bound">As</a> <a id="11600" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="11602" class="Symbol">=</a> <a id="11604" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="11608" class="Symbol">(</a><a id="11609" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="11621" href="/Subtyping/#11597" class="Bound">As</a><a id="11623" class="Symbol">)</a>
<a id="11625" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="11637" class="Symbol">{</a><a id="11638" href="/Subtyping/#11638" class="Bound">n</a><a id="11639" class="Symbol">}</a> <a id="11641" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="11644" class="Symbol">=</a> <a id="11646" class="Number">0</a>
<a id="11648" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="11660" class="Symbol">{</a><a id="11661" href="/Subtyping/#11661" class="Bound">n</a><a id="11662" class="Symbol">}</a> <a id="11664" class="Symbol">(</a><a id="11665" href="/Subtyping/#11665" class="Bound">x</a> <a id="11667" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="11669" href="/Subtyping/#11669" class="Bound">xs</a><a id="11671" class="Symbol">)</a> <a id="11673" class="Symbol">=</a> <a id="11675" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11683" href="/Subtyping/#11665" class="Bound">x</a> <a id="11685" href="Agda.Builtin.Nat.html#298" class="Primitive Operator">+</a> <a id="11687" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="11699" href="/Subtyping/#11669" class="Bound">xs</a>
</pre>
<p>The size of a type is always positive.</p>
<pre class="Agda"><a id="ty-size-pos"></a><a id="11750" href="/Subtyping/#11750" class="Function">ty-size-pos</a> <a id="11762" class="Symbol">:</a> <a id="11764" class="Symbol">∀</a> <a id="11766" class="Symbol">{</a><a id="11767" href="/Subtyping/#11767" class="Bound">A</a><a id="11768" class="Symbol">}</a> <a id="11770" class="Symbol">→</a> <a id="11772" class="Number">0</a> <a id="11774" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#1005" class="Function Operator">&lt;</a> <a id="11776" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="11784" href="/Subtyping/#11767" class="Bound">A</a>
<a id="11786" href="/Subtyping/#11750" class="Function">ty-size-pos</a> <a id="11798" class="Symbol">{</a><a id="11799" href="/Subtyping/#11799" class="Bound">A</a> <a id="11801" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="11803" href="/Subtyping/#11803" class="Bound">B</a><a id="11804" class="Symbol">}</a> <a id="11806" class="Symbol">=</a> <a id="11808" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#960" class="InductiveConstructor">s≤s</a> <a id="11812" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#918" class="InductiveConstructor">z≤n</a>
<a id="11816" href="/Subtyping/#11750" class="Function">ty-size-pos</a> <a id="11828" class="Symbol">{</a><a id="11829" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a><a id="11831" class="Symbol">}</a> <a id="11833" class="Symbol">=</a> <a id="11835" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#960" class="InductiveConstructor">s≤s</a> <a id="11839" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#918" class="InductiveConstructor">z≤n</a>
<a id="11843" href="/Subtyping/#11750" class="Function">ty-size-pos</a> <a id="11855" class="Symbol">{</a><a id="11856" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="11858" href="/Subtyping/#11858" class="Bound">fs</a> <a id="11861" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="11863" href="/Subtyping/#11863" class="Bound">As</a> <a id="11866" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="11868" class="Symbol">}</a> <a id="11870" class="Symbol">=</a> <a id="11872" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#960" class="InductiveConstructor">s≤s</a> <a id="11876" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#918" class="InductiveConstructor">z≤n</a>
</pre>
<p>The size of a type in a vector is less-or-equal in size to the entire vector.</p>
<pre class="Agda"><a id="lookup-vec-ty-size"></a><a id="11967" href="/Subtyping/#11967" class="Function">lookup-vec-ty-size</a> <a id="11986" class="Symbol">:</a> <a id="11988" class="Symbol">∀{</a><a id="11990" href="/Subtyping/#11990" class="Bound">k</a><a id="11991" class="Symbol">}</a> <a id="11993" class="Symbol">{</a><a id="11994" href="/Subtyping/#11994" class="Bound">As</a> <a id="11997" class="Symbol">:</a> <a id="11999" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="12003" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="12008" href="/Subtyping/#11990" class="Bound">k</a><a id="12009" class="Symbol">}</a> <a id="12011" class="Symbol">{</a><a id="12012" href="/Subtyping/#12012" class="Bound">j</a><a id="12013" class="Symbol">}</a>
   <a id="12018" class="Symbol">→</a> <a id="12020" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="12028" class="Symbol">(</a><a id="12029" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="12036" href="/Subtyping/#11994" class="Bound">As</a> <a id="12039" href="/Subtyping/#12012" class="Bound">j</a><a id="12040" class="Symbol">)</a> <a id="12042" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#895" class="Datatype Operator">≤</a> <a id="12044" href="/Subtyping/#11472" class="Function">vec-ty-size</a> <a id="12056" href="/Subtyping/#11994" class="Bound">As</a>
<a id="12059" href="/Subtyping/#11967" class="Function">lookup-vec-ty-size</a> <a id="12078" class="Symbol">{</a><a id="12079" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="12083" href="/Subtyping/#12083" class="Bound">k</a><a id="12084" class="Symbol">}</a> <a id="12086" class="Symbol">{</a><a id="12087" href="/Subtyping/#12087" class="Bound">A</a> <a id="12089" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="12091" href="/Subtyping/#12091" class="Bound">As</a><a id="12093" class="Symbol">}</a> <a id="12095" class="Symbol">{</a><a id="12096" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="12100" class="Symbol">}</a> <a id="12102" class="Symbol">=</a> <a id="12104" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#14955" class="Function">m≤m+n</a> <a id="12110" class="Symbol">_</a> <a id="12112" class="Symbol">_</a>
<a id="12114" href="/Subtyping/#11967" class="Function">lookup-vec-ty-size</a> <a id="12133" class="Symbol">{</a><a id="12134" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="12138" href="/Subtyping/#12138" class="Bound">k</a><a id="12139" class="Symbol">}</a> <a id="12141" class="Symbol">{</a><a id="12142" href="/Subtyping/#12142" class="Bound">A</a> <a id="12144" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="12146" href="/Subtyping/#12146" class="Bound">As</a><a id="12148" class="Symbol">}</a> <a id="12150" class="Symbol">{</a><a id="12151" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="12155" href="/Subtyping/#12155" class="Bound">j</a><a id="12156" class="Symbol">}</a> <a id="12158" class="Symbol">=</a> <a id="12160" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3815" class="Function">≤-trans</a> <a id="12168" class="Symbol">(</a><a id="12169" href="/Subtyping/#11967" class="Function">lookup-vec-ty-size</a> <a id="12188" class="Symbol">{</a><a id="12189" href="/Subtyping/#12138" class="Bound">k</a><a id="12190" class="Symbol">}</a> <a id="12192" class="Symbol">{</a><a id="12193" href="/Subtyping/#12146" class="Bound">As</a><a id="12195" class="Symbol">})</a> <a id="12198" class="Symbol">(</a><a id="12199" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#59581" class="Function">n≤m+n</a> <a id="12205" class="Symbol">_</a> <a id="12207" class="Symbol">_)</a>
</pre>
<p>Here is the proof of reflexivity, by induction on the size of the type.</p>
<pre class="Agda"><a id="&lt;:-refl-aux"></a><a id="12291" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12303" class="Symbol">:</a> <a id="12305" class="Symbol">∀{</a><a id="12307" href="/Subtyping/#12307" class="Bound">n</a><a id="12308" class="Symbol">}{</a><a id="12310" href="/Subtyping/#12310" class="Bound">A</a><a id="12311" class="Symbol">}{</a><a id="12313" href="/Subtyping/#12313" class="Bound">m</a> <a id="12315" class="Symbol">:</a> <a id="12317" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="12325" href="/Subtyping/#12310" class="Bound">A</a> <a id="12327" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Base.html#895" class="Datatype Operator">≤</a> <a id="12329" href="/Subtyping/#12307" class="Bound">n</a><a id="12330" class="Symbol">}</a> <a id="12332" class="Symbol">→</a> <a id="12334" href="/Subtyping/#12310" class="Bound">A</a> <a id="12336" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="12339" href="/Subtyping/#12310" class="Bound">A</a>
<a id="12341" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12353" class="Symbol">{</a><a id="12354" class="Number">0</a><a id="12355" class="Symbol">}{</a><a id="12357" href="/Subtyping/#12357" class="Bound">A</a><a id="12358" class="Symbol">}{</a><a id="12360" href="/Subtyping/#12360" class="Bound">m</a><a id="12361" class="Symbol">}</a>
    <a id="12367" class="Keyword">with</a> <a id="12372" href="/Subtyping/#11750" class="Function">ty-size-pos</a> <a id="12384" class="Symbol">{</a><a id="12385" href="/Subtyping/#12357" class="Bound">A</a><a id="12386" class="Symbol">}</a>
<a id="12388" class="Symbol">...</a> <a id="12392" class="Symbol">|</a> <a id="12394" href="/Subtyping/#12394" class="Bound">pos</a> <a id="12398" class="Keyword">rewrite</a> <a id="12406" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#6284" class="Function">n≤0⇒n≡0</a> <a id="12414" class="Bound">m</a>
    <a id="12420" class="Keyword">with</a> <a id="12425" href="/Subtyping/#12394" class="Bound">pos</a>
<a id="12429" class="Symbol">...</a> <a id="12433" class="Symbol">|</a> <a id="12435" class="Symbol">()</a>
<a id="12438" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12450" class="Symbol">{</a><a id="12451" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="12455" href="/Subtyping/#12455" class="Bound">n</a><a id="12456" class="Symbol">}{</a><a id="12458" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a><a id="12460" class="Symbol">}{</a><a id="12462" href="/Subtyping/#12462" class="Bound">m</a><a id="12463" class="Symbol">}</a> <a id="12465" class="Symbol">=</a> <a id="12467" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a>
<a id="12474" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12486" class="Symbol">{</a><a id="12487" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="12491" href="/Subtyping/#12491" class="Bound">n</a><a id="12492" class="Symbol">}{</a><a id="12494" href="/Subtyping/#12494" class="Bound">A</a> <a id="12496" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="12498" href="/Subtyping/#12498" class="Bound">B</a><a id="12499" class="Symbol">}{</a><a id="12501" href="/Subtyping/#12501" class="Bound">m</a><a id="12502" class="Symbol">}</a> <a id="12504" class="Symbol">=</a>
  <a id="12508" class="Keyword">let</a> <a id="12512" href="/Subtyping/#12512" class="Bound">A&lt;:A</a> <a id="12517" class="Symbol">=</a> <a id="12519" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12531" class="Symbol">{</a><a id="12532" href="/Subtyping/#12491" class="Bound">n</a><a id="12533" class="Symbol">}{</a><a id="12535" href="/Subtyping/#12494" class="Bound">A</a><a id="12536" class="Symbol">}{</a><a id="12538" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#15115" class="Function">m+n≤o⇒m≤o</a> <a id="12548" class="Symbol">_</a> <a id="12550" class="Symbol">(</a><a id="12551" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3355" class="Function">≤-pred</a> <a id="12558" href="/Subtyping/#12501" class="Bound">m</a><a id="12559" class="Symbol">)</a> <a id="12561" class="Symbol">}</a> <a id="12563" class="Keyword">in</a>
  <a id="12568" class="Keyword">let</a> <a id="12572" href="/Subtyping/#12572" class="Bound">B&lt;:B</a> <a id="12577" class="Symbol">=</a> <a id="12579" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12591" class="Symbol">{</a><a id="12592" href="/Subtyping/#12491" class="Bound">n</a><a id="12593" class="Symbol">}{</a><a id="12595" href="/Subtyping/#12498" class="Bound">B</a><a id="12596" class="Symbol">}{</a><a id="12598" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#15250" class="Function">m+n≤o⇒n≤o</a> <a id="12608" class="Symbol">_</a> <a id="12610" class="Symbol">(</a><a id="12611" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3355" class="Function">≤-pred</a> <a id="12618" href="/Subtyping/#12501" class="Bound">m</a><a id="12619" class="Symbol">)</a> <a id="12621" class="Symbol">}</a> <a id="12623" class="Keyword">in</a>
  <a id="12628" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="12635" href="/Subtyping/#12512" class="Bound">A&lt;:A</a> <a id="12640" href="/Subtyping/#12572" class="Bound">B&lt;:B</a>
<a id="12645" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12657" class="Symbol">{</a><a id="12658" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="12662" href="/Subtyping/#12662" class="Bound">n</a><a id="12663" class="Symbol">}{</a><a id="12665" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="12667" href="/Subtyping/#12667" class="Bound">ls</a> <a id="12670" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="12672" href="/Subtyping/#12672" class="Bound">As</a> <a id="12675" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="12677" class="Symbol">{</a><a id="12678" href="/Subtyping/#12678" class="Bound">d</a><a id="12679" class="Symbol">}</a> <a id="12681" class="Symbol">}{</a><a id="12683" href="/Subtyping/#12683" class="Bound">m</a><a id="12684" class="Symbol">}</a> <a id="12686" class="Symbol">=</a> <a id="12688" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="12695" class="Symbol">{</a><a id="12696" class="Argument">d1</a> <a id="12699" class="Symbol">=</a> <a id="12701" href="/Subtyping/#12678" class="Bound">d</a><a id="12702" class="Symbol">}{</a><a id="12704" class="Argument">d2</a> <a id="12707" class="Symbol">=</a> <a id="12709" href="/Subtyping/#12678" class="Bound">d</a><a id="12710" class="Symbol">}</a> <a id="12712" href="/Subtyping/#7216" class="Function">⊆-refl</a> <a id="12719" href="/Subtyping/#12735" class="Function">G</a>
    <a id="12725" class="Keyword">where</a>
    <a id="12735" href="/Subtyping/#12735" class="Function">G</a> <a id="12737" class="Symbol">:</a> <a id="12739" href="/Subtyping/#12667" class="Bound">ls</a> <a id="12742" href="/Subtyping/#10912" class="Function Operator">⦂</a> <a id="12744" href="/Subtyping/#12672" class="Bound">As</a> <a id="12747" href="/Subtyping/#10912" class="Function Operator">&lt;:</a> <a id="12750" href="/Subtyping/#12667" class="Bound">ls</a> <a id="12753" href="/Subtyping/#10912" class="Function Operator">⦂</a> <a id="12755" href="/Subtyping/#12672" class="Bound">As</a>
    <a id="12762" href="/Subtyping/#12735" class="Function">G</a> <a id="12764" class="Symbol">{</a><a id="12765" href="/Subtyping/#12765" class="Bound">i</a><a id="12766" class="Symbol">}{</a><a id="12768" href="/Subtyping/#12768" class="Bound">j</a><a id="12769" class="Symbol">}</a> <a id="12771" href="/Subtyping/#12771" class="Bound">lij</a> <a id="12775" class="Keyword">rewrite</a> <a id="12783" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="12803" class="Symbol">(</a><a id="12804" href="/Subtyping/#6754" class="Function">distinct-relevant</a> <a id="12822" href="/Subtyping/#12678" class="Bound">d</a><a id="12823" class="Symbol">)</a> <a id="12825" href="/Subtyping/#12771" class="Bound">lij</a> <a id="12829" class="Symbol">=</a>
        <a id="12839" class="Keyword">let</a> <a id="12843" href="/Subtyping/#12843" class="Bound">As[i]≤n</a> <a id="12851" class="Symbol">=</a> <a id="12853" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3815" class="Function">≤-trans</a> <a id="12861" class="Symbol">(</a><a id="12862" href="/Subtyping/#11967" class="Function">lookup-vec-ty-size</a> <a id="12881" class="Symbol">{</a><a id="12882" class="Argument">As</a> <a id="12885" class="Symbol">=</a> <a id="12887" href="/Subtyping/#12672" class="Bound">As</a><a id="12889" class="Symbol">}{</a><a id="12891" href="/Subtyping/#12765" class="Bound">i</a><a id="12892" class="Symbol">})</a> <a id="12895" class="Symbol">(</a><a id="12896" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3355" class="Function">≤-pred</a> <a id="12903" href="/Subtyping/#12683" class="Bound">m</a><a id="12904" class="Symbol">)</a> <a id="12906" class="Keyword">in</a>
        <a id="12917" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="12929" class="Symbol">{</a><a id="12930" href="/Subtyping/#12662" class="Bound">n</a><a id="12931" class="Symbol">}{</a><a id="12933" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="12940" href="/Subtyping/#12672" class="Bound">As</a> <a id="12943" href="/Subtyping/#12765" class="Bound">i</a><a id="12944" class="Symbol">}{</a><a id="12946" href="/Subtyping/#12843" class="Bound">As[i]≤n</a><a id="12953" class="Symbol">}</a>
</pre>
<p>The theorem statement uses <code class="language-plaintext highlighter-rouge">n</code> as an upper bound on the size of the type <code class="language-plaintext highlighter-rouge">A</code>
and proceeds by induction on <code class="language-plaintext highlighter-rouge">n</code>.</p>

<ul>
  <li>
    <p>If it is <code class="language-plaintext highlighter-rouge">0</code>, then we have a contradiction because the size of a type is always positive.</p>
  </li>
  <li>
    <p>If it is <code class="language-plaintext highlighter-rouge">suc n</code>, we proceed by cases on the type <code class="language-plaintext highlighter-rouge">A</code>.</p>

    <ul>
      <li>If it is <code class="language-plaintext highlighter-rouge">ℕ</code>, then we have <code class="language-plaintext highlighter-rouge">ℕ &lt;: ℕ</code> by rule <code class="language-plaintext highlighter-rouge">&lt;:-nat</code>.</li>
      <li>If it is <code class="language-plaintext highlighter-rouge">A ⇒ B</code>, then by induction we have <code class="language-plaintext highlighter-rouge">A &lt;: A</code> and <code class="language-plaintext highlighter-rouge">B &lt;: B</code>.
We conclude that <code class="language-plaintext highlighter-rouge">A ⇒ B &lt;: A ⇒ B</code> by rule <code class="language-plaintext highlighter-rouge">&lt;:-fun</code>.</li>
      <li>If it is <code class="language-plaintext highlighter-rouge">｛ ls ⦂ As ｝</code>, then it suffices to prove that
<code class="language-plaintext highlighter-rouge">ls ⊆ ls</code> and <code class="language-plaintext highlighter-rouge">ls ⦂ As &lt;: ls ⦂ As</code>. The former is proved by <code class="language-plaintext highlighter-rouge">⊆-refl</code>.
Regarding the latter, we need to show that for any <code class="language-plaintext highlighter-rouge">i</code> and <code class="language-plaintext highlighter-rouge">j</code>,
<code class="language-plaintext highlighter-rouge">lookup ls j ≡ lookup ls i</code> implies <code class="language-plaintext highlighter-rouge">lookup As j &lt;: lookup As i</code>.
Because <code class="language-plaintext highlighter-rouge">lookup</code> is injective on distinct vectors, we have <code class="language-plaintext highlighter-rouge">i ≡ j</code>.
We then use the induction hypothesis to show that
<code class="language-plaintext highlighter-rouge">lookup As i &lt;: lookup As i</code>, noting that the size of
<code class="language-plaintext highlighter-rouge">lookup As i</code> is less-than-or-equal to the size of <code class="language-plaintext highlighter-rouge">As</code>, which
is one smaller than the size of <code class="language-plaintext highlighter-rouge">｛ ls ⦂ As ｝</code>.</li>
    </ul>
  </li>
</ul>

<p>The following corollary packages up reflexivity for ease of use.</p>
<pre class="Agda"><a id="&lt;:-refl"></a><a id="14050" href="/Subtyping/#14050" class="Function">&lt;:-refl</a> <a id="14058" class="Symbol">:</a> <a id="14060" class="Symbol">∀{</a><a id="14062" href="/Subtyping/#14062" class="Bound">A</a><a id="14063" class="Symbol">}</a> <a id="14065" class="Symbol">→</a> <a id="14067" href="/Subtyping/#14062" class="Bound">A</a> <a id="14069" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="14072" href="/Subtyping/#14062" class="Bound">A</a>
<a id="14074" href="/Subtyping/#14050" class="Function">&lt;:-refl</a> <a id="14082" class="Symbol">{</a><a id="14083" href="/Subtyping/#14083" class="Bound">A</a><a id="14084" class="Symbol">}</a> <a id="14086" class="Symbol">=</a> <a id="14088" href="/Subtyping/#12291" class="Function">&lt;:-refl-aux</a> <a id="14100" class="Symbol">{</a><a id="14101" href="/Subtyping/#11447" class="Function">ty-size</a> <a id="14109" href="/Subtyping/#14083" class="Bound">A</a><a id="14110" class="Symbol">}{</a><a id="14112" href="/Subtyping/#14083" class="Bound">A</a><a id="14113" class="Symbol">}{</a><a id="14115" href="https://agda.github.io/agda-stdlib/v1.1/Data.Nat.Properties.html#3632" class="Function">≤-refl</a><a id="14121" class="Symbol">}</a>
</pre>
<h2 id="subtyping-is-transitive">Subtyping is transitive</h2>

<pre class="Agda"><a id="&lt;:-trans"></a><a id="14160" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14169" class="Symbol">:</a> <a id="14171" class="Symbol">∀{</a><a id="14173" href="/Subtyping/#14173" class="Bound">A</a> <a id="14175" href="/Subtyping/#14175" class="Bound">B</a> <a id="14177" href="/Subtyping/#14177" class="Bound">C</a><a id="14178" class="Symbol">}</a>
    <a id="14184" class="Symbol">→</a> <a id="14186" href="/Subtyping/#14173" class="Bound">A</a> <a id="14188" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="14191" href="/Subtyping/#14175" class="Bound">B</a>   <a id="14195" class="Symbol">→</a>   <a id="14199" href="/Subtyping/#14175" class="Bound">B</a> <a id="14201" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="14204" href="/Subtyping/#14177" class="Bound">C</a>
      <a id="14212" class="Comment">-------------------</a>
    <a id="14236" class="Symbol">→</a> <a id="14238" href="/Subtyping/#14173" class="Bound">A</a> <a id="14240" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="14243" href="/Subtyping/#14177" class="Bound">C</a>
<a id="14245" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14254" class="Symbol">{</a><a id="14255" href="/Subtyping/#14255" class="Bound">A₁</a> <a id="14258" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="14260" href="/Subtyping/#14260" class="Bound">A₂</a><a id="14262" class="Symbol">}</a> <a id="14264" class="Symbol">{</a><a id="14265" href="/Subtyping/#14265" class="Bound">B₁</a> <a id="14268" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="14270" href="/Subtyping/#14270" class="Bound">B₂</a><a id="14272" class="Symbol">}</a> <a id="14274" class="Symbol">{</a><a id="14275" href="/Subtyping/#14275" class="Bound">C₁</a> <a id="14278" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="14280" href="/Subtyping/#14280" class="Bound">C₂</a><a id="14282" class="Symbol">}</a> <a id="14284" class="Symbol">(</a><a id="14285" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="14292" href="/Subtyping/#14292" class="Bound">A₁&lt;:B₁</a> <a id="14299" href="/Subtyping/#14299" class="Bound">A₂&lt;:B₂</a><a id="14305" class="Symbol">)</a> <a id="14307" class="Symbol">(</a><a id="14308" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="14315" href="/Subtyping/#14315" class="Bound">B₁&lt;:C₁</a> <a id="14322" href="/Subtyping/#14322" class="Bound">B₂&lt;:C₂</a><a id="14328" class="Symbol">)</a> <a id="14330" class="Symbol">=</a>
    <a id="14336" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="14343" class="Symbol">(</a><a id="14344" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14353" href="/Subtyping/#14315" class="Bound">B₁&lt;:C₁</a> <a id="14360" href="/Subtyping/#14292" class="Bound">A₁&lt;:B₁</a><a id="14366" class="Symbol">)</a> <a id="14368" class="Symbol">(</a><a id="14369" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14378" href="/Subtyping/#14299" class="Bound">A₂&lt;:B₂</a> <a id="14385" href="/Subtyping/#14322" class="Bound">B₂&lt;:C₂</a><a id="14391" class="Symbol">)</a>
<a id="14393" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14402" class="Symbol">{</a><a id="14403" class="DottedPattern Symbol">.</a><a id="14404" href="/Subtyping/#8416" class="DottedPattern InductiveConstructor">`ℕ</a><a id="14406" class="Symbol">}</a> <a id="14408" class="Symbol">{</a><a id="14409" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a><a id="14411" class="Symbol">}</a> <a id="14413" class="Symbol">{</a><a id="14414" class="DottedPattern Symbol">.</a><a id="14415" href="/Subtyping/#8416" class="DottedPattern InductiveConstructor">`ℕ</a><a id="14417" class="Symbol">}</a> <a id="14419" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a> <a id="14426" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a> <a id="14433" class="Symbol">=</a> <a id="14435" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a>
<a id="14442" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14451" class="Symbol">{</a><a id="14452" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="14454" href="/Subtyping/#14454" class="Bound">ls</a> <a id="14457" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="14459" href="/Subtyping/#14459" class="Bound">As</a> <a id="14462" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a><a id="14463" class="Symbol">{</a><a id="14464" href="/Subtyping/#14464" class="Bound">d1</a><a id="14466" class="Symbol">}</a> <a id="14468" class="Symbol">}</a> <a id="14470" class="Symbol">{</a><a id="14471" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="14473" href="/Subtyping/#14473" class="Bound">ms</a> <a id="14476" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="14478" href="/Subtyping/#14478" class="Bound">Bs</a> <a id="14481" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="14483" class="Symbol">{</a><a id="14484" href="/Subtyping/#14484" class="Bound">d2</a><a id="14486" class="Symbol">}</a> <a id="14488" class="Symbol">}</a> <a id="14490" class="Symbol">{</a><a id="14491" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="14493" href="/Subtyping/#14493" class="Bound">ns</a> <a id="14496" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="14498" href="/Subtyping/#14498" class="Bound">Cs</a> <a id="14501" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="14503" class="Symbol">{</a><a id="14504" href="/Subtyping/#14504" class="Bound">d3</a><a id="14506" class="Symbol">}</a> <a id="14508" class="Symbol">}</a>
    <a id="14514" class="Symbol">(</a><a id="14515" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="14522" href="/Subtyping/#14522" class="Bound">ms⊆ls</a> <a id="14528" href="/Subtyping/#14528" class="Bound">As&lt;:Bs</a><a id="14534" class="Symbol">)</a> <a id="14536" class="Symbol">(</a><a id="14537" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="14544" href="/Subtyping/#14544" class="Bound">ns⊆ms</a> <a id="14550" href="/Subtyping/#14550" class="Bound">Bs&lt;:Cs</a><a id="14556" class="Symbol">)</a> <a id="14558" class="Symbol">=</a>
    <a id="14564" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="14571" class="Symbol">(</a><a id="14572" href="/Subtyping/#7291" class="Function">⊆-trans</a> <a id="14580" href="/Subtyping/#14544" class="Bound">ns⊆ms</a> <a id="14586" href="/Subtyping/#14522" class="Bound">ms⊆ls</a><a id="14591" class="Symbol">)</a> <a id="14593" href="/Subtyping/#14614" class="Function">As&lt;:Cs</a>
    <a id="14604" class="Keyword">where</a>
    <a id="14614" href="/Subtyping/#14614" class="Function">As&lt;:Cs</a> <a id="14621" class="Symbol">:</a> <a id="14623" href="/Subtyping/#14454" class="Bound">ls</a> <a id="14626" href="/Subtyping/#10912" class="Function Operator">⦂</a> <a id="14628" href="/Subtyping/#14459" class="Bound">As</a> <a id="14631" href="/Subtyping/#10912" class="Function Operator">&lt;:</a> <a id="14634" href="/Subtyping/#14493" class="Bound">ns</a> <a id="14637" href="/Subtyping/#10912" class="Function Operator">⦂</a> <a id="14639" href="/Subtyping/#14498" class="Bound">Cs</a>
    <a id="14646" href="/Subtyping/#14614" class="Function">As&lt;:Cs</a> <a id="14653" class="Symbol">{</a><a id="14654" href="/Subtyping/#14654" class="Bound">i</a><a id="14655" class="Symbol">}{</a><a id="14657" href="/Subtyping/#14657" class="Bound">j</a><a id="14658" class="Symbol">}</a> <a id="14660" href="/Subtyping/#14660" class="Bound">ls[j]=ns[i]</a>
        <a id="14680" class="Keyword">with</a> <a id="14685" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="14694" class="Symbol">{</a><a id="14695" class="Argument">i</a> <a id="14697" class="Symbol">=</a> <a id="14699" href="/Subtyping/#14654" class="Bound">i</a><a id="14700" class="Symbol">}</a> <a id="14702" href="/Subtyping/#14544" class="Bound">ns⊆ms</a>
    <a id="14712" class="Symbol">...</a> <a id="14716" class="Symbol">|</a> <a id="14718" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="14720" href="/Subtyping/#14720" class="Bound">k</a> <a id="14722" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14724" href="/Subtyping/#14724" class="Bound">ns[i]=ms[k]</a> <a id="14736" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a> <a id="14738" class="Symbol">=</a>
        <a id="14748" class="Keyword">let</a> <a id="14752" href="/Subtyping/#14752" class="Bound">As[j]&lt;:Bs[k]</a> <a id="14765" class="Symbol">=</a> <a id="14767" href="/Subtyping/#14528" class="Bound">As&lt;:Bs</a> <a id="14774" class="Symbol">{</a><a id="14775" href="/Subtyping/#14720" class="Bound">k</a><a id="14776" class="Symbol">}{</a><a id="14778" class="Bound">j</a><a id="14779" class="Symbol">}</a> <a id="14781" class="Symbol">(</a><a id="14782" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a> <a id="14788" class="Bound">ls[j]=ns[i]</a> <a id="14800" href="/Subtyping/#14724" class="Bound">ns[i]=ms[k]</a><a id="14811" class="Symbol">)</a> <a id="14813" class="Keyword">in</a>
        <a id="14824" class="Keyword">let</a> <a id="14828" href="/Subtyping/#14828" class="Bound">Bs[k]&lt;:Cs[i]</a> <a id="14841" class="Symbol">=</a> <a id="14843" href="/Subtyping/#14550" class="Bound">Bs&lt;:Cs</a> <a id="14850" class="Symbol">{</a><a id="14851" class="Bound">i</a><a id="14852" class="Symbol">}{</a><a id="14854" href="/Subtyping/#14720" class="Bound">k</a><a id="14855" class="Symbol">}</a> <a id="14857" class="Symbol">(</a><a id="14858" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14862" href="/Subtyping/#14724" class="Bound">ns[i]=ms[k]</a><a id="14873" class="Symbol">)</a> <a id="14875" class="Keyword">in</a>
        <a id="14886" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="14895" href="/Subtyping/#14752" class="Bound">As[j]&lt;:Bs[k]</a> <a id="14908" href="/Subtyping/#14828" class="Bound">Bs[k]&lt;:Cs[i]</a>
</pre>
<p>The proof is by induction on the derivations of <code class="language-plaintext highlighter-rouge">A &lt;: B</code> and <code class="language-plaintext highlighter-rouge">B &lt;: C</code>.</p>

<ul>
  <li>
    <p>If both derivations end with <code class="language-plaintext highlighter-rouge">&lt;:-nat</code>: then we immediately conclude that <code class="language-plaintext highlighter-rouge">ℕ &lt;: ℕ</code>.</p>
  </li>
  <li>
    <p>If both derivations end with <code class="language-plaintext highlighter-rouge">&lt;:-fun</code>:
we have <code class="language-plaintext highlighter-rouge">A₁ ⇒ A₂ &lt;: B₁ ⇒ B₂</code> and  <code class="language-plaintext highlighter-rouge">B₁ ⇒ B₂ &lt;: C₁ ⇒ C₂</code>.
So <code class="language-plaintext highlighter-rouge">A₁ &lt;: B₁</code> and <code class="language-plaintext highlighter-rouge">B₁ &lt;: C₁</code>, thus <code class="language-plaintext highlighter-rouge">A₁ &lt;: C₁</code> by the induction hypothesis.
We also have <code class="language-plaintext highlighter-rouge">A₂ &lt;: B₂</code> and <code class="language-plaintext highlighter-rouge">B₂ &lt;: C₂</code>, so by the induction hypothesis
we have <code class="language-plaintext highlighter-rouge">A₂ &lt;: C₂</code>. We conclude that <code class="language-plaintext highlighter-rouge">A₁ ⇒ A₂ &lt;: C₁ ⇒ C₂</code> by rule <code class="language-plaintext highlighter-rouge">&lt;:-fun</code>.</p>
  </li>
  <li>
    <p>If both derivations end with <code class="language-plaintext highlighter-rouge">&lt;:-rcd</code>, so we have
<code class="language-plaintext highlighter-rouge">｛ ls ⦂ As ｝ &lt;: ｛ ms ⦂ Bs ｝</code> and <code class="language-plaintext highlighter-rouge">｛ ms ⦂ Bs ｝ &lt;: ｛ ns ⦂ Cs ｝</code>.
From <code class="language-plaintext highlighter-rouge">ls ⊆ ms</code> and <code class="language-plaintext highlighter-rouge">ms ⊆ ns</code> we have <code class="language-plaintext highlighter-rouge">ls ⊆ ns</code> because <code class="language-plaintext highlighter-rouge">⊆</code> is transitive.
Next we need to prove that <code class="language-plaintext highlighter-rouge">ls ⦂ As &lt;: ns ⦂ Cs</code>.
Suppose <code class="language-plaintext highlighter-rouge">lookup ls j ≡ lookup ns i</code> for an arbitrary <code class="language-plaintext highlighter-rouge">i</code> and <code class="language-plaintext highlighter-rouge">j</code>.
We need to prove that <code class="language-plaintext highlighter-rouge">lookup As j &lt;: lookup Cs i</code>.
By the induction hypothesis, it suffices to show
that <code class="language-plaintext highlighter-rouge">lookup As j &lt;: lookup Bs k</code> and <code class="language-plaintext highlighter-rouge">lookup Bs k &lt;: lookup Cs i</code> for some <code class="language-plaintext highlighter-rouge">k</code>.
We can obtain the former from <code class="language-plaintext highlighter-rouge">｛ ls ⦂ As ｝ &lt;: ｛ ms ⦂ Bs ｝</code>
if we can prove that <code class="language-plaintext highlighter-rouge">lookup ls j ≡ lookup ms k</code>.
We already have <code class="language-plaintext highlighter-rouge">lookup ls j ≡ lookup ns i</code> and we
obtain <code class="language-plaintext highlighter-rouge">lookup ns i ≡ lookup ms k</code> by use of the lemma <code class="language-plaintext highlighter-rouge">lookup-⊆</code>,
noting that <code class="language-plaintext highlighter-rouge">ns ⊆ ms</code>.
We can obtain the later, that <code class="language-plaintext highlighter-rouge">lookup Bs k &lt;: lookup Cs i</code>,
from <code class="language-plaintext highlighter-rouge">｛ ms ⦂ Bs ｝ &lt;: ｛ ns ⦂ Cs ｝</code>.
It suffices to show that <code class="language-plaintext highlighter-rouge">lookup ms k ≡ lookup ns i</code>,
which we have by symmetry.</p>
  </li>
</ul>

<h2 id="contexts">Contexts</h2>

<p>We choose to represent variables with de Bruijn indices, so contexts
are sequences of types.</p>

<pre class="Agda"><a id="16469" class="Keyword">data</a> <a id="Context"></a><a id="16474" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="16482" class="Symbol">:</a> <a id="16484" class="PrimitiveType">Set</a> <a id="16488" class="Keyword">where</a>
  <a id="Context.∅"></a><a id="16496" href="/Subtyping/#16496" class="InductiveConstructor">∅</a>   <a id="16500" class="Symbol">:</a> <a id="16502" href="/Subtyping/#16474" class="Datatype">Context</a>
  <a id="Context._,_"></a><a id="16512" href="/Subtyping/#16512" class="InductiveConstructor Operator">_,_</a> <a id="16516" class="Symbol">:</a> <a id="16518" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="16526" class="Symbol">→</a> <a id="16528" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="16533" class="Symbol">→</a> <a id="16535" href="/Subtyping/#16474" class="Datatype">Context</a>
</pre>
<h2 id="variables-and-the-lookup-judgment">Variables and the lookup judgment</h2>

<p>The lookup judgment is a three-place relation, with a context, a de
Bruijn index, and a type.</p>

<pre class="Agda"><a id="16685" class="Keyword">data</a> <a id="_∋_⦂_"></a><a id="16690" href="/Subtyping/#16690" class="Datatype Operator">_∋_⦂_</a> <a id="16696" class="Symbol">:</a> <a id="16698" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="16706" class="Symbol">→</a> <a id="16708" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="16710" class="Symbol">→</a> <a id="16712" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="16717" class="Symbol">→</a> <a id="16719" class="PrimitiveType">Set</a> <a id="16723" class="Keyword">where</a>

  <a id="_∋_⦂_.Z"></a><a id="16732" href="/Subtyping/#16732" class="InductiveConstructor">Z</a> <a id="16734" class="Symbol">:</a> <a id="16736" class="Symbol">∀</a> <a id="16738" class="Symbol">{</a><a id="16739" href="/Subtyping/#16739" class="Bound">Γ</a> <a id="16741" href="/Subtyping/#16741" class="Bound">A</a><a id="16742" class="Symbol">}</a>
      <a id="16750" class="Comment">------------------</a>
    <a id="16773" class="Symbol">→</a> <a id="16775" href="/Subtyping/#16739" class="Bound">Γ</a> <a id="16777" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="16779" href="/Subtyping/#16741" class="Bound">A</a> <a id="16781" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="16783" class="Number">0</a> <a id="16785" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="16787" href="/Subtyping/#16741" class="Bound">A</a>

  <a id="_∋_⦂_.S"></a><a id="16792" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="16794" class="Symbol">:</a> <a id="16796" class="Symbol">∀</a> <a id="16798" class="Symbol">{</a><a id="16799" href="/Subtyping/#16799" class="Bound">Γ</a> <a id="16801" href="/Subtyping/#16801" class="Bound">x</a> <a id="16803" href="/Subtyping/#16803" class="Bound">A</a> <a id="16805" href="/Subtyping/#16805" class="Bound">B</a><a id="16806" class="Symbol">}</a>
    <a id="16812" class="Symbol">→</a> <a id="16814" href="/Subtyping/#16799" class="Bound">Γ</a> <a id="16816" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="16818" href="/Subtyping/#16801" class="Bound">x</a> <a id="16820" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="16822" href="/Subtyping/#16803" class="Bound">A</a>
      <a id="16830" class="Comment">------------------</a>
    <a id="16853" class="Symbol">→</a> <a id="16855" href="/Subtyping/#16799" class="Bound">Γ</a> <a id="16857" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="16859" href="/Subtyping/#16805" class="Bound">B</a> <a id="16861" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="16863" class="Symbol">(</a><a id="16864" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="16868" href="/Subtyping/#16801" class="Bound">x</a><a id="16869" class="Symbol">)</a> <a id="16871" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="16873" href="/Subtyping/#16803" class="Bound">A</a>
</pre>
<ul>
  <li>
    <p>The index <code class="language-plaintext highlighter-rouge">0</code> has the type at the front of the context.</p>
  </li>
  <li>
    <p>For the index <code class="language-plaintext highlighter-rouge">suc x</code>, we recursively look up its type in the
remaining context <code class="language-plaintext highlighter-rouge">Γ</code>.</p>
  </li>
</ul>

<h2 id="terms-and-the-typing-judgment">Terms and the typing judgment</h2>

<p>As mentioned above, variables are de Bruijn indices, which we
represent with natural numbers.</p>

<pre class="Agda"><a id="Id"></a><a id="17163" href="/Subtyping/#17163" class="Function">Id</a> <a id="17166" class="Symbol">:</a> <a id="17168" class="PrimitiveType">Set</a>
<a id="17172" href="/Subtyping/#17163" class="Function">Id</a> <a id="17175" class="Symbol">=</a> <a id="17177" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a>
</pre>
<p>Our terms are extrinsic, so we define a <code class="language-plaintext highlighter-rouge">Term</code> data type similar to
the one in the <a href="/Lambda/">Lambda</a> chapter, but adapted for de
Bruijn indices.  The two new term constructors are for record creation
and field access.</p>

<pre class="Agda"><a id="17426" class="Keyword">data</a> <a id="Term"></a><a id="17431" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17436" class="Symbol">:</a> <a id="17438" class="PrimitiveType">Set</a> <a id="17442" class="Keyword">where</a>
  <a id="Term.`_"></a><a id="17450" href="/Subtyping/#17450" class="InductiveConstructor Operator">`_</a>                      <a id="17474" class="Symbol">:</a> <a id="17476" href="/Subtyping/#17163" class="Function">Id</a> <a id="17479" class="Symbol">→</a> <a id="17481" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.ƛ_"></a><a id="17488" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ_</a>                      <a id="17512" class="Symbol">:</a> <a id="17514" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17519" class="Symbol">→</a> <a id="17521" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term._·_"></a><a id="17528" href="/Subtyping/#17528" class="InductiveConstructor Operator">_·_</a>                     <a id="17552" class="Symbol">:</a> <a id="17554" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17559" class="Symbol">→</a> <a id="17561" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17566" class="Symbol">→</a> <a id="17568" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.`zero"></a><a id="17575" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a>                   <a id="17599" class="Symbol">:</a> <a id="17601" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.`suc_"></a><a id="17608" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc_</a>                   <a id="17632" class="Symbol">:</a> <a id="17634" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17639" class="Symbol">→</a> <a id="17641" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.case_[zero⇒_|suc⇒_]"></a><a id="17648" href="/Subtyping/#17648" class="InductiveConstructor Operator">case_[zero⇒_|suc⇒_]</a>     <a id="17672" class="Symbol">:</a> <a id="17674" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17679" class="Symbol">→</a> <a id="17681" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17686" class="Symbol">→</a> <a id="17688" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17693" class="Symbol">→</a> <a id="17695" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.μ_"></a><a id="17702" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ_</a>                      <a id="17726" class="Symbol">:</a> <a id="17728" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17733" class="Symbol">→</a> <a id="17735" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term.｛_:=_｝"></a><a id="17742" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛_:=_｝</a>                 <a id="17765" class="Symbol">:</a> <a id="17767" class="Symbol">{</a><a id="17768" href="/Subtyping/#17768" class="Bound">n</a> <a id="17770" class="Symbol">:</a> <a id="17772" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="17773" class="Symbol">}</a> <a id="17775" class="Symbol">(</a><a id="17776" href="/Subtyping/#17776" class="Bound">ls</a> <a id="17779" class="Symbol">:</a> <a id="17781" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="17785" href="/Subtyping/#4606" class="Function">Name</a> <a id="17790" href="/Subtyping/#17768" class="Bound">n</a><a id="17791" class="Symbol">)</a> <a id="17793" class="Symbol">(</a><a id="17794" href="/Subtyping/#17794" class="Bound">Ms</a> <a id="17797" class="Symbol">:</a> <a id="17799" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="17803" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17808" href="/Subtyping/#17768" class="Bound">n</a><a id="17809" class="Symbol">)</a> <a id="17811" class="Symbol">→</a> <a id="17813" href="/Subtyping/#17431" class="Datatype">Term</a>
  <a id="Term._#_"></a><a id="17820" href="/Subtyping/#17820" class="InductiveConstructor Operator">_#_</a>                     <a id="17844" class="Symbol">:</a> <a id="17846" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="17851" class="Symbol">→</a> <a id="17853" href="/Subtyping/#4606" class="Function">Name</a> <a id="17858" class="Symbol">→</a> <a id="17860" href="/Subtyping/#17431" class="Datatype">Term</a>
</pre>
<p>In a record <code class="language-plaintext highlighter-rouge">｛ ls := Ms ｝</code>, we refer to the vector of terms <code class="language-plaintext highlighter-rouge">Ms</code> as
the <em>field initializers</em>.</p>

<p>The typing judgment takes the form <code class="language-plaintext highlighter-rouge">Γ ⊢ M ⦂ A</code> and relies on an
auxiliary judgment <code class="language-plaintext highlighter-rouge">Γ ⊢* Ms ⦂ As</code> for typing a vector of terms.</p>

<pre class="Agda"><a id="18098" class="Keyword">data</a> <a id="_⊢*_⦂_"></a><a id="18103" href="/Subtyping/#18103" class="Datatype Operator">_⊢*_⦂_</a> <a id="18110" class="Symbol">:</a> <a id="18112" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="18120" class="Symbol">→</a> <a id="18122" class="Symbol">∀</a> <a id="18124" class="Symbol">{</a><a id="18125" href="/Subtyping/#18125" class="Bound">n</a><a id="18126" class="Symbol">}</a> <a id="18128" class="Symbol">→</a> <a id="18130" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="18134" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="18139" href="/Subtyping/#18125" class="Bound">n</a> <a id="18141" class="Symbol">→</a> <a id="18143" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="18147" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="18152" href="/Subtyping/#18125" class="Bound">n</a> <a id="18154" class="Symbol">→</a> <a id="18156" class="PrimitiveType">Set</a>

<a id="18161" class="Keyword">data</a> <a id="_⊢_⦂_"></a><a id="18166" href="/Subtyping/#18166" class="Datatype Operator">_⊢_⦂_</a> <a id="18172" class="Symbol">:</a> <a id="18174" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="18182" class="Symbol">→</a> <a id="18184" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="18189" class="Symbol">→</a> <a id="18191" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="18196" class="Symbol">→</a> <a id="18198" class="PrimitiveType">Set</a> <a id="18202" class="Keyword">where</a>

  <a id="_⊢_⦂_.⊢`"></a><a id="18211" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="18214" class="Symbol">:</a> <a id="18216" class="Symbol">∀</a> <a id="18218" class="Symbol">{</a><a id="18219" href="/Subtyping/#18219" class="Bound">Γ</a> <a id="18221" href="/Subtyping/#18221" class="Bound">x</a> <a id="18223" href="/Subtyping/#18223" class="Bound">A</a><a id="18224" class="Symbol">}</a>
    <a id="18230" class="Symbol">→</a> <a id="18232" href="/Subtyping/#18219" class="Bound">Γ</a> <a id="18234" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="18236" href="/Subtyping/#18221" class="Bound">x</a> <a id="18238" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="18240" href="/Subtyping/#18223" class="Bound">A</a>
      <a id="18248" class="Comment">-----------</a>
    <a id="18264" class="Symbol">→</a> <a id="18266" href="/Subtyping/#18219" class="Bound">Γ</a> <a id="18268" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18270" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="18272" href="/Subtyping/#18221" class="Bound">x</a> <a id="18274" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18276" href="/Subtyping/#18223" class="Bound">A</a>

  <a id="_⊢_⦂_.⊢ƛ"></a><a id="18281" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a>  <a id="18285" class="Symbol">:</a> <a id="18287" class="Symbol">∀</a> <a id="18289" class="Symbol">{</a><a id="18290" href="/Subtyping/#18290" class="Bound">Γ</a> <a id="18292" href="/Subtyping/#18292" class="Bound">A</a> <a id="18294" href="/Subtyping/#18294" class="Bound">B</a> <a id="18296" href="/Subtyping/#18296" class="Bound">N</a><a id="18297" class="Symbol">}</a>
    <a id="18303" class="Symbol">→</a> <a id="18305" class="Symbol">(</a><a id="18306" href="/Subtyping/#18290" class="Bound">Γ</a> <a id="18308" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="18310" href="/Subtyping/#18292" class="Bound">A</a><a id="18311" class="Symbol">)</a> <a id="18313" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18315" href="/Subtyping/#18296" class="Bound">N</a> <a id="18317" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18319" href="/Subtyping/#18294" class="Bound">B</a>
      <a id="18327" class="Comment">---------------</a>
    <a id="18347" class="Symbol">→</a> <a id="18349" href="/Subtyping/#18290" class="Bound">Γ</a> <a id="18351" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18353" class="Symbol">(</a><a id="18354" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="18356" href="/Subtyping/#18296" class="Bound">N</a><a id="18357" class="Symbol">)</a> <a id="18359" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18361" href="/Subtyping/#18292" class="Bound">A</a> <a id="18363" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="18365" href="/Subtyping/#18294" class="Bound">B</a>

  <a id="_⊢_⦂_.⊢·"></a><a id="18370" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="18373" class="Symbol">:</a> <a id="18375" class="Symbol">∀</a> <a id="18377" class="Symbol">{</a><a id="18378" href="/Subtyping/#18378" class="Bound">Γ</a> <a id="18380" href="/Subtyping/#18380" class="Bound">A</a> <a id="18382" href="/Subtyping/#18382" class="Bound">B</a> <a id="18384" href="/Subtyping/#18384" class="Bound">L</a> <a id="18386" href="/Subtyping/#18386" class="Bound">M</a><a id="18387" class="Symbol">}</a>
    <a id="18393" class="Symbol">→</a> <a id="18395" href="/Subtyping/#18378" class="Bound">Γ</a> <a id="18397" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18399" href="/Subtyping/#18384" class="Bound">L</a> <a id="18401" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18403" href="/Subtyping/#18380" class="Bound">A</a> <a id="18405" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="18407" href="/Subtyping/#18382" class="Bound">B</a>
    <a id="18413" class="Symbol">→</a> <a id="18415" href="/Subtyping/#18378" class="Bound">Γ</a> <a id="18417" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18419" href="/Subtyping/#18386" class="Bound">M</a> <a id="18421" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18423" href="/Subtyping/#18380" class="Bound">A</a>
      <a id="18431" class="Comment">-------------</a>
    <a id="18449" class="Symbol">→</a> <a id="18451" href="/Subtyping/#18378" class="Bound">Γ</a> <a id="18453" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18455" href="/Subtyping/#18384" class="Bound">L</a> <a id="18457" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="18459" href="/Subtyping/#18386" class="Bound">M</a> <a id="18461" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18463" href="/Subtyping/#18382" class="Bound">B</a>

  <a id="_⊢_⦂_.⊢zero"></a><a id="18468" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a> <a id="18474" class="Symbol">:</a> <a id="18476" class="Symbol">∀</a> <a id="18478" class="Symbol">{</a><a id="18479" href="/Subtyping/#18479" class="Bound">Γ</a><a id="18480" class="Symbol">}</a>
      <a id="18488" class="Comment">--------------</a>
    <a id="18507" class="Symbol">→</a> <a id="18509" href="/Subtyping/#18479" class="Bound">Γ</a> <a id="18511" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18513" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a> <a id="18519" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18521" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>

  <a id="_⊢_⦂_.⊢suc"></a><a id="18527" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="18532" class="Symbol">:</a> <a id="18534" class="Symbol">∀</a> <a id="18536" class="Symbol">{</a><a id="18537" href="/Subtyping/#18537" class="Bound">Γ</a> <a id="18539" href="/Subtyping/#18539" class="Bound">M</a><a id="18540" class="Symbol">}</a>
    <a id="18546" class="Symbol">→</a> <a id="18548" href="/Subtyping/#18537" class="Bound">Γ</a> <a id="18550" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18552" href="/Subtyping/#18539" class="Bound">M</a> <a id="18554" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18556" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>
      <a id="18565" class="Comment">---------------</a>
    <a id="18585" class="Symbol">→</a> <a id="18587" href="/Subtyping/#18537" class="Bound">Γ</a> <a id="18589" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18591" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="18596" href="/Subtyping/#18539" class="Bound">M</a> <a id="18598" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18600" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>

  <a id="_⊢_⦂_.⊢case"></a><a id="18606" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="18612" class="Symbol">:</a> <a id="18614" class="Symbol">∀</a> <a id="18616" class="Symbol">{</a><a id="18617" href="/Subtyping/#18617" class="Bound">Γ</a> <a id="18619" href="/Subtyping/#18619" class="Bound">A</a> <a id="18621" href="/Subtyping/#18621" class="Bound">L</a> <a id="18623" href="/Subtyping/#18623" class="Bound">M</a> <a id="18625" href="/Subtyping/#18625" class="Bound">N</a><a id="18626" class="Symbol">}</a>
    <a id="18632" class="Symbol">→</a> <a id="18634" href="/Subtyping/#18617" class="Bound">Γ</a> <a id="18636" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18638" href="/Subtyping/#18621" class="Bound">L</a> <a id="18640" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18642" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>
    <a id="18649" class="Symbol">→</a> <a id="18651" href="/Subtyping/#18617" class="Bound">Γ</a> <a id="18653" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18655" href="/Subtyping/#18623" class="Bound">M</a> <a id="18657" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18659" href="/Subtyping/#18619" class="Bound">A</a>
    <a id="18665" class="Symbol">→</a> <a id="18667" href="/Subtyping/#18617" class="Bound">Γ</a> <a id="18669" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="18671" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a> <a id="18674" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18676" href="/Subtyping/#18625" class="Bound">N</a> <a id="18678" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18680" href="/Subtyping/#18619" class="Bound">A</a>
      <a id="18688" class="Comment">---------------------------------</a>
    <a id="18726" class="Symbol">→</a> <a id="18728" href="/Subtyping/#18617" class="Bound">Γ</a> <a id="18730" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18732" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="18737" href="/Subtyping/#18621" class="Bound">L</a> <a id="18739" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="18746" href="/Subtyping/#18623" class="Bound">M</a> <a id="18748" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="18754" href="/Subtyping/#18625" class="Bound">N</a> <a id="18756" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a> <a id="18758" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18760" href="/Subtyping/#18619" class="Bound">A</a>

  <a id="_⊢_⦂_.⊢μ"></a><a id="18765" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="18768" class="Symbol">:</a> <a id="18770" class="Symbol">∀</a> <a id="18772" class="Symbol">{</a><a id="18773" href="/Subtyping/#18773" class="Bound">Γ</a> <a id="18775" href="/Subtyping/#18775" class="Bound">A</a> <a id="18777" href="/Subtyping/#18777" class="Bound">M</a><a id="18778" class="Symbol">}</a>
    <a id="18784" class="Symbol">→</a> <a id="18786" href="/Subtyping/#18773" class="Bound">Γ</a> <a id="18788" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="18790" href="/Subtyping/#18775" class="Bound">A</a> <a id="18792" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18794" href="/Subtyping/#18777" class="Bound">M</a> <a id="18796" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18798" href="/Subtyping/#18775" class="Bound">A</a>
      <a id="18806" class="Comment">-------------</a>
    <a id="18824" class="Symbol">→</a> <a id="18826" href="/Subtyping/#18773" class="Bound">Γ</a> <a id="18828" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18830" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="18832" href="/Subtyping/#18777" class="Bound">M</a> <a id="18834" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18836" href="/Subtyping/#18775" class="Bound">A</a>

  <a id="_⊢_⦂_.⊢rcd"></a><a id="18841" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="18846" class="Symbol">:</a> <a id="18848" class="Symbol">∀</a> <a id="18850" class="Symbol">{</a><a id="18851" href="/Subtyping/#18851" class="Bound">Γ</a> <a id="18853" href="/Subtyping/#18853" class="Bound">n</a><a id="18854" class="Symbol">}{</a><a id="18856" href="/Subtyping/#18856" class="Bound">Ms</a> <a id="18859" class="Symbol">:</a> <a id="18861" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="18865" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="18870" href="/Subtyping/#18853" class="Bound">n</a><a id="18871" class="Symbol">}{</a><a id="18873" href="/Subtyping/#18873" class="Bound">As</a> <a id="18876" class="Symbol">:</a> <a id="18878" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="18882" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="18887" href="/Subtyping/#18853" class="Bound">n</a><a id="18888" class="Symbol">}{</a><a id="18890" href="/Subtyping/#18890" class="Bound">ls</a> <a id="18893" class="Symbol">:</a> <a id="18895" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="18899" href="/Subtyping/#4606" class="Function">Name</a> <a id="18904" href="/Subtyping/#18853" class="Bound">n</a><a id="18905" class="Symbol">}</a>
     <a id="18912" class="Symbol">→</a> <a id="18914" href="/Subtyping/#18851" class="Bound">Γ</a> <a id="18916" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="18919" href="/Subtyping/#18856" class="Bound">Ms</a> <a id="18922" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="18924" href="/Subtyping/#18873" class="Bound">As</a>
     <a id="18932" class="Symbol">→</a> <a id="18934" class="Symbol">(</a><a id="18935" href="/Subtyping/#18935" class="Bound">d</a> <a id="18937" class="Symbol">:</a> <a id="18939" href="/Subtyping/#5361" class="Function">distinct</a> <a id="18948" href="/Subtyping/#18890" class="Bound">ls</a><a id="18950" class="Symbol">)</a>
     <a id="18957" class="Symbol">→</a> <a id="18959" href="/Subtyping/#18851" class="Bound">Γ</a> <a id="18961" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="18963" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="18965" href="/Subtyping/#18890" class="Bound">ls</a> <a id="18968" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="18971" href="/Subtyping/#18856" class="Bound">Ms</a> <a id="18974" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a> <a id="18976" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="18978" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="18980" href="/Subtyping/#18890" class="Bound">ls</a> <a id="18983" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="18985" href="/Subtyping/#18873" class="Bound">As</a> <a id="18988" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="18990" class="Symbol">{</a><a id="18991" href="/Subtyping/#18935" class="Bound">d</a><a id="18992" class="Symbol">}</a>


  <a id="_⊢_⦂_.⊢#"></a><a id="18998" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="19001" class="Symbol">:</a> <a id="19003" class="Symbol">∀</a> <a id="19005" class="Symbol">{</a><a id="19006" href="/Subtyping/#19006" class="Bound">n</a> <a id="19008" class="Symbol">:</a> <a id="19010" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="19011" class="Symbol">}{</a><a id="19013" href="/Subtyping/#19013" class="Bound">Γ</a> <a id="19015" href="/Subtyping/#19015" class="Bound">A</a> <a id="19017" href="/Subtyping/#19017" class="Bound">M</a> <a id="19019" href="/Subtyping/#19019" class="Bound">l</a><a id="19020" class="Symbol">}{</a><a id="19022" href="/Subtyping/#19022" class="Bound">ls</a> <a id="19025" class="Symbol">:</a> <a id="19027" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="19031" href="/Subtyping/#4606" class="Function">Name</a> <a id="19036" href="/Subtyping/#19006" class="Bound">n</a><a id="19037" class="Symbol">}{</a><a id="19039" href="/Subtyping/#19039" class="Bound">As</a> <a id="19042" class="Symbol">:</a> <a id="19044" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="19048" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="19053" href="/Subtyping/#19006" class="Bound">n</a><a id="19054" class="Symbol">}{</a><a id="19056" href="/Subtyping/#19056" class="Bound">i</a><a id="19057" class="Symbol">}{</a><a id="19059" href="/Subtyping/#19059" class="Bound">d</a><a id="19060" class="Symbol">}</a>
     <a id="19067" class="Symbol">→</a> <a id="19069" href="/Subtyping/#19013" class="Bound">Γ</a> <a id="19071" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="19073" href="/Subtyping/#19017" class="Bound">M</a> <a id="19075" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="19077" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="19079" href="/Subtyping/#19022" class="Bound">ls</a> <a id="19082" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="19084" href="/Subtyping/#19039" class="Bound">As</a> <a id="19087" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a><a id="19088" class="Symbol">{</a><a id="19089" href="/Subtyping/#19059" class="Bound">d</a><a id="19090" class="Symbol">}</a>
     <a id="19097" class="Symbol">→</a> <a id="19099" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="19106" href="/Subtyping/#19022" class="Bound">ls</a> <a id="19109" href="/Subtyping/#19056" class="Bound">i</a> <a id="19111" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="19113" href="/Subtyping/#19019" class="Bound">l</a>
     <a id="19120" class="Symbol">→</a> <a id="19122" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="19129" href="/Subtyping/#19039" class="Bound">As</a> <a id="19132" href="/Subtyping/#19056" class="Bound">i</a> <a id="19134" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="19136" href="/Subtyping/#19015" class="Bound">A</a>
     <a id="19143" class="Symbol">→</a> <a id="19145" href="/Subtyping/#19013" class="Bound">Γ</a> <a id="19147" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="19149" href="/Subtyping/#19017" class="Bound">M</a> <a id="19151" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="19153" href="/Subtyping/#19019" class="Bound">l</a> <a id="19155" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="19157" href="/Subtyping/#19015" class="Bound">A</a>

  <a id="_⊢_⦂_.⊢&lt;:"></a><a id="19162" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="19166" class="Symbol">:</a> <a id="19168" class="Symbol">∀{</a><a id="19170" href="/Subtyping/#19170" class="Bound">Γ</a> <a id="19172" href="/Subtyping/#19172" class="Bound">M</a> <a id="19174" href="/Subtyping/#19174" class="Bound">A</a> <a id="19176" href="/Subtyping/#19176" class="Bound">B</a><a id="19177" class="Symbol">}</a>
    <a id="19183" class="Symbol">→</a> <a id="19185" href="/Subtyping/#19170" class="Bound">Γ</a> <a id="19187" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="19189" href="/Subtyping/#19172" class="Bound">M</a> <a id="19191" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="19193" href="/Subtyping/#19174" class="Bound">A</a>   <a id="19197" class="Symbol">→</a> <a id="19199" href="/Subtyping/#19174" class="Bound">A</a> <a id="19201" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="19204" href="/Subtyping/#19176" class="Bound">B</a>
      <a id="19212" class="Comment">--------------------</a>
    <a id="19237" class="Symbol">→</a> <a id="19239" href="/Subtyping/#19170" class="Bound">Γ</a> <a id="19241" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="19243" href="/Subtyping/#19172" class="Bound">M</a> <a id="19245" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="19247" href="/Subtyping/#19176" class="Bound">B</a>

<a id="19250" class="Keyword">data</a> <a id="19255" href="/Subtyping/#18103" class="Datatype Operator">_⊢*_⦂_</a> <a id="19262" class="Keyword">where</a>
  <a id="_⊢*_⦂_.⊢*-[]"></a><a id="19270" href="/Subtyping/#19270" class="InductiveConstructor">⊢*-[]</a> <a id="19276" class="Symbol">:</a> <a id="19278" class="Symbol">∀{</a><a id="19280" href="/Subtyping/#19280" class="Bound">Γ</a><a id="19281" class="Symbol">}</a> <a id="19283" class="Symbol">→</a> <a id="19285" href="/Subtyping/#19280" class="Bound">Γ</a> <a id="19287" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="19290" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="19293" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="19295" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a>

  <a id="_⊢*_⦂_.⊢*-∷"></a><a id="19301" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="19306" class="Symbol">:</a> <a id="19308" class="Symbol">∀</a> <a id="19310" class="Symbol">{</a><a id="19311" href="/Subtyping/#19311" class="Bound">n</a><a id="19312" class="Symbol">}{</a><a id="19314" href="/Subtyping/#19314" class="Bound">Γ</a> <a id="19316" href="/Subtyping/#19316" class="Bound">M</a><a id="19317" class="Symbol">}{</a><a id="19319" href="/Subtyping/#19319" class="Bound">Ms</a> <a id="19322" class="Symbol">:</a> <a id="19324" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="19328" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="19333" href="/Subtyping/#19311" class="Bound">n</a><a id="19334" class="Symbol">}{</a><a id="19336" href="/Subtyping/#19336" class="Bound">A</a><a id="19337" class="Symbol">}{</a><a id="19339" href="/Subtyping/#19339" class="Bound">As</a> <a id="19342" class="Symbol">:</a> <a id="19344" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="19348" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="19353" href="/Subtyping/#19311" class="Bound">n</a><a id="19354" class="Symbol">}</a>
     <a id="19361" class="Symbol">→</a> <a id="19363" href="/Subtyping/#19314" class="Bound">Γ</a> <a id="19365" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="19367" href="/Subtyping/#19316" class="Bound">M</a> <a id="19369" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="19371" href="/Subtyping/#19336" class="Bound">A</a>
     <a id="19378" class="Symbol">→</a> <a id="19380" href="/Subtyping/#19314" class="Bound">Γ</a> <a id="19382" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="19385" href="/Subtyping/#19319" class="Bound">Ms</a> <a id="19388" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="19390" href="/Subtyping/#19339" class="Bound">As</a>
     <a id="19398" class="Symbol">→</a> <a id="19400" href="/Subtyping/#19314" class="Bound">Γ</a> <a id="19402" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="19405" class="Symbol">(</a><a id="19406" href="/Subtyping/#19316" class="Bound">M</a> <a id="19408" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="19410" href="/Subtyping/#19319" class="Bound">Ms</a><a id="19412" class="Symbol">)</a> <a id="19414" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="19416" class="Symbol">(</a><a id="19417" href="/Subtyping/#19336" class="Bound">A</a> <a id="19419" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="19421" href="/Subtyping/#19339" class="Bound">As</a><a id="19423" class="Symbol">)</a>
</pre>
<p>Most of the typing rules are adapted from those in the <a href="/Lambda/">Lambda</a>
chapter. Here we discuss the three new rules.</p>

<ul>
  <li>
    <p>Rule <code class="language-plaintext highlighter-rouge">⊢rcd</code>: A record is well-typed if the field initializers <code class="language-plaintext highlighter-rouge">Ms</code>
have types <code class="language-plaintext highlighter-rouge">As</code>, to match the record type. Also, the vector of field
names is required to be distinct.</p>
  </li>
  <li>
    <p>Rule <code class="language-plaintext highlighter-rouge">⊢#</code>: A field access is well-typed if the term <code class="language-plaintext highlighter-rouge">M</code> has record type,
the field <code class="language-plaintext highlighter-rouge">l</code> is at some index <code class="language-plaintext highlighter-rouge">i</code> in the record type’s vector of field names,
and the result type <code class="language-plaintext highlighter-rouge">A</code> is at index <code class="language-plaintext highlighter-rouge">i</code> in the vector of field types.</p>
  </li>
  <li>
    <p>Rule <code class="language-plaintext highlighter-rouge">⊢&lt;:</code>: (Subsumption) If a term <code class="language-plaintext highlighter-rouge">M</code> has type <code class="language-plaintext highlighter-rouge">A</code>, and <code class="language-plaintext highlighter-rouge">A &lt;: B</code>,
then term <code class="language-plaintext highlighter-rouge">M</code> also has type <code class="language-plaintext highlighter-rouge">B</code>.</p>
  </li>
</ul>

<h2 id="renaming-and-substitution">Renaming and Substitution</h2>

<p>In preparation of defining the reduction rules for this language, we
define simultaneous substitution using the same recipe as in the
<a href="/DeBruijn/">DeBruijn</a> chapter, but adapted to extrinsic
terms. Thus, the <code class="language-plaintext highlighter-rouge">subst</code> function is split into two parts: a raw
<code class="language-plaintext highlighter-rouge">subst</code> function that operators on terms and a <code class="language-plaintext highlighter-rouge">subst-pres</code> lemma that
proves that substitution preserves types. We define <code class="language-plaintext highlighter-rouge">subst</code> in this
section and postpone <code class="language-plaintext highlighter-rouge">subst-pres</code> to the
<a href="#subtyping-preservation">Preservation</a> section.  Likewise for <code class="language-plaintext highlighter-rouge">rename</code>.</p>

<p>We begin by defining the <code class="language-plaintext highlighter-rouge">ext</code> function on renamings.</p>
<pre class="Agda"><a id="ext"></a><a id="20698" href="/Subtyping/#20698" class="Function">ext</a> <a id="20702" class="Symbol">:</a> <a id="20704" class="Symbol">(</a><a id="20705" href="/Subtyping/#17163" class="Function">Id</a> <a id="20708" class="Symbol">→</a> <a id="20710" href="/Subtyping/#17163" class="Function">Id</a><a id="20712" class="Symbol">)</a> <a id="20714" class="Symbol">→</a> <a id="20716" class="Symbol">(</a><a id="20717" href="/Subtyping/#17163" class="Function">Id</a> <a id="20720" class="Symbol">→</a> <a id="20722" href="/Subtyping/#17163" class="Function">Id</a><a id="20724" class="Symbol">)</a>
<a id="20726" href="/Subtyping/#20698" class="Function">ext</a> <a id="20730" href="/Subtyping/#20730" class="Bound">ρ</a> <a id="20732" class="Number">0</a>      <a id="20739" class="Symbol">=</a>  <a id="20742" class="Number">0</a>
<a id="20744" href="/Subtyping/#20698" class="Function">ext</a> <a id="20748" href="/Subtyping/#20748" class="Bound">ρ</a> <a id="20750" class="Symbol">(</a><a id="20751" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="20755" href="/Subtyping/#20755" class="Bound">x</a><a id="20756" class="Symbol">)</a>  <a id="20759" class="Symbol">=</a>  <a id="20762" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="20766" class="Symbol">(</a><a id="20767" href="/Subtyping/#20748" class="Bound">ρ</a> <a id="20769" href="/Subtyping/#20755" class="Bound">x</a><a id="20770" class="Symbol">)</a>
</pre>
<p>The <code class="language-plaintext highlighter-rouge">rename</code> function is defined mutually with the auxiliary
<code class="language-plaintext highlighter-rouge">rename-vec</code> function, which is needed in the case for records.</p>
<pre class="Agda"><a id="rename-vec"></a><a id="20906" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="20917" class="Symbol">:</a> <a id="20919" class="Symbol">(</a><a id="20920" href="/Subtyping/#17163" class="Function">Id</a> <a id="20923" class="Symbol">→</a> <a id="20925" href="/Subtyping/#17163" class="Function">Id</a><a id="20927" class="Symbol">)</a> <a id="20929" class="Symbol">→</a> <a id="20931" class="Symbol">∀{</a><a id="20933" href="/Subtyping/#20933" class="Bound">n</a><a id="20934" class="Symbol">}</a> <a id="20936" class="Symbol">→</a> <a id="20938" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="20942" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="20947" href="/Subtyping/#20933" class="Bound">n</a> <a id="20949" class="Symbol">→</a> <a id="20951" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="20955" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="20960" href="/Subtyping/#20933" class="Bound">n</a>

<a id="rename"></a><a id="20963" href="/Subtyping/#20963" class="Function">rename</a> <a id="20970" class="Symbol">:</a> <a id="20972" class="Symbol">(</a><a id="20973" href="/Subtyping/#17163" class="Function">Id</a> <a id="20976" class="Symbol">→</a> <a id="20978" href="/Subtyping/#17163" class="Function">Id</a><a id="20980" class="Symbol">)</a> <a id="20982" class="Symbol">→</a> <a id="20984" class="Symbol">(</a><a id="20985" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="20990" class="Symbol">→</a> <a id="20992" href="/Subtyping/#17431" class="Datatype">Term</a><a id="20996" class="Symbol">)</a>
<a id="20998" href="/Subtyping/#20963" class="Function">rename</a> <a id="21005" href="/Subtyping/#21005" class="Bound">ρ</a> <a id="21007" class="Symbol">(</a><a id="21008" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="21010" href="/Subtyping/#21010" class="Bound">x</a><a id="21011" class="Symbol">)</a>          <a id="21022" class="Symbol">=</a>  <a id="21025" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="21027" class="Symbol">(</a><a id="21028" href="/Subtyping/#21005" class="Bound">ρ</a> <a id="21030" href="/Subtyping/#21010" class="Bound">x</a><a id="21031" class="Symbol">)</a>
<a id="21033" href="/Subtyping/#20963" class="Function">rename</a> <a id="21040" href="/Subtyping/#21040" class="Bound">ρ</a> <a id="21042" class="Symbol">(</a><a id="21043" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="21045" href="/Subtyping/#21045" class="Bound">N</a><a id="21046" class="Symbol">)</a>          <a id="21057" class="Symbol">=</a>  <a id="21060" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="21062" class="Symbol">(</a><a id="21063" href="/Subtyping/#20963" class="Function">rename</a> <a id="21070" class="Symbol">(</a><a id="21071" href="/Subtyping/#20698" class="Function">ext</a> <a id="21075" href="/Subtyping/#21040" class="Bound">ρ</a><a id="21076" class="Symbol">)</a> <a id="21078" href="/Subtyping/#21045" class="Bound">N</a><a id="21079" class="Symbol">)</a>
<a id="21081" href="/Subtyping/#20963" class="Function">rename</a> <a id="21088" href="/Subtyping/#21088" class="Bound">ρ</a> <a id="21090" class="Symbol">(</a><a id="21091" href="/Subtyping/#21091" class="Bound">L</a> <a id="21093" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="21095" href="/Subtyping/#21095" class="Bound">M</a><a id="21096" class="Symbol">)</a>        <a id="21105" class="Symbol">=</a>  <a id="21108" class="Symbol">(</a><a id="21109" href="/Subtyping/#20963" class="Function">rename</a> <a id="21116" href="/Subtyping/#21088" class="Bound">ρ</a> <a id="21118" href="/Subtyping/#21091" class="Bound">L</a><a id="21119" class="Symbol">)</a> <a id="21121" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="21123" class="Symbol">(</a><a id="21124" href="/Subtyping/#20963" class="Function">rename</a> <a id="21131" href="/Subtyping/#21088" class="Bound">ρ</a> <a id="21133" href="/Subtyping/#21095" class="Bound">M</a><a id="21134" class="Symbol">)</a>
<a id="21136" href="/Subtyping/#20963" class="Function">rename</a> <a id="21143" href="/Subtyping/#21143" class="Bound">ρ</a> <a id="21145" class="Symbol">(</a><a id="21146" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a><a id="21151" class="Symbol">)</a>        <a id="21160" class="Symbol">=</a>  <a id="21163" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a>
<a id="21169" href="/Subtyping/#20963" class="Function">rename</a> <a id="21176" href="/Subtyping/#21176" class="Bound">ρ</a> <a id="21178" class="Symbol">(</a><a id="21179" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="21184" href="/Subtyping/#21184" class="Bound">M</a><a id="21185" class="Symbol">)</a>       <a id="21193" class="Symbol">=</a>  <a id="21196" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="21201" class="Symbol">(</a><a id="21202" href="/Subtyping/#20963" class="Function">rename</a> <a id="21209" href="/Subtyping/#21176" class="Bound">ρ</a> <a id="21211" href="/Subtyping/#21184" class="Bound">M</a><a id="21212" class="Symbol">)</a>
<a id="21214" href="/Subtyping/#20963" class="Function">rename</a> <a id="21221" href="/Subtyping/#21221" class="Bound">ρ</a> <a id="21223" class="Symbol">(</a><a id="21224" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="21229" href="/Subtyping/#21229" class="Bound">L</a> <a id="21231" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="21238" href="/Subtyping/#21238" class="Bound">M</a> <a id="21240" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="21246" href="/Subtyping/#21246" class="Bound">N</a> <a id="21248" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a><a id="21249" class="Symbol">)</a> <a id="21251" class="Symbol">=</a>
    <a id="21257" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="21262" class="Symbol">(</a><a id="21263" href="/Subtyping/#20963" class="Function">rename</a> <a id="21270" href="/Subtyping/#21221" class="Bound">ρ</a> <a id="21272" href="/Subtyping/#21229" class="Bound">L</a><a id="21273" class="Symbol">)</a> <a id="21275" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="21282" href="/Subtyping/#20963" class="Function">rename</a> <a id="21289" href="/Subtyping/#21221" class="Bound">ρ</a> <a id="21291" href="/Subtyping/#21238" class="Bound">M</a> <a id="21293" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="21299" href="/Subtyping/#20963" class="Function">rename</a> <a id="21306" class="Symbol">(</a><a id="21307" href="/Subtyping/#20698" class="Function">ext</a> <a id="21311" href="/Subtyping/#21221" class="Bound">ρ</a><a id="21312" class="Symbol">)</a> <a id="21314" href="/Subtyping/#21246" class="Bound">N</a> <a id="21316" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a>
<a id="21318" href="/Subtyping/#20963" class="Function">rename</a> <a id="21325" href="/Subtyping/#21325" class="Bound">ρ</a> <a id="21327" class="Symbol">(</a><a id="21328" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="21330" href="/Subtyping/#21330" class="Bound">N</a><a id="21331" class="Symbol">)</a>          <a id="21342" class="Symbol">=</a>  <a id="21345" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="21347" class="Symbol">(</a><a id="21348" href="/Subtyping/#20963" class="Function">rename</a> <a id="21355" class="Symbol">(</a><a id="21356" href="/Subtyping/#20698" class="Function">ext</a> <a id="21360" href="/Subtyping/#21325" class="Bound">ρ</a><a id="21361" class="Symbol">)</a> <a id="21363" href="/Subtyping/#21330" class="Bound">N</a><a id="21364" class="Symbol">)</a>
<a id="21366" href="/Subtyping/#20963" class="Function">rename</a> <a id="21373" href="/Subtyping/#21373" class="Bound">ρ</a> <a id="21375" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="21377" href="/Subtyping/#21377" class="Bound">ls</a> <a id="21380" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="21383" href="/Subtyping/#21383" class="Bound">Ms</a> <a id="21386" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a> <a id="21388" class="Symbol">=</a> <a id="21390" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="21392" href="/Subtyping/#21377" class="Bound">ls</a> <a id="21395" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="21398" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="21409" href="/Subtyping/#21373" class="Bound">ρ</a> <a id="21411" href="/Subtyping/#21383" class="Bound">Ms</a> <a id="21414" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a>
<a id="21416" href="/Subtyping/#20963" class="Function">rename</a> <a id="21423" href="/Subtyping/#21423" class="Bound">ρ</a> <a id="21425" class="Symbol">(</a><a id="21426" href="/Subtyping/#21426" class="Bound">M</a> <a id="21428" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="21430" href="/Subtyping/#21430" class="Bound">l</a><a id="21431" class="Symbol">)</a>       <a id="21439" class="Symbol">=</a> <a id="21441" class="Symbol">(</a><a id="21442" href="/Subtyping/#20963" class="Function">rename</a> <a id="21449" href="/Subtyping/#21423" class="Bound">ρ</a> <a id="21451" href="/Subtyping/#21426" class="Bound">M</a><a id="21452" class="Symbol">)</a> <a id="21454" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="21456" href="/Subtyping/#21430" class="Bound">l</a>

<a id="21459" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="21470" href="/Subtyping/#21470" class="Bound">ρ</a> <a id="21472" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="21475" class="Symbol">=</a> <a id="21477" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a>
<a id="21480" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="21491" href="/Subtyping/#21491" class="Bound">ρ</a> <a id="21493" class="Symbol">(</a><a id="21494" href="/Subtyping/#21494" class="Bound">M</a> <a id="21496" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="21498" href="/Subtyping/#21498" class="Bound">Ms</a><a id="21500" class="Symbol">)</a> <a id="21502" class="Symbol">=</a> <a id="21504" href="/Subtyping/#20963" class="Function">rename</a> <a id="21511" href="/Subtyping/#21491" class="Bound">ρ</a> <a id="21513" href="/Subtyping/#21494" class="Bound">M</a> <a id="21515" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="21517" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="21528" href="/Subtyping/#21491" class="Bound">ρ</a> <a id="21530" href="/Subtyping/#21498" class="Bound">Ms</a>
</pre>
<p>With the <code class="language-plaintext highlighter-rouge">rename</code> function in hand, we can define the <code class="language-plaintext highlighter-rouge">exts</code> function
on substitutions.</p>
<pre class="Agda"><a id="exts"></a><a id="21630" href="/Subtyping/#21630" class="Function">exts</a> <a id="21635" class="Symbol">:</a> <a id="21637" class="Symbol">(</a><a id="21638" href="/Subtyping/#17163" class="Function">Id</a> <a id="21641" class="Symbol">→</a> <a id="21643" href="/Subtyping/#17431" class="Datatype">Term</a><a id="21647" class="Symbol">)</a> <a id="21649" class="Symbol">→</a> <a id="21651" class="Symbol">(</a><a id="21652" href="/Subtyping/#17163" class="Function">Id</a> <a id="21655" class="Symbol">→</a> <a id="21657" href="/Subtyping/#17431" class="Datatype">Term</a><a id="21661" class="Symbol">)</a>
<a id="21663" href="/Subtyping/#21630" class="Function">exts</a> <a id="21668" href="/Subtyping/#21668" class="Bound">σ</a> <a id="21670" class="Number">0</a>      <a id="21677" class="Symbol">=</a>  <a id="21680" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="21682" class="Number">0</a>
<a id="21684" href="/Subtyping/#21630" class="Function">exts</a> <a id="21689" href="/Subtyping/#21689" class="Bound">σ</a> <a id="21691" class="Symbol">(</a><a id="21692" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="21696" href="/Subtyping/#21696" class="Bound">x</a><a id="21697" class="Symbol">)</a>  <a id="21700" class="Symbol">=</a>  <a id="21703" href="/Subtyping/#20963" class="Function">rename</a> <a id="21710" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="21714" class="Symbol">(</a><a id="21715" href="/Subtyping/#21689" class="Bound">σ</a> <a id="21717" href="/Subtyping/#21696" class="Bound">x</a><a id="21718" class="Symbol">)</a>
</pre>
<p>We define <code class="language-plaintext highlighter-rouge">subst</code> mutually with the auxiliary <code class="language-plaintext highlighter-rouge">subst-vec</code> function,
which is needed in the case for records.</p>
<pre class="Agda"><a id="subst-vec"></a><a id="21838" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="21848" class="Symbol">:</a> <a id="21850" class="Symbol">(</a><a id="21851" href="/Subtyping/#17163" class="Function">Id</a> <a id="21854" class="Symbol">→</a> <a id="21856" href="/Subtyping/#17431" class="Datatype">Term</a><a id="21860" class="Symbol">)</a> <a id="21862" class="Symbol">→</a> <a id="21864" class="Symbol">∀{</a><a id="21866" href="/Subtyping/#21866" class="Bound">n</a><a id="21867" class="Symbol">}</a> <a id="21869" class="Symbol">→</a> <a id="21871" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="21875" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="21880" href="/Subtyping/#21866" class="Bound">n</a> <a id="21882" class="Symbol">→</a> <a id="21884" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="21888" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="21893" href="/Subtyping/#21866" class="Bound">n</a>

<a id="subst"></a><a id="21896" href="/Subtyping/#21896" class="Function">subst</a> <a id="21902" class="Symbol">:</a> <a id="21904" class="Symbol">(</a><a id="21905" href="/Subtyping/#17163" class="Function">Id</a> <a id="21908" class="Symbol">→</a> <a id="21910" href="/Subtyping/#17431" class="Datatype">Term</a><a id="21914" class="Symbol">)</a> <a id="21916" class="Symbol">→</a> <a id="21918" class="Symbol">(</a><a id="21919" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="21924" class="Symbol">→</a> <a id="21926" href="/Subtyping/#17431" class="Datatype">Term</a><a id="21930" class="Symbol">)</a>
<a id="21932" href="/Subtyping/#21896" class="Function">subst</a> <a id="21938" href="/Subtyping/#21938" class="Bound">σ</a> <a id="21940" class="Symbol">(</a><a id="21941" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="21943" href="/Subtyping/#21943" class="Bound">k</a><a id="21944" class="Symbol">)</a>          <a id="21955" class="Symbol">=</a>  <a id="21958" href="/Subtyping/#21938" class="Bound">σ</a> <a id="21960" href="/Subtyping/#21943" class="Bound">k</a>
<a id="21962" href="/Subtyping/#21896" class="Function">subst</a> <a id="21968" href="/Subtyping/#21968" class="Bound">σ</a> <a id="21970" class="Symbol">(</a><a id="21971" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="21973" href="/Subtyping/#21973" class="Bound">N</a><a id="21974" class="Symbol">)</a>          <a id="21985" class="Symbol">=</a>  <a id="21988" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="21990" class="Symbol">(</a><a id="21991" href="/Subtyping/#21896" class="Function">subst</a> <a id="21997" class="Symbol">(</a><a id="21998" href="/Subtyping/#21630" class="Function">exts</a> <a id="22003" href="/Subtyping/#21968" class="Bound">σ</a><a id="22004" class="Symbol">)</a> <a id="22006" href="/Subtyping/#21973" class="Bound">N</a><a id="22007" class="Symbol">)</a>
<a id="22009" href="/Subtyping/#21896" class="Function">subst</a> <a id="22015" href="/Subtyping/#22015" class="Bound">σ</a> <a id="22017" class="Symbol">(</a><a id="22018" href="/Subtyping/#22018" class="Bound">L</a> <a id="22020" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="22022" href="/Subtyping/#22022" class="Bound">M</a><a id="22023" class="Symbol">)</a>        <a id="22032" class="Symbol">=</a>  <a id="22035" class="Symbol">(</a><a id="22036" href="/Subtyping/#21896" class="Function">subst</a> <a id="22042" href="/Subtyping/#22015" class="Bound">σ</a> <a id="22044" href="/Subtyping/#22018" class="Bound">L</a><a id="22045" class="Symbol">)</a> <a id="22047" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="22049" class="Symbol">(</a><a id="22050" href="/Subtyping/#21896" class="Function">subst</a> <a id="22056" href="/Subtyping/#22015" class="Bound">σ</a> <a id="22058" href="/Subtyping/#22022" class="Bound">M</a><a id="22059" class="Symbol">)</a>
<a id="22061" href="/Subtyping/#21896" class="Function">subst</a> <a id="22067" href="/Subtyping/#22067" class="Bound">σ</a> <a id="22069" class="Symbol">(</a><a id="22070" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a><a id="22075" class="Symbol">)</a>        <a id="22084" class="Symbol">=</a>  <a id="22087" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a>
<a id="22093" href="/Subtyping/#21896" class="Function">subst</a> <a id="22099" href="/Subtyping/#22099" class="Bound">σ</a> <a id="22101" class="Symbol">(</a><a id="22102" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="22107" href="/Subtyping/#22107" class="Bound">M</a><a id="22108" class="Symbol">)</a>       <a id="22116" class="Symbol">=</a>  <a id="22119" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="22124" class="Symbol">(</a><a id="22125" href="/Subtyping/#21896" class="Function">subst</a> <a id="22131" href="/Subtyping/#22099" class="Bound">σ</a> <a id="22133" href="/Subtyping/#22107" class="Bound">M</a><a id="22134" class="Symbol">)</a>
<a id="22136" href="/Subtyping/#21896" class="Function">subst</a> <a id="22142" href="/Subtyping/#22142" class="Bound">σ</a> <a id="22144" class="Symbol">(</a><a id="22145" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="22150" href="/Subtyping/#22150" class="Bound">L</a> <a id="22152" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="22159" href="/Subtyping/#22159" class="Bound">M</a> <a id="22161" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="22167" href="/Subtyping/#22167" class="Bound">N</a> <a id="22169" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a><a id="22170" class="Symbol">)</a>
                       <a id="22195" class="Symbol">=</a>  <a id="22198" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="22203" class="Symbol">(</a><a id="22204" href="/Subtyping/#21896" class="Function">subst</a> <a id="22210" href="/Subtyping/#22142" class="Bound">σ</a> <a id="22212" href="/Subtyping/#22150" class="Bound">L</a><a id="22213" class="Symbol">)</a> <a id="22215" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="22222" href="/Subtyping/#21896" class="Function">subst</a> <a id="22228" href="/Subtyping/#22142" class="Bound">σ</a> <a id="22230" href="/Subtyping/#22159" class="Bound">M</a> <a id="22232" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="22238" href="/Subtyping/#21896" class="Function">subst</a> <a id="22244" class="Symbol">(</a><a id="22245" href="/Subtyping/#21630" class="Function">exts</a> <a id="22250" href="/Subtyping/#22142" class="Bound">σ</a><a id="22251" class="Symbol">)</a> <a id="22253" href="/Subtyping/#22167" class="Bound">N</a> <a id="22255" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a>
<a id="22257" href="/Subtyping/#21896" class="Function">subst</a> <a id="22263" href="/Subtyping/#22263" class="Bound">σ</a> <a id="22265" class="Symbol">(</a><a id="22266" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="22268" href="/Subtyping/#22268" class="Bound">N</a><a id="22269" class="Symbol">)</a>          <a id="22280" class="Symbol">=</a>  <a id="22283" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="22285" class="Symbol">(</a><a id="22286" href="/Subtyping/#21896" class="Function">subst</a> <a id="22292" class="Symbol">(</a><a id="22293" href="/Subtyping/#21630" class="Function">exts</a> <a id="22298" href="/Subtyping/#22263" class="Bound">σ</a><a id="22299" class="Symbol">)</a> <a id="22301" href="/Subtyping/#22268" class="Bound">N</a><a id="22302" class="Symbol">)</a>
<a id="22304" href="/Subtyping/#21896" class="Function">subst</a> <a id="22310" href="/Subtyping/#22310" class="Bound">σ</a> <a id="22312" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="22314" href="/Subtyping/#22314" class="Bound">ls</a> <a id="22317" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="22320" href="/Subtyping/#22320" class="Bound">Ms</a> <a id="22323" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a>  <a id="22326" class="Symbol">=</a> <a id="22328" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="22330" href="/Subtyping/#22314" class="Bound">ls</a> <a id="22333" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="22336" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="22346" href="/Subtyping/#22310" class="Bound">σ</a> <a id="22348" href="/Subtyping/#22320" class="Bound">Ms</a> <a id="22351" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a>
<a id="22353" href="/Subtyping/#21896" class="Function">subst</a> <a id="22359" href="/Subtyping/#22359" class="Bound">σ</a> <a id="22361" class="Symbol">(</a><a id="22362" href="/Subtyping/#22362" class="Bound">M</a> <a id="22364" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="22366" href="/Subtyping/#22366" class="Bound">l</a><a id="22367" class="Symbol">)</a>        <a id="22376" class="Symbol">=</a> <a id="22378" class="Symbol">(</a><a id="22379" href="/Subtyping/#21896" class="Function">subst</a> <a id="22385" href="/Subtyping/#22359" class="Bound">σ</a> <a id="22387" href="/Subtyping/#22362" class="Bound">M</a><a id="22388" class="Symbol">)</a> <a id="22390" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="22392" href="/Subtyping/#22366" class="Bound">l</a>

<a id="22395" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="22405" href="/Subtyping/#22405" class="Bound">σ</a> <a id="22407" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a> <a id="22410" class="Symbol">=</a> <a id="22412" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#971" class="InductiveConstructor">[]</a>
<a id="22415" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="22425" href="/Subtyping/#22425" class="Bound">σ</a> <a id="22427" class="Symbol">(</a><a id="22428" href="/Subtyping/#22428" class="Bound">M</a> <a id="22430" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="22432" href="/Subtyping/#22432" class="Bound">Ms</a><a id="22434" class="Symbol">)</a> <a id="22436" class="Symbol">=</a> <a id="22438" class="Symbol">(</a><a id="22439" href="/Subtyping/#21896" class="Function">subst</a> <a id="22445" href="/Subtyping/#22425" class="Bound">σ</a> <a id="22447" href="/Subtyping/#22428" class="Bound">M</a><a id="22448" class="Symbol">)</a> <a id="22450" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#990" class="InductiveConstructor Operator">∷</a> <a id="22452" class="Symbol">(</a><a id="22453" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="22463" href="/Subtyping/#22425" class="Bound">σ</a> <a id="22465" href="/Subtyping/#22432" class="Bound">Ms</a><a id="22467" class="Symbol">)</a>
</pre>
<p>As usual, we implement single substitution using simultaneous
substitution.</p>
<pre class="Agda"><a id="subst-zero"></a><a id="22554" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="22565" class="Symbol">:</a> <a id="22567" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="22572" class="Symbol">→</a> <a id="22574" href="/Subtyping/#17163" class="Function">Id</a> <a id="22577" class="Symbol">→</a> <a id="22579" href="/Subtyping/#17431" class="Datatype">Term</a>
<a id="22584" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="22595" href="/Subtyping/#22595" class="Bound">M</a> <a id="22597" class="Number">0</a>       <a id="22605" class="Symbol">=</a>  <a id="22608" href="/Subtyping/#22595" class="Bound">M</a>
<a id="22610" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="22621" href="/Subtyping/#22621" class="Bound">M</a> <a id="22623" class="Symbol">(</a><a id="22624" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="22628" href="/Subtyping/#22628" class="Bound">x</a><a id="22629" class="Symbol">)</a> <a id="22631" class="Symbol">=</a>  <a id="22634" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="22636" href="/Subtyping/#22628" class="Bound">x</a>

<a id="_[_]"></a><a id="22639" href="/Subtyping/#22639" class="Function Operator">_[_]</a> <a id="22644" class="Symbol">:</a> <a id="22646" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="22651" class="Symbol">→</a> <a id="22653" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="22658" class="Symbol">→</a> <a id="22660" href="/Subtyping/#17431" class="Datatype">Term</a>
<a id="22665" href="/Subtyping/#22639" class="Function Operator">_[_]</a> <a id="22670" href="/Subtyping/#22670" class="Bound">N</a> <a id="22672" href="/Subtyping/#22672" class="Bound">M</a> <a id="22674" class="Symbol">=</a>  <a id="22677" href="/Subtyping/#21896" class="Function">subst</a> <a id="22683" class="Symbol">(</a><a id="22684" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="22695" href="/Subtyping/#22672" class="Bound">M</a><a id="22696" class="Symbol">)</a> <a id="22698" href="/Subtyping/#22670" class="Bound">N</a>
</pre>
<h2 id="values">Values</h2>

<p>We extend the definition of <code class="language-plaintext highlighter-rouge">Value</code> to include a clause for records.
In a call-by-value language, a record is usually only considered a
value if all its field initializers are values. Here we instead treat
records in a lazy fashion, declaring any record to be a value, to save
on some extra bookkeeping.</p>
<pre class="Agda"><a id="23024" class="Keyword">data</a> <a id="Value"></a><a id="23029" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23035" class="Symbol">:</a> <a id="23037" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="23042" class="Symbol">→</a> <a id="23044" class="PrimitiveType">Set</a> <a id="23048" class="Keyword">where</a>

  <a id="Value.V-ƛ"></a><a id="23057" href="/Subtyping/#23057" class="InductiveConstructor">V-ƛ</a> <a id="23061" class="Symbol">:</a> <a id="23063" class="Symbol">∀</a> <a id="23065" class="Symbol">{</a><a id="23066" href="/Subtyping/#23066" class="Bound">N</a><a id="23067" class="Symbol">}</a>
      <a id="23075" class="Comment">-----------</a>
    <a id="23091" class="Symbol">→</a> <a id="23093" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23099" class="Symbol">(</a><a id="23100" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="23102" href="/Subtyping/#23066" class="Bound">N</a><a id="23103" class="Symbol">)</a>

  <a id="Value.V-zero"></a><a id="23108" href="/Subtyping/#23108" class="InductiveConstructor">V-zero</a> <a id="23115" class="Symbol">:</a>
      <a id="23123" class="Comment">-------------</a>
      <a id="23143" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23149" class="Symbol">(</a><a id="23150" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a><a id="23155" class="Symbol">)</a>

  <a id="Value.V-suc"></a><a id="23160" href="/Subtyping/#23160" class="InductiveConstructor">V-suc</a> <a id="23166" class="Symbol">:</a> <a id="23168" class="Symbol">∀</a> <a id="23170" class="Symbol">{</a><a id="23171" href="/Subtyping/#23171" class="Bound">V</a><a id="23172" class="Symbol">}</a>
    <a id="23178" class="Symbol">→</a> <a id="23180" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23186" href="/Subtyping/#23171" class="Bound">V</a>
      <a id="23194" class="Comment">--------------</a>
    <a id="23213" class="Symbol">→</a> <a id="23215" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23221" class="Symbol">(</a><a id="23222" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="23227" href="/Subtyping/#23171" class="Bound">V</a><a id="23228" class="Symbol">)</a>

  <a id="Value.V-rcd"></a><a id="23233" href="/Subtyping/#23233" class="InductiveConstructor">V-rcd</a> <a id="23239" class="Symbol">:</a> <a id="23241" class="Symbol">∀{</a><a id="23243" href="/Subtyping/#23243" class="Bound">n</a><a id="23244" class="Symbol">}{</a><a id="23246" href="/Subtyping/#23246" class="Bound">ls</a> <a id="23249" class="Symbol">:</a> <a id="23251" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="23255" href="/Subtyping/#4606" class="Function">Name</a> <a id="23260" href="/Subtyping/#23243" class="Bound">n</a><a id="23261" class="Symbol">}{</a><a id="23263" href="/Subtyping/#23263" class="Bound">Ms</a> <a id="23266" class="Symbol">:</a> <a id="23268" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="23272" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="23277" href="/Subtyping/#23243" class="Bound">n</a><a id="23278" class="Symbol">}</a>
    <a id="23284" class="Symbol">→</a> <a id="23286" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23292" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="23294" href="/Subtyping/#23246" class="Bound">ls</a> <a id="23297" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="23300" href="/Subtyping/#23263" class="Bound">Ms</a> <a id="23303" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a>
</pre>
<h2 id="reduction">Reduction</h2>

<p>The following datatype <code class="language-plaintext highlighter-rouge">_—→_</code> defines the reduction relation for the
STLC with records. We discuss the two new rules for records in the
following paragraph.</p>

<pre class="Agda"><a id="23486" class="Keyword">data</a> <a id="_—→_"></a><a id="23491" href="/Subtyping/#23491" class="Datatype Operator">_—→_</a> <a id="23496" class="Symbol">:</a> <a id="23498" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="23503" class="Symbol">→</a> <a id="23505" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="23510" class="Symbol">→</a> <a id="23512" class="PrimitiveType">Set</a> <a id="23516" class="Keyword">where</a>

  <a id="_—→_.ξ-·₁"></a><a id="23525" href="/Subtyping/#23525" class="InductiveConstructor">ξ-·₁</a> <a id="23530" class="Symbol">:</a> <a id="23532" class="Symbol">∀</a> <a id="23534" class="Symbol">{</a><a id="23535" href="/Subtyping/#23535" class="Bound">L</a> <a id="23537" href="/Subtyping/#23537" class="Bound">L′</a> <a id="23540" href="/Subtyping/#23540" class="Bound">M</a> <a id="23542" class="Symbol">:</a> <a id="23544" href="/Subtyping/#17431" class="Datatype">Term</a><a id="23548" class="Symbol">}</a>
    <a id="23554" class="Symbol">→</a> <a id="23556" href="/Subtyping/#23535" class="Bound">L</a> <a id="23558" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23561" href="/Subtyping/#23537" class="Bound">L′</a>
      <a id="23570" class="Comment">---------------</a>
    <a id="23590" class="Symbol">→</a> <a id="23592" href="/Subtyping/#23535" class="Bound">L</a> <a id="23594" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="23596" href="/Subtyping/#23540" class="Bound">M</a> <a id="23598" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23601" href="/Subtyping/#23537" class="Bound">L′</a> <a id="23604" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="23606" href="/Subtyping/#23540" class="Bound">M</a>

  <a id="_—→_.ξ-·₂"></a><a id="23611" href="/Subtyping/#23611" class="InductiveConstructor">ξ-·₂</a> <a id="23616" class="Symbol">:</a> <a id="23618" class="Symbol">∀</a> <a id="23620" class="Symbol">{</a><a id="23621" href="/Subtyping/#23621" class="Bound">V</a>  <a id="23624" href="/Subtyping/#23624" class="Bound">M</a> <a id="23626" href="/Subtyping/#23626" class="Bound">M′</a> <a id="23629" class="Symbol">:</a> <a id="23631" href="/Subtyping/#17431" class="Datatype">Term</a><a id="23635" class="Symbol">}</a>
    <a id="23641" class="Symbol">→</a> <a id="23643" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23649" href="/Subtyping/#23621" class="Bound">V</a>
    <a id="23655" class="Symbol">→</a> <a id="23657" href="/Subtyping/#23624" class="Bound">M</a> <a id="23659" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23662" href="/Subtyping/#23626" class="Bound">M′</a>
      <a id="23671" class="Comment">---------------</a>
    <a id="23691" class="Symbol">→</a> <a id="23693" href="/Subtyping/#23621" class="Bound">V</a> <a id="23695" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="23697" href="/Subtyping/#23624" class="Bound">M</a> <a id="23699" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23702" href="/Subtyping/#23621" class="Bound">V</a> <a id="23704" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="23706" href="/Subtyping/#23626" class="Bound">M′</a>

  <a id="_—→_.β-ƛ"></a><a id="23712" href="/Subtyping/#23712" class="InductiveConstructor">β-ƛ</a> <a id="23716" class="Symbol">:</a> <a id="23718" class="Symbol">∀</a> <a id="23720" class="Symbol">{</a><a id="23721" href="/Subtyping/#23721" class="Bound">N</a> <a id="23723" href="/Subtyping/#23723" class="Bound">W</a> <a id="23725" class="Symbol">:</a> <a id="23727" href="/Subtyping/#17431" class="Datatype">Term</a><a id="23731" class="Symbol">}</a>
    <a id="23737" class="Symbol">→</a> <a id="23739" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="23745" href="/Subtyping/#23723" class="Bound">W</a>
      <a id="23753" class="Comment">--------------------</a>
    <a id="23778" class="Symbol">→</a> <a id="23780" class="Symbol">(</a><a id="23781" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="23783" href="/Subtyping/#23721" class="Bound">N</a><a id="23784" class="Symbol">)</a> <a id="23786" href="/Subtyping/#17528" class="InductiveConstructor Operator">·</a> <a id="23788" href="/Subtyping/#23723" class="Bound">W</a> <a id="23790" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23793" href="/Subtyping/#23721" class="Bound">N</a> <a id="23795" href="/Subtyping/#22639" class="Function Operator">[</a> <a id="23797" href="/Subtyping/#23723" class="Bound">W</a> <a id="23799" href="/Subtyping/#22639" class="Function Operator">]</a>

  <a id="_—→_.ξ-suc"></a><a id="23804" href="/Subtyping/#23804" class="InductiveConstructor">ξ-suc</a> <a id="23810" class="Symbol">:</a> <a id="23812" class="Symbol">∀</a> <a id="23814" class="Symbol">{</a><a id="23815" href="/Subtyping/#23815" class="Bound">M</a> <a id="23817" href="/Subtyping/#23817" class="Bound">M′</a> <a id="23820" class="Symbol">:</a> <a id="23822" href="/Subtyping/#17431" class="Datatype">Term</a><a id="23826" class="Symbol">}</a>
    <a id="23832" class="Symbol">→</a> <a id="23834" href="/Subtyping/#23815" class="Bound">M</a> <a id="23836" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23839" href="/Subtyping/#23817" class="Bound">M′</a>
      <a id="23848" class="Comment">-----------------</a>
    <a id="23870" class="Symbol">→</a> <a id="23872" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="23877" href="/Subtyping/#23815" class="Bound">M</a> <a id="23879" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23882" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="23887" href="/Subtyping/#23817" class="Bound">M′</a>

  <a id="_—→_.ξ-case"></a><a id="23893" href="/Subtyping/#23893" class="InductiveConstructor">ξ-case</a> <a id="23900" class="Symbol">:</a> <a id="23902" class="Symbol">∀</a> <a id="23904" class="Symbol">{</a><a id="23905" href="/Subtyping/#23905" class="Bound">L</a> <a id="23907" href="/Subtyping/#23907" class="Bound">L′</a> <a id="23910" href="/Subtyping/#23910" class="Bound">M</a> <a id="23912" href="/Subtyping/#23912" class="Bound">N</a> <a id="23914" class="Symbol">:</a> <a id="23916" href="/Subtyping/#17431" class="Datatype">Term</a><a id="23920" class="Symbol">}</a>
    <a id="23926" class="Symbol">→</a> <a id="23928" href="/Subtyping/#23905" class="Bound">L</a> <a id="23930" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="23933" href="/Subtyping/#23907" class="Bound">L′</a>
      <a id="23942" class="Comment">-------------------------------------------------------</a>
    <a id="24002" class="Symbol">→</a> <a id="24004" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="24009" href="/Subtyping/#23905" class="Bound">L</a> <a id="24011" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="24018" href="/Subtyping/#23910" class="Bound">M</a> <a id="24020" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="24026" href="/Subtyping/#23912" class="Bound">N</a> <a id="24028" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a> <a id="24030" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24033" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="24038" href="/Subtyping/#23907" class="Bound">L′</a> <a id="24041" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="24048" href="/Subtyping/#23910" class="Bound">M</a> <a id="24050" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="24056" href="/Subtyping/#23912" class="Bound">N</a> <a id="24058" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a>

  <a id="_—→_.β-zero"></a><a id="24063" href="/Subtyping/#24063" class="InductiveConstructor">β-zero</a> <a id="24070" class="Symbol">:</a>  <a id="24073" class="Symbol">∀</a> <a id="24075" class="Symbol">{</a><a id="24076" href="/Subtyping/#24076" class="Bound">M</a> <a id="24078" href="/Subtyping/#24078" class="Bound">N</a> <a id="24080" class="Symbol">:</a> <a id="24082" href="/Subtyping/#17431" class="Datatype">Term</a><a id="24086" class="Symbol">}</a>
      <a id="24094" class="Comment">----------------------------------</a>
    <a id="24133" class="Symbol">→</a> <a id="24135" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="24140" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a> <a id="24146" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="24153" href="/Subtyping/#24076" class="Bound">M</a> <a id="24155" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="24161" href="/Subtyping/#24078" class="Bound">N</a> <a id="24163" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a> <a id="24165" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24168" href="/Subtyping/#24076" class="Bound">M</a>

  <a id="_—→_.β-suc"></a><a id="24173" href="/Subtyping/#24173" class="InductiveConstructor">β-suc</a> <a id="24179" class="Symbol">:</a> <a id="24181" class="Symbol">∀</a> <a id="24183" class="Symbol">{</a><a id="24184" href="/Subtyping/#24184" class="Bound">V</a> <a id="24186" href="/Subtyping/#24186" class="Bound">M</a> <a id="24188" href="/Subtyping/#24188" class="Bound">N</a> <a id="24190" class="Symbol">:</a> <a id="24192" href="/Subtyping/#17431" class="Datatype">Term</a><a id="24196" class="Symbol">}</a>
    <a id="24202" class="Symbol">→</a> <a id="24204" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="24210" href="/Subtyping/#24184" class="Bound">V</a>
      <a id="24218" class="Comment">-------------------------------------------</a>
    <a id="24266" class="Symbol">→</a> <a id="24268" href="/Subtyping/#17648" class="InductiveConstructor Operator">case</a> <a id="24273" class="Symbol">(</a><a id="24274" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="24279" href="/Subtyping/#24184" class="Bound">V</a><a id="24280" class="Symbol">)</a> <a id="24282" href="/Subtyping/#17648" class="InductiveConstructor Operator">[zero⇒</a> <a id="24289" href="/Subtyping/#24186" class="Bound">M</a> <a id="24291" href="/Subtyping/#17648" class="InductiveConstructor Operator">|suc⇒</a> <a id="24297" href="/Subtyping/#24188" class="Bound">N</a> <a id="24299" href="/Subtyping/#17648" class="InductiveConstructor Operator">]</a> <a id="24301" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24304" href="/Subtyping/#24188" class="Bound">N</a> <a id="24306" href="/Subtyping/#22639" class="Function Operator">[</a> <a id="24308" href="/Subtyping/#24184" class="Bound">V</a> <a id="24310" href="/Subtyping/#22639" class="Function Operator">]</a>

  <a id="_—→_.β-μ"></a><a id="24315" href="/Subtyping/#24315" class="InductiveConstructor">β-μ</a> <a id="24319" class="Symbol">:</a> <a id="24321" class="Symbol">∀</a> <a id="24323" class="Symbol">{</a><a id="24324" href="/Subtyping/#24324" class="Bound">N</a> <a id="24326" class="Symbol">:</a> <a id="24328" href="/Subtyping/#17431" class="Datatype">Term</a><a id="24332" class="Symbol">}</a>
      <a id="24340" class="Comment">----------------</a>
    <a id="24361" class="Symbol">→</a> <a id="24363" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="24365" href="/Subtyping/#24324" class="Bound">N</a> <a id="24367" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24370" href="/Subtyping/#24324" class="Bound">N</a> <a id="24372" href="/Subtyping/#22639" class="Function Operator">[</a> <a id="24374" href="/Subtyping/#17702" class="InductiveConstructor Operator">μ</a> <a id="24376" href="/Subtyping/#24324" class="Bound">N</a> <a id="24378" href="/Subtyping/#22639" class="Function Operator">]</a>

  <a id="_—→_.ξ-#"></a><a id="24383" href="/Subtyping/#24383" class="InductiveConstructor">ξ-#</a> <a id="24387" class="Symbol">:</a> <a id="24389" class="Symbol">∀</a> <a id="24391" class="Symbol">{</a><a id="24392" href="/Subtyping/#24392" class="Bound">M</a> <a id="24394" href="/Subtyping/#24394" class="Bound">M′</a> <a id="24397" class="Symbol">:</a> <a id="24399" href="/Subtyping/#17431" class="Datatype">Term</a><a id="24403" class="Symbol">}{</a><a id="24405" href="/Subtyping/#24405" class="Bound">l</a><a id="24406" class="Symbol">}</a>
    <a id="24412" class="Symbol">→</a> <a id="24414" href="/Subtyping/#24392" class="Bound">M</a> <a id="24416" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24419" href="/Subtyping/#24394" class="Bound">M′</a>
    <a id="24426" class="Symbol">→</a> <a id="24428" href="/Subtyping/#24392" class="Bound">M</a> <a id="24430" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="24432" href="/Subtyping/#24405" class="Bound">l</a> <a id="24434" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="24437" href="/Subtyping/#24394" class="Bound">M′</a> <a id="24440" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="24442" href="/Subtyping/#24405" class="Bound">l</a>

  <a id="_—→_.β-#"></a><a id="24447" href="/Subtyping/#24447" class="InductiveConstructor">β-#</a> <a id="24451" class="Symbol">:</a> <a id="24453" class="Symbol">∀</a> <a id="24455" class="Symbol">{</a><a id="24456" href="/Subtyping/#24456" class="Bound">n</a><a id="24457" class="Symbol">}{</a><a id="24459" href="/Subtyping/#24459" class="Bound">ls</a> <a id="24462" class="Symbol">:</a> <a id="24464" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="24468" href="/Subtyping/#4606" class="Function">Name</a> <a id="24473" href="/Subtyping/#24456" class="Bound">n</a><a id="24474" class="Symbol">}{</a><a id="24476" href="/Subtyping/#24476" class="Bound">Ms</a> <a id="24479" class="Symbol">:</a> <a id="24481" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="24485" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="24490" href="/Subtyping/#24456" class="Bound">n</a><a id="24491" class="Symbol">}</a> <a id="24493" class="Symbol">{</a><a id="24494" href="/Subtyping/#24494" class="Bound">l</a><a id="24495" class="Symbol">}{</a><a id="24497" href="/Subtyping/#24497" class="Bound">j</a> <a id="24499" class="Symbol">:</a> <a id="24501" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="24505" href="/Subtyping/#24456" class="Bound">n</a><a id="24506" class="Symbol">}</a>
    <a id="24512" class="Symbol">→</a> <a id="24514" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="24521" href="/Subtyping/#24459" class="Bound">ls</a> <a id="24524" href="/Subtyping/#24497" class="Bound">j</a> <a id="24526" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="24528" href="/Subtyping/#24494" class="Bound">l</a>
      <a id="24536" class="Comment">---------------------------------</a>
    <a id="24574" class="Symbol">→</a> <a id="24576" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="24578" href="/Subtyping/#24459" class="Bound">ls</a> <a id="24581" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="24584" href="/Subtyping/#24476" class="Bound">Ms</a> <a id="24587" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a> <a id="24589" href="/Subtyping/#17820" class="InductiveConstructor Operator">#</a> <a id="24591" href="/Subtyping/#24494" class="Bound">l</a> <a id="24593" href="/Subtyping/#23491" class="Datatype Operator">—→</a>  <a id="24597" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="24604" href="/Subtyping/#24476" class="Bound">Ms</a> <a id="24607" href="/Subtyping/#24497" class="Bound">j</a>
</pre>
<p>We have just two new reduction rules:</p>
<ul>
  <li>
    <p>Rule <code class="language-plaintext highlighter-rouge">ξ-#</code>: A field access expression <code class="language-plaintext highlighter-rouge">M # l</code> reduces to <code class="language-plaintext highlighter-rouge">M′ # l</code>
 provided that <code class="language-plaintext highlighter-rouge">M</code> reduces to <code class="language-plaintext highlighter-rouge">M′</code>.</p>
  </li>
  <li>
    <p>Rule <code class="language-plaintext highlighter-rouge">β-#</code>: When field access is applied to a record,
 and if the label <code class="language-plaintext highlighter-rouge">l</code> is at position <code class="language-plaintext highlighter-rouge">j</code> in the vector of field names,
 then result is the term at position <code class="language-plaintext highlighter-rouge">j</code> in the field initializers.</p>
  </li>
</ul>

<h2 id="canonical-forms">Canonical Forms</h2>

<p>As in the <a href="/Properties/">Properties</a> chapter, we
define a <code class="language-plaintext highlighter-rouge">Canonical V ⦂ A</code> relation that characterizes the well-typed
values.  The presence of the subsumption rule impacts its definition
because we must allow the type of the value <code class="language-plaintext highlighter-rouge">V</code> to be a subtype of <code class="language-plaintext highlighter-rouge">A</code>.</p>
<pre class="Agda"><a id="25262" class="Keyword">data</a> <a id="Canonical_⦂_"></a><a id="25267" href="/Subtyping/#25267" class="Datatype Operator">Canonical_⦂_</a> <a id="25280" class="Symbol">:</a> <a id="25282" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="25287" class="Symbol">→</a> <a id="25289" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="25294" class="Symbol">→</a> <a id="25296" class="PrimitiveType">Set</a> <a id="25300" class="Keyword">where</a>

  <a id="Canonical_⦂_.C-ƛ"></a><a id="25309" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="25313" class="Symbol">:</a> <a id="25315" class="Symbol">∀</a> <a id="25317" class="Symbol">{</a><a id="25318" href="/Subtyping/#25318" class="Bound">N</a> <a id="25320" href="/Subtyping/#25320" class="Bound">A</a> <a id="25322" href="/Subtyping/#25322" class="Bound">B</a> <a id="25324" href="/Subtyping/#25324" class="Bound">C</a> <a id="25326" href="/Subtyping/#25326" class="Bound">D</a><a id="25327" class="Symbol">}</a>
    <a id="25333" class="Symbol">→</a>  <a id="25336" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="25338" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="25340" href="/Subtyping/#25320" class="Bound">A</a> <a id="25342" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="25344" href="/Subtyping/#25318" class="Bound">N</a> <a id="25346" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="25348" href="/Subtyping/#25322" class="Bound">B</a>
    <a id="25354" class="Symbol">→</a> <a id="25356" href="/Subtyping/#25320" class="Bound">A</a> <a id="25358" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="25360" href="/Subtyping/#25322" class="Bound">B</a> <a id="25362" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="25365" href="/Subtyping/#25324" class="Bound">C</a> <a id="25367" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="25369" href="/Subtyping/#25326" class="Bound">D</a>
      <a id="25377" class="Comment">-------------------------</a>
    <a id="25407" class="Symbol">→</a> <a id="25409" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25419" class="Symbol">(</a><a id="25420" href="/Subtyping/#17488" class="InductiveConstructor Operator">ƛ</a> <a id="25422" href="/Subtyping/#25318" class="Bound">N</a><a id="25423" class="Symbol">)</a> <a id="25425" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25427" class="Symbol">(</a><a id="25428" href="/Subtyping/#25324" class="Bound">C</a> <a id="25430" href="/Subtyping/#8387" class="InductiveConstructor Operator">⇒</a> <a id="25432" href="/Subtyping/#25326" class="Bound">D</a><a id="25433" class="Symbol">)</a>

  <a id="Canonical_⦂_.C-zero"></a><a id="25438" href="/Subtyping/#25438" class="InductiveConstructor">C-zero</a> <a id="25445" class="Symbol">:</a>
      <a id="25453" class="Comment">--------------------</a>
      <a id="25480" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25490" href="/Subtyping/#17575" class="InductiveConstructor">`zero</a> <a id="25496" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25498" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>

  <a id="Canonical_⦂_.C-suc"></a><a id="25504" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="25510" class="Symbol">:</a> <a id="25512" class="Symbol">∀</a> <a id="25514" class="Symbol">{</a><a id="25515" href="/Subtyping/#25515" class="Bound">V</a><a id="25516" class="Symbol">}</a>
    <a id="25522" class="Symbol">→</a> <a id="25524" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25534" href="/Subtyping/#25515" class="Bound">V</a> <a id="25536" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25538" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>
      <a id="25547" class="Comment">---------------------</a>
    <a id="25573" class="Symbol">→</a> <a id="25575" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25585" href="/Subtyping/#17608" class="InductiveConstructor Operator">`suc</a> <a id="25590" href="/Subtyping/#25515" class="Bound">V</a> <a id="25592" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25594" href="/Subtyping/#8416" class="InductiveConstructor">`ℕ</a>

  <a id="Canonical_⦂_.C-rcd"></a><a id="25600" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="25606" class="Symbol">:</a> <a id="25608" class="Symbol">∀{</a><a id="25610" href="/Subtyping/#25610" class="Bound">n</a> <a id="25612" href="/Subtyping/#25612" class="Bound">m</a><a id="25613" class="Symbol">}{</a><a id="25615" href="/Subtyping/#25615" class="Bound">ls</a> <a id="25618" class="Symbol">:</a> <a id="25620" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="25624" href="/Subtyping/#4606" class="Function">Name</a> <a id="25629" href="/Subtyping/#25610" class="Bound">n</a><a id="25630" class="Symbol">}{</a><a id="25632" href="/Subtyping/#25632" class="Bound">ks</a> <a id="25635" class="Symbol">:</a> <a id="25637" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="25641" href="/Subtyping/#4606" class="Function">Name</a> <a id="25646" href="/Subtyping/#25612" class="Bound">m</a><a id="25647" class="Symbol">}{</a><a id="25649" href="/Subtyping/#25649" class="Bound">Ms</a> <a id="25652" href="/Subtyping/#25652" class="Bound">As</a> <a id="25655" href="/Subtyping/#25655" class="Bound">Bs</a><a id="25657" class="Symbol">}{</a><a id="25659" href="/Subtyping/#25659" class="Bound">dls</a><a id="25662" class="Symbol">}</a>
    <a id="25668" class="Symbol">→</a> <a id="25670" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="25672" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="25675" href="/Subtyping/#25649" class="Bound">Ms</a> <a id="25678" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="25680" href="/Subtyping/#25652" class="Bound">As</a>
    <a id="25687" class="Symbol">→</a> <a id="25689" class="Symbol">(</a><a id="25690" href="/Subtyping/#25690" class="Bound">dks</a> <a id="25694" class="Symbol">:</a> <a id="25696" href="/Subtyping/#5361" class="Function">distinct</a> <a id="25705" href="/Subtyping/#25632" class="Bound">ks</a><a id="25707" class="Symbol">)</a>
    <a id="25713" class="Symbol">→</a> <a id="25715" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="25717" href="/Subtyping/#25632" class="Bound">ks</a> <a id="25720" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="25722" href="/Subtyping/#25652" class="Bound">As</a> <a id="25725" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a><a id="25726" class="Symbol">{</a><a id="25727" href="/Subtyping/#25690" class="Bound">dks</a><a id="25730" class="Symbol">}</a>  <a id="25733" href="/Subtyping/#9216" class="Datatype Operator">&lt;:</a> <a id="25736" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="25738" href="/Subtyping/#25615" class="Bound">ls</a> <a id="25741" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="25743" href="/Subtyping/#25655" class="Bound">Bs</a> <a id="25746" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a><a id="25747" class="Symbol">{</a><a id="25748" href="/Subtyping/#25659" class="Bound">dls</a><a id="25751" class="Symbol">}</a>
    <a id="25757" class="Symbol">→</a> <a id="25759" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25769" href="/Subtyping/#17742" class="InductiveConstructor Operator">｛</a> <a id="25771" href="/Subtyping/#25632" class="Bound">ks</a> <a id="25774" href="/Subtyping/#17742" class="InductiveConstructor Operator">:=</a> <a id="25777" href="/Subtyping/#25649" class="Bound">Ms</a> <a id="25780" href="/Subtyping/#17742" class="InductiveConstructor Operator">｝</a> <a id="25782" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25784" href="/Subtyping/#8431" class="InductiveConstructor Operator">｛</a> <a id="25786" href="/Subtyping/#25615" class="Bound">ls</a> <a id="25789" href="/Subtyping/#8431" class="InductiveConstructor Operator">⦂</a> <a id="25791" href="/Subtyping/#25655" class="Bound">Bs</a> <a id="25794" href="/Subtyping/#8431" class="InductiveConstructor Operator">｝</a> <a id="25796" class="Symbol">{</a><a id="25797" href="/Subtyping/#25659" class="Bound">dls</a><a id="25800" class="Symbol">}</a>
</pre>
<p>Every closed, well-typed value is canonical:</p>
<pre class="Agda"><a id="canonical"></a><a id="25856" href="/Subtyping/#25856" class="Function">canonical</a> <a id="25866" class="Symbol">:</a> <a id="25868" class="Symbol">∀</a> <a id="25870" class="Symbol">{</a><a id="25871" href="/Subtyping/#25871" class="Bound">V</a> <a id="25873" href="/Subtyping/#25873" class="Bound">A</a><a id="25874" class="Symbol">}</a>
  <a id="25878" class="Symbol">→</a> <a id="25880" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="25882" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="25884" href="/Subtyping/#25871" class="Bound">V</a> <a id="25886" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="25888" href="/Subtyping/#25873" class="Bound">A</a>
  <a id="25892" class="Symbol">→</a> <a id="25894" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="25900" href="/Subtyping/#25871" class="Bound">V</a>
    <a id="25906" class="Comment">-----------</a>
  <a id="25920" class="Symbol">→</a> <a id="25922" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="25932" href="/Subtyping/#25871" class="Bound">V</a> <a id="25934" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="25936" href="/Subtyping/#25873" class="Bound">A</a>
<a id="25938" href="/Subtyping/#25856" class="Function">canonical</a> <a id="25948" class="Symbol">(</a><a id="25949" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="25952" class="Symbol">())</a>          <a id="25965" class="Symbol">()</a>
<a id="25968" href="/Subtyping/#25856" class="Function">canonical</a> <a id="25978" class="Symbol">(</a><a id="25979" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="25982" href="/Subtyping/#25982" class="Bound">⊢N</a><a id="25984" class="Symbol">)</a>          <a id="25995" href="/Subtyping/#23057" class="InductiveConstructor">V-ƛ</a>         <a id="26007" class="Symbol">=</a>  <a id="26010" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="26014" href="/Subtyping/#25982" class="Bound">⊢N</a> <a id="26017" href="/Subtyping/#14050" class="Function">&lt;:-refl</a>
<a id="26025" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26035" class="Symbol">(</a><a id="26036" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="26039" href="/Subtyping/#26039" class="Bound">⊢L</a> <a id="26042" href="/Subtyping/#26042" class="Bound">⊢M</a><a id="26044" class="Symbol">)</a>       <a id="26052" class="Symbol">()</a>
<a id="26055" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26065" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>            <a id="26082" href="/Subtyping/#23108" class="InductiveConstructor">V-zero</a>      <a id="26094" class="Symbol">=</a>  <a id="26097" href="/Subtyping/#25438" class="InductiveConstructor">C-zero</a>
<a id="26104" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26114" class="Symbol">(</a><a id="26115" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="26120" href="/Subtyping/#26120" class="Bound">⊢V</a><a id="26122" class="Symbol">)</a>        <a id="26131" class="Symbol">(</a><a id="26132" href="/Subtyping/#23160" class="InductiveConstructor">V-suc</a> <a id="26138" href="/Subtyping/#26138" class="Bound">VV</a><a id="26140" class="Symbol">)</a>  <a id="26143" class="Symbol">=</a>  <a id="26146" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="26152" class="Symbol">(</a><a id="26153" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26163" href="/Subtyping/#26120" class="Bound">⊢V</a> <a id="26166" href="/Subtyping/#26138" class="Bound">VV</a><a id="26168" class="Symbol">)</a>
<a id="26170" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26180" class="Symbol">(</a><a id="26181" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="26187" href="/Subtyping/#26187" class="Bound">⊢L</a> <a id="26190" href="/Subtyping/#26190" class="Bound">⊢M</a> <a id="26193" href="/Subtyping/#26193" class="Bound">⊢N</a><a id="26195" class="Symbol">)</a> <a id="26197" class="Symbol">()</a>
<a id="26200" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26210" class="Symbol">(</a><a id="26211" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="26214" href="/Subtyping/#26214" class="Bound">⊢M</a><a id="26216" class="Symbol">)</a>          <a id="26227" class="Symbol">()</a>
<a id="26230" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26240" class="Symbol">(</a><a id="26241" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="26246" href="/Subtyping/#26246" class="Bound">⊢Ms</a> <a id="26250" href="/Subtyping/#26250" class="Bound">d</a><a id="26251" class="Symbol">)</a> <a id="26253" href="/Subtyping/#26253" class="Bound">VV</a> <a id="26256" class="Symbol">=</a> <a id="26258" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="26264" class="Symbol">{</a><a id="26265" class="Argument">dls</a> <a id="26269" class="Symbol">=</a> <a id="26271" href="/Subtyping/#26250" class="Bound">d</a><a id="26272" class="Symbol">}</a> <a id="26274" href="/Subtyping/#26246" class="Bound">⊢Ms</a> <a id="26278" href="/Subtyping/#26250" class="Bound">d</a> <a id="26280" href="/Subtyping/#14050" class="Function">&lt;:-refl</a>
<a id="26288" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26298" class="Symbol">(</a><a id="26299" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="26303" href="/Subtyping/#26303" class="Bound">⊢V</a> <a id="26306" href="/Subtyping/#9249" class="InductiveConstructor">&lt;:-nat</a><a id="26312" class="Symbol">)</a> <a id="26314" href="/Subtyping/#26314" class="Bound">VV</a> <a id="26317" class="Symbol">=</a> <a id="26319" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26329" href="/Subtyping/#26303" class="Bound">⊢V</a> <a id="26332" href="/Subtyping/#26314" class="Bound">VV</a>
<a id="26335" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26345" class="Symbol">(</a><a id="26346" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="26350" href="/Subtyping/#26350" class="Bound">⊢V</a> <a id="26353" class="Symbol">(</a><a id="26354" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="26361" class="Symbol">{</a><a id="26362" href="/Subtyping/#26362" class="Bound">A</a><a id="26363" class="Symbol">}{</a><a id="26365" href="/Subtyping/#26365" class="Bound">B</a><a id="26366" class="Symbol">}{</a><a id="26368" href="/Subtyping/#26368" class="Bound">C</a><a id="26369" class="Symbol">}{</a><a id="26371" href="/Subtyping/#26371" class="Bound">D</a><a id="26372" class="Symbol">}</a> <a id="26374" href="/Subtyping/#26374" class="Bound">C&lt;:A</a> <a id="26379" href="/Subtyping/#26379" class="Bound">B&lt;:D</a><a id="26383" class="Symbol">))</a> <a id="26386" href="/Subtyping/#26386" class="Bound">VV</a>
    <a id="26393" class="Keyword">with</a> <a id="26398" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26408" href="/Subtyping/#26350" class="Bound">⊢V</a> <a id="26411" href="/Subtyping/#26386" class="Bound">VV</a>
<a id="26414" class="Symbol">...</a> <a id="26418" class="Symbol">|</a> <a id="26420" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="26424" class="Symbol">{</a><a id="26425" href="/Subtyping/#26425" class="Bound">N</a><a id="26426" class="Symbol">}{</a><a id="26428" href="/Subtyping/#26428" class="Bound">A′</a><a id="26430" class="Symbol">}{</a><a id="26432" href="/Subtyping/#26432" class="Bound">B′</a><a id="26434" class="Symbol">}{</a><a id="26436" class="Bound">A</a><a id="26437" class="Symbol">}{</a><a id="26439" class="Bound">B</a><a id="26440" class="Symbol">}</a> <a id="26442" href="/Subtyping/#26442" class="Bound">⊢N</a>  <a id="26446" href="/Subtyping/#26446" class="Bound">AB′&lt;:AB</a> <a id="26454" class="Symbol">=</a> <a id="26456" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="26460" href="/Subtyping/#26442" class="Bound">⊢N</a> <a id="26463" class="Symbol">(</a><a id="26464" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="26473" href="/Subtyping/#26446" class="Bound">AB′&lt;:AB</a> <a id="26481" class="Symbol">(</a><a id="26482" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="26489" class="Bound">C&lt;:A</a> <a id="26494" class="Bound">B&lt;:D</a><a id="26498" class="Symbol">))</a>
<a id="26501" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26511" class="Symbol">(</a><a id="26512" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="26516" href="/Subtyping/#26516" class="Bound">⊢V</a> <a id="26519" class="Symbol">(</a><a id="26520" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="26527" class="Symbol">{</a><a id="26528" class="Argument">ks</a> <a id="26531" class="Symbol">=</a> <a id="26533" href="/Subtyping/#26533" class="Bound">ks</a><a id="26535" class="Symbol">}{</a><a id="26537" class="Argument">ls</a> <a id="26540" class="Symbol">=</a> <a id="26542" href="/Subtyping/#26542" class="Bound">ls</a><a id="26544" class="Symbol">}{</a><a id="26546" class="Argument">d2</a> <a id="26549" class="Symbol">=</a> <a id="26551" href="/Subtyping/#26551" class="Bound">dls</a><a id="26554" class="Symbol">}</a> <a id="26556" href="/Subtyping/#26556" class="Bound">ls⊆ks</a> <a id="26562" href="/Subtyping/#26562" class="Bound">ls⦂Ss&lt;:ks⦂Ts</a><a id="26574" class="Symbol">))</a> <a id="26577" href="/Subtyping/#26577" class="Bound">VV</a>
    <a id="26584" class="Keyword">with</a> <a id="26589" href="/Subtyping/#25856" class="Function">canonical</a> <a id="26599" href="/Subtyping/#26516" class="Bound">⊢V</a> <a id="26602" href="/Subtyping/#26577" class="Bound">VV</a>
<a id="26605" class="Symbol">...</a> <a id="26609" class="Symbol">|</a> <a id="26611" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="26617" class="Symbol">{</a><a id="26618" class="Argument">ks</a> <a id="26621" class="Symbol">=</a> <a id="26623" href="/Subtyping/#26623" class="Bound">ks′</a><a id="26626" class="Symbol">}</a> <a id="26628" href="/Subtyping/#26628" class="Bound">⊢Ms</a> <a id="26632" href="/Subtyping/#26632" class="Bound">dks′</a> <a id="26637" href="/Subtyping/#26637" class="Bound">As&lt;:Ss</a> <a id="26644" class="Symbol">=</a>
      <a id="26652" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="26658" class="Symbol">{</a><a id="26659" class="Argument">dls</a> <a id="26663" class="Symbol">=</a> <a id="26665" href="/Subtyping/#6754" class="Function">distinct-relevant</a> <a id="26683" class="Bound">dls</a><a id="26686" class="Symbol">}</a> <a id="26688" href="/Subtyping/#26628" class="Bound">⊢Ms</a> <a id="26692" href="/Subtyping/#26632" class="Bound">dks′</a> <a id="26697" class="Symbol">(</a><a id="26698" href="/Subtyping/#14160" class="Function">&lt;:-trans</a> <a id="26707" href="/Subtyping/#26637" class="Bound">As&lt;:Ss</a> <a id="26714" class="Symbol">(</a><a id="26715" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="26722" class="Bound">ls⊆ks</a> <a id="26728" class="Bound">ls⦂Ss&lt;:ks⦂Ts</a><a id="26740" class="Symbol">))</a>
</pre>
<p>The case for subsumption (<code class="language-plaintext highlighter-rouge">⊢&lt;:</code>) is interesting. We proceed by
cases on the derivation of subtyping.</p>

<ul>
  <li>
    <p>If the last rule is <code class="language-plaintext highlighter-rouge">&lt;:-nat</code>, then we have <code class="language-plaintext highlighter-rouge">∅ ⊢ V ⦂ ℕ</code>
and the induction hypothesis gives us <code class="language-plaintext highlighter-rouge">Canonical V ⦂ ℕ</code>.</p>
  </li>
  <li>
    <p>If the last rule is <code class="language-plaintext highlighter-rouge">&lt;:-fun</code>, then we have <code class="language-plaintext highlighter-rouge">A ⇒ B &lt;: C ⇒ D</code>
and <code class="language-plaintext highlighter-rouge">∅ ⊢ ƛ N ⦂ A ⇒ B</code>. By the induction hypothesis,
we have <code class="language-plaintext highlighter-rouge">∅ , A′ ⊢ N ⦂ B′</code> and <code class="language-plaintext highlighter-rouge">A′ ⇒ B′ &lt;: A ⇒ B</code> for some <code class="language-plaintext highlighter-rouge">A′</code> and <code class="language-plaintext highlighter-rouge">B′</code>.
We conclude that <code class="language-plaintext highlighter-rouge">Canonical (ƛ N) ⦂ C ⇒ D</code> by rule <code class="language-plaintext highlighter-rouge">C-ƛ</code> and the transitivity of subtyping.</p>
  </li>
  <li>
    <p>If the last rule is <code class="language-plaintext highlighter-rouge">&lt;:-rcd</code>, then we have <code class="language-plaintext highlighter-rouge">｛ ls ⦂ Ss ｝ &lt;: ｛ ks ⦂ Ts ｝</code>
and <code class="language-plaintext highlighter-rouge">∅ ⊢ ｛ ks′ := Ms ｝ ⦂ ｛ ks ⦂ Ss ｝</code>. By the induction hypothesis,
we have <code class="language-plaintext highlighter-rouge">∅ ⊢* Ms ⦂ As</code>, <code class="language-plaintext highlighter-rouge">distinct ks′</code>, and <code class="language-plaintext highlighter-rouge">｛ ks′ ⦂ As ｝ &lt;: ｛ ks ⦂ Ss ｝</code>.
We conclude that <code class="language-plaintext highlighter-rouge">Canonical ｛ ks′ := Ms ｝ ⦂ ｛ ks ⦂ Ts ｝</code>
by rule <code class="language-plaintext highlighter-rouge">C-rcd</code> and the transitivity of subtyping.</p>
  </li>
</ul>

<p>If a term is canonical, then it is also a value.</p>
<pre class="Agda"><a id="value"></a><a id="27640" href="/Subtyping/#27640" class="Function">value</a> <a id="27646" class="Symbol">:</a> <a id="27648" class="Symbol">∀</a> <a id="27650" class="Symbol">{</a><a id="27651" href="/Subtyping/#27651" class="Bound">M</a> <a id="27653" href="/Subtyping/#27653" class="Bound">A</a><a id="27654" class="Symbol">}</a>
  <a id="27658" class="Symbol">→</a> <a id="27660" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="27670" href="/Subtyping/#27651" class="Bound">M</a> <a id="27672" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="27674" href="/Subtyping/#27653" class="Bound">A</a>
    <a id="27680" class="Comment">----------------</a>
  <a id="27699" class="Symbol">→</a> <a id="27701" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="27707" href="/Subtyping/#27651" class="Bound">M</a>
<a id="27709" href="/Subtyping/#27640" class="Function">value</a> <a id="27715" class="Symbol">(</a><a id="27716" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="27720" class="Symbol">_</a> <a id="27722" class="Symbol">_)</a>     <a id="27729" class="Symbol">=</a> <a id="27731" href="/Subtyping/#23057" class="InductiveConstructor">V-ƛ</a>
<a id="27735" href="/Subtyping/#27640" class="Function">value</a> <a id="27741" href="/Subtyping/#25438" class="InductiveConstructor">C-zero</a>        <a id="27755" class="Symbol">=</a> <a id="27757" href="/Subtyping/#23108" class="InductiveConstructor">V-zero</a>
<a id="27764" href="/Subtyping/#27640" class="Function">value</a> <a id="27770" class="Symbol">(</a><a id="27771" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="27777" href="/Subtyping/#27777" class="Bound">CM</a><a id="27779" class="Symbol">)</a>    <a id="27784" class="Symbol">=</a> <a id="27786" href="/Subtyping/#23160" class="InductiveConstructor">V-suc</a> <a id="27792" class="Symbol">(</a><a id="27793" href="/Subtyping/#27640" class="Function">value</a> <a id="27799" href="/Subtyping/#27777" class="Bound">CM</a><a id="27801" class="Symbol">)</a>
<a id="27803" href="/Subtyping/#27640" class="Function">value</a> <a id="27809" class="Symbol">(</a><a id="27810" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="27816" class="Symbol">_</a> <a id="27818" class="Symbol">_</a> <a id="27820" class="Symbol">_)</a> <a id="27823" class="Symbol">=</a> <a id="27825" href="/Subtyping/#23233" class="InductiveConstructor">V-rcd</a>
</pre>
<p>A canonical value is a well-typed value.</p>
<pre class="Agda"><a id="typed"></a><a id="27881" href="/Subtyping/#27881" class="Function">typed</a> <a id="27887" class="Symbol">:</a> <a id="27889" class="Symbol">∀</a> <a id="27891" class="Symbol">{</a><a id="27892" href="/Subtyping/#27892" class="Bound">V</a> <a id="27894" href="/Subtyping/#27894" class="Bound">A</a><a id="27895" class="Symbol">}</a>
  <a id="27899" class="Symbol">→</a> <a id="27901" href="/Subtyping/#25267" class="Datatype Operator">Canonical</a> <a id="27911" href="/Subtyping/#27892" class="Bound">V</a> <a id="27913" href="/Subtyping/#25267" class="Datatype Operator">⦂</a> <a id="27915" href="/Subtyping/#27894" class="Bound">A</a>
    <a id="27921" class="Comment">---------------</a>
  <a id="27939" class="Symbol">→</a> <a id="27941" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="27943" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="27945" href="/Subtyping/#27892" class="Bound">V</a> <a id="27947" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="27949" href="/Subtyping/#27894" class="Bound">A</a>
<a id="27951" href="/Subtyping/#27881" class="Function">typed</a> <a id="27957" class="Symbol">(</a><a id="27958" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="27962" href="/Subtyping/#27962" class="Bound">⊢N</a> <a id="27965" href="/Subtyping/#27965" class="Bound">AB&lt;:CD</a><a id="27971" class="Symbol">)</a> <a id="27973" class="Symbol">=</a> <a id="27975" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="27979" class="Symbol">(</a><a id="27980" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="27983" href="/Subtyping/#27962" class="Bound">⊢N</a><a id="27985" class="Symbol">)</a> <a id="27987" href="/Subtyping/#27965" class="Bound">AB&lt;:CD</a>
<a id="27994" href="/Subtyping/#27881" class="Function">typed</a> <a id="28000" href="/Subtyping/#25438" class="InductiveConstructor">C-zero</a> <a id="28007" class="Symbol">=</a> <a id="28009" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>
<a id="28015" href="/Subtyping/#27881" class="Function">typed</a> <a id="28021" class="Symbol">(</a><a id="28022" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="28028" href="/Subtyping/#28028" class="Bound">c</a><a id="28029" class="Symbol">)</a> <a id="28031" class="Symbol">=</a> <a id="28033" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="28038" class="Symbol">(</a><a id="28039" href="/Subtyping/#27881" class="Function">typed</a> <a id="28045" href="/Subtyping/#28028" class="Bound">c</a><a id="28046" class="Symbol">)</a>
<a id="28048" href="/Subtyping/#27881" class="Function">typed</a> <a id="28054" class="Symbol">(</a><a id="28055" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="28061" href="/Subtyping/#28061" class="Bound">⊢Ms</a> <a id="28065" href="/Subtyping/#28065" class="Bound">dks</a> <a id="28069" href="/Subtyping/#28069" class="Bound">As&lt;:Bs</a><a id="28075" class="Symbol">)</a> <a id="28077" class="Symbol">=</a> <a id="28079" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="28083" class="Symbol">(</a><a id="28084" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="28089" href="/Subtyping/#28061" class="Bound">⊢Ms</a> <a id="28093" href="/Subtyping/#28065" class="Bound">dks</a><a id="28096" class="Symbol">)</a> <a id="28098" href="/Subtyping/#28069" class="Bound">As&lt;:Bs</a>
</pre>
<h2 id="progress-">Progress <a name="subtyping-progress"></a></h2>

<p>The Progress theorem states that a well-typed term may either take a
reduction step or it is already a value. The proof of Progress is like
the one in the <a href="/Properties/">Properties</a>; it
proceeds by induction on the typing derivation and most of the cases
remain the same. Below we discuss the new cases for records and
subsumption.</p>

<pre class="Agda"><a id="28512" class="Keyword">data</a> <a id="Progress"></a><a id="28517" href="/Subtyping/#28517" class="Datatype">Progress</a> <a id="28526" class="Symbol">(</a><a id="28527" href="/Subtyping/#28527" class="Bound">M</a> <a id="28529" class="Symbol">:</a> <a id="28531" href="/Subtyping/#17431" class="Datatype">Term</a><a id="28535" class="Symbol">)</a> <a id="28537" class="Symbol">:</a> <a id="28539" class="PrimitiveType">Set</a> <a id="28543" class="Keyword">where</a>

  <a id="Progress.step"></a><a id="28552" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="28557" class="Symbol">:</a> <a id="28559" class="Symbol">∀</a> <a id="28561" class="Symbol">{</a><a id="28562" href="/Subtyping/#28562" class="Bound">N</a><a id="28563" class="Symbol">}</a>
    <a id="28569" class="Symbol">→</a> <a id="28571" href="/Subtyping/#28527" class="Bound">M</a> <a id="28573" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="28576" href="/Subtyping/#28562" class="Bound">N</a>
      <a id="28584" class="Comment">----------</a>
    <a id="28599" class="Symbol">→</a> <a id="28601" href="/Subtyping/#28517" class="Datatype">Progress</a> <a id="28610" href="/Subtyping/#28527" class="Bound">M</a>

  <a id="Progress.done"></a><a id="28615" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="28620" class="Symbol">:</a>
      <a id="28628" href="/Subtyping/#23029" class="Datatype">Value</a> <a id="28634" href="/Subtyping/#28527" class="Bound">M</a>
      <a id="28642" class="Comment">----------</a>
    <a id="28657" class="Symbol">→</a> <a id="28659" href="/Subtyping/#28517" class="Datatype">Progress</a> <a id="28668" href="/Subtyping/#28527" class="Bound">M</a>
</pre>
<pre class="Agda"><a id="progress"></a><a id="28679" href="/Subtyping/#28679" class="Function">progress</a> <a id="28688" class="Symbol">:</a> <a id="28690" class="Symbol">∀</a> <a id="28692" class="Symbol">{</a><a id="28693" href="/Subtyping/#28693" class="Bound">M</a> <a id="28695" href="/Subtyping/#28695" class="Bound">A</a><a id="28696" class="Symbol">}</a>
  <a id="28700" class="Symbol">→</a> <a id="28702" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="28704" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="28706" href="/Subtyping/#28693" class="Bound">M</a> <a id="28708" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="28710" href="/Subtyping/#28695" class="Bound">A</a>
    <a id="28716" class="Comment">----------</a>
  <a id="28729" class="Symbol">→</a> <a id="28731" href="/Subtyping/#28517" class="Datatype">Progress</a> <a id="28740" href="/Subtyping/#28693" class="Bound">M</a>
<a id="28742" href="/Subtyping/#28679" class="Function">progress</a> <a id="28751" class="Symbol">(</a><a id="28752" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="28755" class="Symbol">())</a>
<a id="28759" href="/Subtyping/#28679" class="Function">progress</a> <a id="28768" class="Symbol">(</a><a id="28769" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="28772" href="/Subtyping/#28772" class="Bound">⊢N</a><a id="28774" class="Symbol">)</a>                            <a id="28803" class="Symbol">=</a> <a id="28805" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="28810" href="/Subtyping/#23057" class="InductiveConstructor">V-ƛ</a>
<a id="28814" href="/Subtyping/#28679" class="Function">progress</a> <a id="28823" class="Symbol">(</a><a id="28824" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="28827" href="/Subtyping/#28827" class="Bound">⊢L</a> <a id="28830" href="/Subtyping/#28830" class="Bound">⊢M</a><a id="28832" class="Symbol">)</a>
    <a id="28838" class="Keyword">with</a> <a id="28843" href="/Subtyping/#28679" class="Function">progress</a> <a id="28852" href="/Subtyping/#28827" class="Bound">⊢L</a>
<a id="28855" class="Symbol">...</a> <a id="28859" class="Symbol">|</a> <a id="28861" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="28866" href="/Subtyping/#28866" class="Bound">L—→L′</a>                            <a id="28899" class="Symbol">=</a> <a id="28901" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="28906" class="Symbol">(</a><a id="28907" href="/Subtyping/#23525" class="InductiveConstructor">ξ-·₁</a> <a id="28912" href="/Subtyping/#28866" class="Bound">L—→L′</a><a id="28917" class="Symbol">)</a>
<a id="28919" class="Symbol">...</a> <a id="28923" class="Symbol">|</a> <a id="28925" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="28930" href="/Subtyping/#28930" class="Bound">VL</a>
        <a id="28941" class="Keyword">with</a> <a id="28946" href="/Subtyping/#28679" class="Function">progress</a> <a id="28955" class="Bound">⊢M</a>
<a id="28958" class="Symbol">...</a>     <a id="28966" class="Symbol">|</a> <a id="28968" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="28973" href="/Subtyping/#28973" class="Bound">M—→M′</a>                        <a id="29002" class="Symbol">=</a> <a id="29004" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29009" class="Symbol">(</a><a id="29010" href="/Subtyping/#23611" class="InductiveConstructor">ξ-·₂</a> <a id="29015" class="Bound">VL</a> <a id="29018" href="/Subtyping/#28973" class="Bound">M—→M′</a><a id="29023" class="Symbol">)</a>
<a id="29025" class="Symbol">...</a>     <a id="29033" class="Symbol">|</a> <a id="29035" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29040" href="/Subtyping/#29040" class="Bound">VM</a>
        <a id="29051" class="Keyword">with</a> <a id="29056" href="/Subtyping/#25856" class="Function">canonical</a> <a id="29066" class="Bound">⊢L</a> <a id="29069" class="Bound">VL</a>
<a id="29072" class="Symbol">...</a>     <a id="29080" class="Symbol">|</a> <a id="29082" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="29086" href="/Subtyping/#29086" class="Bound">⊢N</a> <a id="29089" class="Symbol">_</a>                          <a id="29116" class="Symbol">=</a> <a id="29118" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29123" class="Symbol">(</a><a id="29124" href="/Subtyping/#23712" class="InductiveConstructor">β-ƛ</a> <a id="29128" class="Bound">VM</a><a id="29130" class="Symbol">)</a>
<a id="29132" href="/Subtyping/#28679" class="Function">progress</a> <a id="29141" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>                              <a id="29176" class="Symbol">=</a>  <a id="29179" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29184" href="/Subtyping/#23108" class="InductiveConstructor">V-zero</a>
<a id="29191" href="/Subtyping/#28679" class="Function">progress</a> <a id="29200" class="Symbol">(</a><a id="29201" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="29206" href="/Subtyping/#29206" class="Bound">⊢M</a><a id="29208" class="Symbol">)</a> <a id="29210" class="Keyword">with</a> <a id="29215" href="/Subtyping/#28679" class="Function">progress</a> <a id="29224" href="/Subtyping/#29206" class="Bound">⊢M</a>
<a id="29227" class="Symbol">...</a>  <a id="29232" class="Symbol">|</a> <a id="29234" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29239" href="/Subtyping/#29239" class="Bound">M—→M′</a>                           <a id="29271" class="Symbol">=</a>  <a id="29274" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29279" class="Symbol">(</a><a id="29280" href="/Subtyping/#23804" class="InductiveConstructor">ξ-suc</a> <a id="29286" href="/Subtyping/#29239" class="Bound">M—→M′</a><a id="29291" class="Symbol">)</a>
<a id="29293" class="Symbol">...</a>  <a id="29298" class="Symbol">|</a> <a id="29300" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29305" href="/Subtyping/#29305" class="Bound">VM</a>                              <a id="29337" class="Symbol">=</a>  <a id="29340" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29345" class="Symbol">(</a><a id="29346" href="/Subtyping/#23160" class="InductiveConstructor">V-suc</a> <a id="29352" href="/Subtyping/#29305" class="Bound">VM</a><a id="29354" class="Symbol">)</a>
<a id="29356" href="/Subtyping/#28679" class="Function">progress</a> <a id="29365" class="Symbol">(</a><a id="29366" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="29372" href="/Subtyping/#29372" class="Bound">⊢L</a> <a id="29375" href="/Subtyping/#29375" class="Bound">⊢M</a> <a id="29378" href="/Subtyping/#29378" class="Bound">⊢N</a><a id="29380" class="Symbol">)</a> <a id="29382" class="Keyword">with</a> <a id="29387" href="/Subtyping/#28679" class="Function">progress</a> <a id="29396" href="/Subtyping/#29372" class="Bound">⊢L</a>
<a id="29399" class="Symbol">...</a> <a id="29403" class="Symbol">|</a> <a id="29405" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29410" href="/Subtyping/#29410" class="Bound">L—→L′</a>                            <a id="29443" class="Symbol">=</a>  <a id="29446" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29451" class="Symbol">(</a><a id="29452" href="/Subtyping/#23893" class="InductiveConstructor">ξ-case</a> <a id="29459" href="/Subtyping/#29410" class="Bound">L—→L′</a><a id="29464" class="Symbol">)</a>
<a id="29466" class="Symbol">...</a> <a id="29470" class="Symbol">|</a> <a id="29472" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29477" href="/Subtyping/#29477" class="Bound">VL</a> <a id="29480" class="Keyword">with</a> <a id="29485" href="/Subtyping/#25856" class="Function">canonical</a> <a id="29495" class="Bound">⊢L</a> <a id="29498" href="/Subtyping/#29477" class="Bound">VL</a>
<a id="29501" class="Symbol">...</a>   <a id="29507" class="Symbol">|</a> <a id="29509" href="/Subtyping/#25438" class="InductiveConstructor">C-zero</a>                              <a id="29545" class="Symbol">=</a>  <a id="29548" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29553" href="/Subtyping/#24063" class="InductiveConstructor">β-zero</a>
<a id="29560" class="Symbol">...</a>   <a id="29566" class="Symbol">|</a> <a id="29568" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="29574" href="/Subtyping/#29574" class="Bound">CL</a>                            <a id="29604" class="Symbol">=</a>  <a id="29607" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29612" class="Symbol">(</a><a id="29613" href="/Subtyping/#24173" class="InductiveConstructor">β-suc</a> <a id="29619" class="Symbol">(</a><a id="29620" href="/Subtyping/#27640" class="Function">value</a> <a id="29626" href="/Subtyping/#29574" class="Bound">CL</a><a id="29628" class="Symbol">))</a>
<a id="29631" href="/Subtyping/#28679" class="Function">progress</a> <a id="29640" class="Symbol">(</a><a id="29641" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="29644" href="/Subtyping/#29644" class="Bound">⊢M</a><a id="29646" class="Symbol">)</a>                            <a id="29675" class="Symbol">=</a>  <a id="29678" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29683" href="/Subtyping/#24315" class="InductiveConstructor">β-μ</a>
<a id="29687" href="/Subtyping/#28679" class="Function">progress</a> <a id="29696" class="Symbol">(</a><a id="29697" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="29700" class="Symbol">{</a><a id="29701" href="/Subtyping/#29701" class="Bound">n</a><a id="29702" class="Symbol">}{</a><a id="29704" href="/Subtyping/#29704" class="Bound">Γ</a><a id="29705" class="Symbol">}{</a><a id="29707" href="/Subtyping/#29707" class="Bound">A</a><a id="29708" class="Symbol">}{</a><a id="29710" href="/Subtyping/#29710" class="Bound">M</a><a id="29711" class="Symbol">}{</a><a id="29713" href="/Subtyping/#29713" class="Bound">l</a><a id="29714" class="Symbol">}{</a><a id="29716" href="/Subtyping/#29716" class="Bound">ls</a><a id="29718" class="Symbol">}{</a><a id="29720" href="/Subtyping/#29720" class="Bound">As</a><a id="29722" class="Symbol">}{</a><a id="29724" href="/Subtyping/#29724" class="Bound">i</a><a id="29725" class="Symbol">}{</a><a id="29727" href="/Subtyping/#29727" class="Bound">d</a><a id="29728" class="Symbol">}</a> <a id="29730" href="/Subtyping/#29730" class="Bound">⊢M</a> <a id="29733" href="/Subtyping/#29733" class="Bound">ls[i]=l</a> <a id="29741" href="/Subtyping/#29741" class="Bound">As[i]=A</a><a id="29748" class="Symbol">)</a>
    <a id="29754" class="Keyword">with</a> <a id="29759" href="/Subtyping/#28679" class="Function">progress</a> <a id="29768" href="/Subtyping/#29730" class="Bound">⊢M</a>
<a id="29771" class="Symbol">...</a> <a id="29775" class="Symbol">|</a> <a id="29777" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29782" href="/Subtyping/#29782" class="Bound">M—→M′</a>                            <a id="29815" class="Symbol">=</a>  <a id="29818" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="29823" class="Symbol">(</a><a id="29824" href="/Subtyping/#24383" class="InductiveConstructor">ξ-#</a> <a id="29828" href="/Subtyping/#29782" class="Bound">M—→M′</a><a id="29833" class="Symbol">)</a>
<a id="29835" class="Symbol">...</a> <a id="29839" class="Symbol">|</a> <a id="29841" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="29846" href="/Subtyping/#29846" class="Bound">VM</a>
    <a id="29853" class="Keyword">with</a> <a id="29858" href="/Subtyping/#25856" class="Function">canonical</a> <a id="29868" class="Bound">⊢M</a> <a id="29871" href="/Subtyping/#29846" class="Bound">VM</a>
<a id="29874" class="Symbol">...</a> <a id="29878" class="Symbol">|</a> <a id="29880" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="29886" class="Symbol">{</a><a id="29887" class="Argument">ks</a> <a id="29890" class="Symbol">=</a> <a id="29892" href="/Subtyping/#29892" class="Bound">ms</a><a id="29894" class="Symbol">}{</a><a id="29896" class="Argument">As</a> <a id="29899" class="Symbol">=</a> <a id="29901" href="/Subtyping/#29901" class="Bound">Bs</a><a id="29903" class="Symbol">}</a> <a id="29905" href="/Subtyping/#29905" class="Bound">⊢Ms</a> <a id="29909" class="Symbol">_</a> <a id="29911" class="Symbol">(</a><a id="29912" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="29919" href="/Subtyping/#29919" class="Bound">ls⊆ms</a> <a id="29925" class="Symbol">_)</a>
    <a id="29932" class="Keyword">with</a> <a id="29937" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="29946" class="Symbol">{</a><a id="29947" class="Argument">i</a> <a id="29949" class="Symbol">=</a> <a id="29951" class="Bound">i</a><a id="29952" class="Symbol">}</a> <a id="29954" href="/Subtyping/#29919" class="Bound">ls⊆ms</a>
<a id="29960" class="Symbol">...</a> <a id="29964" class="Symbol">|</a> <a id="29966" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="29968" href="/Subtyping/#29968" class="Bound">k</a> <a id="29970" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="29972" href="/Subtyping/#29972" class="Bound">ls[i]=ms[k]</a> <a id="29984" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>                   <a id="30004" class="Symbol">=</a>  <a id="30007" href="/Subtyping/#28552" class="InductiveConstructor">step</a> <a id="30012" class="Symbol">(</a><a id="30013" href="/Subtyping/#24447" class="InductiveConstructor">β-#</a> <a id="30017" class="Symbol">{</a><a id="30018" class="Argument">j</a> <a id="30020" class="Symbol">=</a> <a id="30022" href="/Subtyping/#29968" class="Bound">k</a><a id="30023" class="Symbol">}(</a><a id="30025" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a> <a id="30031" class="Symbol">(</a><a id="30032" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="30036" href="/Subtyping/#29972" class="Bound">ls[i]=ms[k]</a><a id="30047" class="Symbol">)</a> <a id="30049" class="Bound">ls[i]=l</a><a id="30056" class="Symbol">))</a>
<a id="30059" href="/Subtyping/#28679" class="Function">progress</a> <a id="30068" class="Symbol">(</a><a id="30069" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="30074" href="/Subtyping/#30074" class="Bound">x</a> <a id="30076" href="/Subtyping/#30076" class="Bound">d</a><a id="30077" class="Symbol">)</a>                         <a id="30103" class="Symbol">=</a>  <a id="30106" href="/Subtyping/#28615" class="InductiveConstructor">done</a> <a id="30111" href="/Subtyping/#23233" class="InductiveConstructor">V-rcd</a>
<a id="30117" href="/Subtyping/#28679" class="Function">progress</a> <a id="30126" class="Symbol">(</a><a id="30127" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="30131" class="Symbol">{</a><a id="30132" class="Argument">A</a> <a id="30134" class="Symbol">=</a> <a id="30136" href="/Subtyping/#30136" class="Bound">A</a><a id="30137" class="Symbol">}{</a><a id="30139" href="/Subtyping/#30139" class="Bound">B</a><a id="30140" class="Symbol">}</a> <a id="30142" href="/Subtyping/#30142" class="Bound">⊢M</a> <a id="30145" href="/Subtyping/#30145" class="Bound">A&lt;:B</a><a id="30149" class="Symbol">)</a>           <a id="30161" class="Symbol">=</a>  <a id="30164" href="/Subtyping/#28679" class="Function">progress</a> <a id="30173" href="/Subtyping/#30142" class="Bound">⊢M</a>
</pre>
<ul>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢#</code>: We have <code class="language-plaintext highlighter-rouge">Γ ⊢ M ⦂ ｛ ls ⦂ As ｝</code>, <code class="language-plaintext highlighter-rouge">lookup ls i ≡ l</code>, and <code class="language-plaintext highlighter-rouge">lookup As i ≡ A</code>.
By the induction hypothesis, either <code class="language-plaintext highlighter-rouge">M —→ M′</code> or <code class="language-plaintext highlighter-rouge">M</code> is a value. In the later case we
conclude that <code class="language-plaintext highlighter-rouge">M # l —→ M′ # l</code> by rule <code class="language-plaintext highlighter-rouge">ξ-#</code>. On the other hand, if <code class="language-plaintext highlighter-rouge">M</code> is a value,
we invoke the canonical forms lemma to show that <code class="language-plaintext highlighter-rouge">M</code> has the form <code class="language-plaintext highlighter-rouge">｛ ms := Ms ｝</code>
where <code class="language-plaintext highlighter-rouge">∅ ⊢* Ms ⦂ Bs</code> and <code class="language-plaintext highlighter-rouge">ls ⊆ ms</code>. By lemma <code class="language-plaintext highlighter-rouge">lookup-⊆</code>, we have
<code class="language-plaintext highlighter-rouge">lookup ls i ≡ lookup ms k</code> for some <code class="language-plaintext highlighter-rouge">k</code>. Thus, we have <code class="language-plaintext highlighter-rouge">lookup ms k ≡ l</code>
and we conclude <code class="language-plaintext highlighter-rouge">｛ ms := Ms ｝ # l —→ lookup Ms k</code> by rule <code class="language-plaintext highlighter-rouge">β-#</code>.</p>
  </li>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢rcd</code>: we immediately characterize the record as a value.</p>
  </li>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢&lt;:</code>: we invoke the induction hypothesis on sub-derivation of <code class="language-plaintext highlighter-rouge">Γ ⊢ M ⦂ A</code>.</p>
  </li>
</ul>

<h2 id="preservation-">Preservation <a name="subtyping-preservation"></a></h2>

<p>In this section we prove that when a well-typed term takes a reduction
step, the result is another well-typed term with the same type.</p>

<p>As mentioned earlier, we need to prove that substitution preserve
types, which in turn requires that renaming preserves types.  The
proofs of these lemmas are adapted from the intrinsic versions of the
<code class="language-plaintext highlighter-rouge">ext</code>, <code class="language-plaintext highlighter-rouge">rename</code>, <code class="language-plaintext highlighter-rouge">exts</code>, and <code class="language-plaintext highlighter-rouge">subst</code> functions in the
<a href="/DeBruijn/">DeBruijn</a> chapter.</p>

<p>We define the following abbreviation for a <em>well-typed renaming</em> from Γ
to Δ, that is, a renaming that sends variables in Γ to variables in Δ
with the same type.</p>
<pre class="Agda"><a id="_⦂ᵣ_⇒_"></a><a id="31551" href="/Subtyping/#31551" class="Function Operator">_⦂ᵣ_⇒_</a> <a id="31558" class="Symbol">:</a> <a id="31560" class="Symbol">(</a><a id="31561" href="/Subtyping/#17163" class="Function">Id</a> <a id="31564" class="Symbol">→</a> <a id="31566" href="/Subtyping/#17163" class="Function">Id</a><a id="31568" class="Symbol">)</a> <a id="31570" class="Symbol">→</a> <a id="31572" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="31580" class="Symbol">→</a> <a id="31582" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="31590" class="Symbol">→</a> <a id="31592" class="PrimitiveType">Set</a>
<a id="31596" href="/Subtyping/#31596" class="Bound">ρ</a> <a id="31598" href="/Subtyping/#31551" class="Function Operator">⦂ᵣ</a> <a id="31601" href="/Subtyping/#31601" class="Bound">Γ</a> <a id="31603" href="/Subtyping/#31551" class="Function Operator">⇒</a> <a id="31605" href="/Subtyping/#31605" class="Bound">Δ</a> <a id="31607" class="Symbol">=</a> <a id="31609" class="Symbol">∀</a> <a id="31611" class="Symbol">{</a><a id="31612" href="/Subtyping/#31612" class="Bound">x</a> <a id="31614" href="/Subtyping/#31614" class="Bound">A</a><a id="31615" class="Symbol">}</a> <a id="31617" class="Symbol">→</a> <a id="31619" href="/Subtyping/#31601" class="Bound">Γ</a> <a id="31621" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="31623" href="/Subtyping/#31612" class="Bound">x</a> <a id="31625" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="31627" href="/Subtyping/#31614" class="Bound">A</a> <a id="31629" class="Symbol">→</a> <a id="31631" href="/Subtyping/#31605" class="Bound">Δ</a> <a id="31633" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="31635" href="/Subtyping/#31596" class="Bound">ρ</a> <a id="31637" href="/Subtyping/#31612" class="Bound">x</a> <a id="31639" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="31641" href="/Subtyping/#31614" class="Bound">A</a>
</pre>
<p>The <code class="language-plaintext highlighter-rouge">ext</code> function takes a well-typed renaming from Γ to Δ
and extends it to become a renaming from (Γ , B) to (Δ , B).</p>
<pre class="Agda"><a id="ext-pres"></a><a id="31772" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="31781" class="Symbol">:</a> <a id="31783" class="Symbol">∀</a> <a id="31785" class="Symbol">{</a><a id="31786" href="/Subtyping/#31786" class="Bound">Γ</a> <a id="31788" href="/Subtyping/#31788" class="Bound">Δ</a> <a id="31790" href="/Subtyping/#31790" class="Bound">ρ</a> <a id="31792" href="/Subtyping/#31792" class="Bound">B</a><a id="31793" class="Symbol">}</a>
  <a id="31797" class="Symbol">→</a> <a id="31799" href="/Subtyping/#31790" class="Bound">ρ</a> <a id="31801" href="/Subtyping/#31551" class="Function Operator">⦂ᵣ</a> <a id="31804" href="/Subtyping/#31786" class="Bound">Γ</a> <a id="31806" href="/Subtyping/#31551" class="Function Operator">⇒</a> <a id="31808" href="/Subtyping/#31788" class="Bound">Δ</a>
    <a id="31814" class="Comment">--------------------------------</a>
  <a id="31849" class="Symbol">→</a> <a id="31851" href="/Subtyping/#20698" class="Function">ext</a> <a id="31855" href="/Subtyping/#31790" class="Bound">ρ</a> <a id="31857" href="/Subtyping/#31551" class="Function Operator">⦂ᵣ</a> <a id="31860" class="Symbol">(</a><a id="31861" href="/Subtyping/#31786" class="Bound">Γ</a> <a id="31863" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="31865" href="/Subtyping/#31792" class="Bound">B</a><a id="31866" class="Symbol">)</a> <a id="31868" href="/Subtyping/#31551" class="Function Operator">⇒</a> <a id="31870" class="Symbol">(</a><a id="31871" href="/Subtyping/#31788" class="Bound">Δ</a> <a id="31873" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="31875" href="/Subtyping/#31792" class="Bound">B</a><a id="31876" class="Symbol">)</a>
<a id="31878" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="31887" class="Symbol">{</a><a id="31888" class="Argument">ρ</a> <a id="31890" class="Symbol">=</a> <a id="31892" href="/Subtyping/#31892" class="Bound">ρ</a> <a id="31894" class="Symbol">}</a> <a id="31896" href="/Subtyping/#31896" class="Bound">ρ⦂</a> <a id="31899" href="/Subtyping/#16732" class="InductiveConstructor">Z</a> <a id="31901" class="Symbol">=</a> <a id="31903" href="/Subtyping/#16732" class="InductiveConstructor">Z</a>
<a id="31905" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="31914" class="Symbol">{</a><a id="31915" class="Argument">ρ</a> <a id="31917" class="Symbol">=</a> <a id="31919" href="/Subtyping/#31919" class="Bound">ρ</a> <a id="31921" class="Symbol">}</a> <a id="31923" href="/Subtyping/#31923" class="Bound">ρ⦂</a> <a id="31926" class="Symbol">(</a><a id="31927" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="31929" class="Symbol">{</a><a id="31930" class="Argument">x</a> <a id="31932" class="Symbol">=</a> <a id="31934" href="/Subtyping/#31934" class="Bound">x</a><a id="31935" class="Symbol">}</a> <a id="31937" href="/Subtyping/#31937" class="Bound">∋x</a><a id="31939" class="Symbol">)</a> <a id="31941" class="Symbol">=</a>  <a id="31944" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="31946" class="Symbol">(</a><a id="31947" href="/Subtyping/#31923" class="Bound">ρ⦂</a> <a id="31950" href="/Subtyping/#31937" class="Bound">∋x</a><a id="31952" class="Symbol">)</a>
</pre>
<p>Next we prove that both <code class="language-plaintext highlighter-rouge">rename</code> and <code class="language-plaintext highlighter-rouge">rename-vec</code> preserve types.  We
use the <code class="language-plaintext highlighter-rouge">ext-pres</code> lemma in each of the cases with a variable binding: <code class="language-plaintext highlighter-rouge">⊢ƛ</code>,
<code class="language-plaintext highlighter-rouge">⊢μ</code>, and <code class="language-plaintext highlighter-rouge">⊢case</code>.</p>
<pre class="Agda"><a id="ren-vec-pres"></a><a id="32129" href="/Subtyping/#32129" class="Function">ren-vec-pres</a> <a id="32142" class="Symbol">:</a> <a id="32144" class="Symbol">∀</a> <a id="32146" class="Symbol">{</a><a id="32147" href="/Subtyping/#32147" class="Bound">Γ</a> <a id="32149" href="/Subtyping/#32149" class="Bound">Δ</a> <a id="32151" href="/Subtyping/#32151" class="Bound">ρ</a><a id="32152" class="Symbol">}{</a><a id="32154" href="/Subtyping/#32154" class="Bound">n</a><a id="32155" class="Symbol">}{</a><a id="32157" href="/Subtyping/#32157" class="Bound">Ms</a> <a id="32160" class="Symbol">:</a> <a id="32162" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="32166" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="32171" href="/Subtyping/#32154" class="Bound">n</a><a id="32172" class="Symbol">}{</a><a id="32174" href="/Subtyping/#32174" class="Bound">As</a> <a id="32177" class="Symbol">:</a> <a id="32179" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="32183" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="32188" href="/Subtyping/#32154" class="Bound">n</a><a id="32189" class="Symbol">}</a>
  <a id="32193" class="Symbol">→</a> <a id="32195" href="/Subtyping/#32151" class="Bound">ρ</a> <a id="32197" href="/Subtyping/#31551" class="Function Operator">⦂ᵣ</a> <a id="32200" href="/Subtyping/#32147" class="Bound">Γ</a> <a id="32202" href="/Subtyping/#31551" class="Function Operator">⇒</a> <a id="32204" href="/Subtyping/#32149" class="Bound">Δ</a>  <a id="32207" class="Symbol">→</a>  <a id="32210" href="/Subtyping/#32147" class="Bound">Γ</a> <a id="32212" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="32215" href="/Subtyping/#32157" class="Bound">Ms</a> <a id="32218" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="32220" href="/Subtyping/#32174" class="Bound">As</a>  <a id="32224" class="Symbol">→</a>  <a id="32227" href="/Subtyping/#32149" class="Bound">Δ</a> <a id="32229" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="32232" href="/Subtyping/#20906" class="Function">rename-vec</a> <a id="32243" href="/Subtyping/#32151" class="Bound">ρ</a> <a id="32245" href="/Subtyping/#32157" class="Bound">Ms</a> <a id="32248" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="32250" href="/Subtyping/#32174" class="Bound">As</a>

<a id="rename-pres"></a><a id="32254" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32266" class="Symbol">:</a> <a id="32268" class="Symbol">∀</a> <a id="32270" class="Symbol">{</a><a id="32271" href="/Subtyping/#32271" class="Bound">Γ</a> <a id="32273" href="/Subtyping/#32273" class="Bound">Δ</a> <a id="32275" href="/Subtyping/#32275" class="Bound">ρ</a> <a id="32277" href="/Subtyping/#32277" class="Bound">M</a> <a id="32279" href="/Subtyping/#32279" class="Bound">A</a><a id="32280" class="Symbol">}</a>
  <a id="32284" class="Symbol">→</a> <a id="32286" href="/Subtyping/#32275" class="Bound">ρ</a> <a id="32288" href="/Subtyping/#31551" class="Function Operator">⦂ᵣ</a> <a id="32291" href="/Subtyping/#32271" class="Bound">Γ</a> <a id="32293" href="/Subtyping/#31551" class="Function Operator">⇒</a> <a id="32295" href="/Subtyping/#32273" class="Bound">Δ</a>
  <a id="32299" class="Symbol">→</a> <a id="32301" href="/Subtyping/#32271" class="Bound">Γ</a> <a id="32303" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="32305" href="/Subtyping/#32277" class="Bound">M</a> <a id="32307" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="32309" href="/Subtyping/#32279" class="Bound">A</a>
    <a id="32315" class="Comment">------------------</a>
  <a id="32336" class="Symbol">→</a> <a id="32338" href="/Subtyping/#32273" class="Bound">Δ</a> <a id="32340" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="32342" href="/Subtyping/#20963" class="Function">rename</a> <a id="32349" href="/Subtyping/#32275" class="Bound">ρ</a> <a id="32351" href="/Subtyping/#32277" class="Bound">M</a> <a id="32353" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="32355" href="/Subtyping/#32279" class="Bound">A</a>
<a id="32357" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32369" href="/Subtyping/#32369" class="Bound">ρ⦂</a> <a id="32372" class="Symbol">(</a><a id="32373" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="32376" href="/Subtyping/#32376" class="Bound">∋w</a><a id="32378" class="Symbol">)</a>           <a id="32390" class="Symbol">=</a>  <a id="32393" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="32396" class="Symbol">(</a><a id="32397" href="/Subtyping/#32369" class="Bound">ρ⦂</a> <a id="32400" href="/Subtyping/#32376" class="Bound">∋w</a><a id="32402" class="Symbol">)</a>
<a id="32404" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32416" class="Symbol">{</a><a id="32417" class="Argument">ρ</a> <a id="32419" class="Symbol">=</a> <a id="32421" href="/Subtyping/#32421" class="Bound">ρ</a><a id="32422" class="Symbol">}</a> <a id="32424" href="/Subtyping/#32424" class="Bound">ρ⦂</a> <a id="32427" class="Symbol">(</a><a id="32428" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="32431" href="/Subtyping/#32431" class="Bound">⊢N</a><a id="32433" class="Symbol">)</a>   <a id="32437" class="Symbol">=</a>  <a id="32440" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="32443" class="Symbol">(</a><a id="32444" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32456" class="Symbol">{</a><a id="32457" class="Argument">ρ</a> <a id="32459" class="Symbol">=</a> <a id="32461" href="/Subtyping/#20698" class="Function">ext</a> <a id="32465" href="/Subtyping/#32421" class="Bound">ρ</a><a id="32466" class="Symbol">}</a> <a id="32468" class="Symbol">(</a><a id="32469" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="32478" class="Symbol">{</a><a id="32479" class="Argument">ρ</a> <a id="32481" class="Symbol">=</a> <a id="32483" href="/Subtyping/#32421" class="Bound">ρ</a><a id="32484" class="Symbol">}</a> <a id="32486" href="/Subtyping/#32424" class="Bound">ρ⦂</a><a id="32488" class="Symbol">)</a> <a id="32490" href="/Subtyping/#32431" class="Bound">⊢N</a><a id="32492" class="Symbol">)</a>
<a id="32494" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32506" class="Symbol">{</a><a id="32507" class="Argument">ρ</a> <a id="32509" class="Symbol">=</a> <a id="32511" href="/Subtyping/#32511" class="Bound">ρ</a><a id="32512" class="Symbol">}</a> <a id="32514" href="/Subtyping/#32514" class="Bound">ρ⦂</a> <a id="32517" class="Symbol">(</a><a id="32518" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="32521" href="/Subtyping/#32521" class="Bound">⊢L</a> <a id="32524" href="/Subtyping/#32524" class="Bound">⊢M</a><a id="32526" class="Symbol">)=</a>  <a id="32530" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="32533" class="Symbol">(</a><a id="32534" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32546" class="Symbol">{</a><a id="32547" class="Argument">ρ</a> <a id="32549" class="Symbol">=</a> <a id="32551" href="/Subtyping/#32511" class="Bound">ρ</a><a id="32552" class="Symbol">}</a> <a id="32554" href="/Subtyping/#32514" class="Bound">ρ⦂</a> <a id="32557" href="/Subtyping/#32521" class="Bound">⊢L</a><a id="32559" class="Symbol">)</a> <a id="32561" class="Symbol">(</a><a id="32562" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32574" class="Symbol">{</a><a id="32575" class="Argument">ρ</a> <a id="32577" class="Symbol">=</a> <a id="32579" href="/Subtyping/#32511" class="Bound">ρ</a><a id="32580" class="Symbol">}</a> <a id="32582" href="/Subtyping/#32514" class="Bound">ρ⦂</a> <a id="32585" href="/Subtyping/#32524" class="Bound">⊢M</a><a id="32587" class="Symbol">)</a>
<a id="32589" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32601" class="Symbol">{</a><a id="32602" class="Argument">ρ</a> <a id="32604" class="Symbol">=</a> <a id="32606" href="/Subtyping/#32606" class="Bound">ρ</a><a id="32607" class="Symbol">}</a> <a id="32609" href="/Subtyping/#32609" class="Bound">ρ⦂</a> <a id="32612" class="Symbol">(</a><a id="32613" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="32616" href="/Subtyping/#32616" class="Bound">⊢M</a><a id="32618" class="Symbol">)</a>   <a id="32622" class="Symbol">=</a>  <a id="32625" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="32628" class="Symbol">(</a><a id="32629" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32641" class="Symbol">{</a><a id="32642" class="Argument">ρ</a> <a id="32644" class="Symbol">=</a> <a id="32646" href="/Subtyping/#20698" class="Function">ext</a> <a id="32650" href="/Subtyping/#32606" class="Bound">ρ</a><a id="32651" class="Symbol">}</a> <a id="32653" class="Symbol">(</a><a id="32654" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="32663" class="Symbol">{</a><a id="32664" class="Argument">ρ</a> <a id="32666" class="Symbol">=</a> <a id="32668" href="/Subtyping/#32606" class="Bound">ρ</a><a id="32669" class="Symbol">}</a> <a id="32671" href="/Subtyping/#32609" class="Bound">ρ⦂</a><a id="32673" class="Symbol">)</a> <a id="32675" href="/Subtyping/#32616" class="Bound">⊢M</a><a id="32677" class="Symbol">)</a>
<a id="32679" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32691" href="/Subtyping/#32691" class="Bound">ρ⦂</a> <a id="32694" class="Symbol">(</a><a id="32695" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="32700" href="/Subtyping/#32700" class="Bound">⊢Ms</a> <a id="32704" href="/Subtyping/#32704" class="Bound">dls</a><a id="32707" class="Symbol">)</a>    <a id="32712" class="Symbol">=</a> <a id="32714" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="32719" class="Symbol">(</a><a id="32720" href="/Subtyping/#32129" class="Function">ren-vec-pres</a> <a id="32733" href="/Subtyping/#32691" class="Bound">ρ⦂</a> <a id="32736" href="/Subtyping/#32700" class="Bound">⊢Ms</a> <a id="32740" class="Symbol">)</a> <a id="32742" href="/Subtyping/#32704" class="Bound">dls</a>
<a id="32746" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32758" class="Symbol">{</a><a id="32759" class="Argument">ρ</a> <a id="32761" class="Symbol">=</a> <a id="32763" href="/Subtyping/#32763" class="Bound">ρ</a><a id="32764" class="Symbol">}</a> <a id="32766" href="/Subtyping/#32766" class="Bound">ρ⦂</a> <a id="32769" class="Symbol">(</a><a id="32770" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="32773" class="Symbol">{</a><a id="32774" class="Argument">d</a> <a id="32776" class="Symbol">=</a> <a id="32778" href="/Subtyping/#32778" class="Bound">d</a><a id="32779" class="Symbol">}</a> <a id="32781" href="/Subtyping/#32781" class="Bound">⊢M</a> <a id="32784" href="/Subtyping/#32784" class="Bound">lif</a> <a id="32788" href="/Subtyping/#32788" class="Bound">liA</a><a id="32791" class="Symbol">)</a> <a id="32793" class="Symbol">=</a> <a id="32795" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="32798" class="Symbol">{</a><a id="32799" class="Argument">d</a> <a id="32801" class="Symbol">=</a> <a id="32803" href="/Subtyping/#32778" class="Bound">d</a><a id="32804" class="Symbol">}(</a><a id="32806" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32818" class="Symbol">{</a><a id="32819" class="Argument">ρ</a> <a id="32821" class="Symbol">=</a> <a id="32823" href="/Subtyping/#32763" class="Bound">ρ</a><a id="32824" class="Symbol">}</a> <a id="32826" href="/Subtyping/#32766" class="Bound">ρ⦂</a> <a id="32829" href="/Subtyping/#32781" class="Bound">⊢M</a><a id="32831" class="Symbol">)</a> <a id="32833" href="/Subtyping/#32784" class="Bound">lif</a> <a id="32837" href="/Subtyping/#32788" class="Bound">liA</a>
<a id="32841" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32853" class="Symbol">{</a><a id="32854" class="Argument">ρ</a> <a id="32856" class="Symbol">=</a> <a id="32858" href="/Subtyping/#32858" class="Bound">ρ</a><a id="32859" class="Symbol">}</a> <a id="32861" href="/Subtyping/#32861" class="Bound">ρ⦂</a> <a id="32864" class="Symbol">(</a><a id="32865" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="32869" href="/Subtyping/#32869" class="Bound">⊢M</a> <a id="32872" href="/Subtyping/#32872" class="Bound">lt</a><a id="32874" class="Symbol">)</a> <a id="32876" class="Symbol">=</a> <a id="32878" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="32882" class="Symbol">(</a><a id="32883" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32895" class="Symbol">{</a><a id="32896" class="Argument">ρ</a> <a id="32898" class="Symbol">=</a> <a id="32900" href="/Subtyping/#32858" class="Bound">ρ</a><a id="32901" class="Symbol">}</a> <a id="32903" href="/Subtyping/#32861" class="Bound">ρ⦂</a> <a id="32906" href="/Subtyping/#32869" class="Bound">⊢M</a><a id="32908" class="Symbol">)</a> <a id="32910" href="/Subtyping/#32872" class="Bound">lt</a>
<a id="32913" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32925" href="/Subtyping/#32925" class="Bound">ρ⦂</a> <a id="32928" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>               <a id="32948" class="Symbol">=</a> <a id="32950" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>
<a id="32956" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="32968" href="/Subtyping/#32968" class="Bound">ρ⦂</a> <a id="32971" class="Symbol">(</a><a id="32972" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="32977" href="/Subtyping/#32977" class="Bound">⊢M</a><a id="32979" class="Symbol">)</a>           <a id="32991" class="Symbol">=</a> <a id="32993" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="32998" class="Symbol">(</a><a id="32999" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33011" href="/Subtyping/#32968" class="Bound">ρ⦂</a> <a id="33014" href="/Subtyping/#32977" class="Bound">⊢M</a><a id="33016" class="Symbol">)</a>
<a id="33018" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33030" href="/Subtyping/#33030" class="Bound">ρ⦂</a> <a id="33033" class="Symbol">(</a><a id="33034" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="33040" href="/Subtyping/#33040" class="Bound">⊢L</a> <a id="33043" href="/Subtyping/#33043" class="Bound">⊢M</a> <a id="33046" href="/Subtyping/#33046" class="Bound">⊢N</a><a id="33048" class="Symbol">)</a>    <a id="33053" class="Symbol">=</a>
    <a id="33059" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="33065" class="Symbol">(</a><a id="33066" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33078" href="/Subtyping/#33030" class="Bound">ρ⦂</a> <a id="33081" href="/Subtyping/#33040" class="Bound">⊢L</a><a id="33083" class="Symbol">)</a> <a id="33085" class="Symbol">(</a><a id="33086" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33098" href="/Subtyping/#33030" class="Bound">ρ⦂</a> <a id="33101" href="/Subtyping/#33043" class="Bound">⊢M</a><a id="33103" class="Symbol">)</a> <a id="33105" class="Symbol">(</a><a id="33106" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33118" class="Symbol">(</a><a id="33119" href="/Subtyping/#31772" class="Function">ext-pres</a> <a id="33128" href="/Subtyping/#33030" class="Bound">ρ⦂</a><a id="33130" class="Symbol">)</a> <a id="33132" href="/Subtyping/#33046" class="Bound">⊢N</a><a id="33134" class="Symbol">)</a>

<a id="33137" href="/Subtyping/#32129" class="Function">ren-vec-pres</a> <a id="33150" href="/Subtyping/#33150" class="Bound">ρ⦂</a> <a id="33153" href="/Subtyping/#19270" class="InductiveConstructor">⊢*-[]</a> <a id="33159" class="Symbol">=</a> <a id="33161" href="/Subtyping/#19270" class="InductiveConstructor">⊢*-[]</a>
<a id="33167" href="/Subtyping/#32129" class="Function">ren-vec-pres</a> <a id="33180" class="Symbol">{</a><a id="33181" class="Argument">ρ</a> <a id="33183" class="Symbol">=</a> <a id="33185" href="/Subtyping/#33185" class="Bound">ρ</a><a id="33186" class="Symbol">}</a> <a id="33188" href="/Subtyping/#33188" class="Bound">ρ⦂</a> <a id="33191" class="Symbol">(</a><a id="33192" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="33197" href="/Subtyping/#33197" class="Bound">⊢M</a> <a id="33200" href="/Subtyping/#33200" class="Bound">⊢Ms</a><a id="33203" class="Symbol">)</a> <a id="33205" class="Symbol">=</a>
  <a id="33209" class="Keyword">let</a> <a id="33213" href="/Subtyping/#33213" class="Bound">IH</a> <a id="33216" class="Symbol">=</a> <a id="33218" href="/Subtyping/#32129" class="Function">ren-vec-pres</a> <a id="33231" class="Symbol">{</a><a id="33232" class="Argument">ρ</a> <a id="33234" class="Symbol">=</a> <a id="33236" href="/Subtyping/#33185" class="Bound">ρ</a><a id="33237" class="Symbol">}</a> <a id="33239" href="/Subtyping/#33188" class="Bound">ρ⦂</a> <a id="33242" href="/Subtyping/#33200" class="Bound">⊢Ms</a> <a id="33246" class="Keyword">in</a>
  <a id="33251" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="33256" class="Symbol">(</a><a id="33257" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33269" class="Symbol">{</a><a id="33270" class="Argument">ρ</a> <a id="33272" class="Symbol">=</a> <a id="33274" href="/Subtyping/#33185" class="Bound">ρ</a><a id="33275" class="Symbol">}</a> <a id="33277" href="/Subtyping/#33188" class="Bound">ρ⦂</a> <a id="33280" href="/Subtyping/#33197" class="Bound">⊢M</a><a id="33282" class="Symbol">)</a> <a id="33284" href="/Subtyping/#33213" class="Bound">IH</a>
</pre>
<p>A <em>well-typed substitution</em> from Γ to Δ sends variables in Γ to terms
of the same type in the context Δ.</p>
<pre class="Agda"><a id="_⦂_⇒_"></a><a id="33401" href="/Subtyping/#33401" class="Function Operator">_⦂_⇒_</a> <a id="33407" class="Symbol">:</a> <a id="33409" class="Symbol">(</a><a id="33410" href="/Subtyping/#17163" class="Function">Id</a> <a id="33413" class="Symbol">→</a> <a id="33415" href="/Subtyping/#17431" class="Datatype">Term</a><a id="33419" class="Symbol">)</a> <a id="33421" class="Symbol">→</a> <a id="33423" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="33431" class="Symbol">→</a> <a id="33433" href="/Subtyping/#16474" class="Datatype">Context</a> <a id="33441" class="Symbol">→</a> <a id="33443" class="PrimitiveType">Set</a>
<a id="33447" href="/Subtyping/#33447" class="Bound">σ</a> <a id="33449" href="/Subtyping/#33401" class="Function Operator">⦂</a> <a id="33451" href="/Subtyping/#33451" class="Bound">Γ</a> <a id="33453" href="/Subtyping/#33401" class="Function Operator">⇒</a> <a id="33455" href="/Subtyping/#33455" class="Bound">Δ</a> <a id="33457" class="Symbol">=</a> <a id="33459" class="Symbol">∀</a> <a id="33461" class="Symbol">{</a><a id="33462" href="/Subtyping/#33462" class="Bound">A</a> <a id="33464" href="/Subtyping/#33464" class="Bound">x</a><a id="33465" class="Symbol">}</a> <a id="33467" class="Symbol">→</a> <a id="33469" href="/Subtyping/#33451" class="Bound">Γ</a> <a id="33471" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="33473" href="/Subtyping/#33464" class="Bound">x</a> <a id="33475" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="33477" href="/Subtyping/#33462" class="Bound">A</a> <a id="33479" class="Symbol">→</a> <a id="33481" href="/Subtyping/#33455" class="Bound">Δ</a> <a id="33483" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="33485" href="/Subtyping/#21896" class="Function">subst</a> <a id="33491" href="/Subtyping/#33447" class="Bound">σ</a> <a id="33493" class="Symbol">(</a><a id="33494" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="33496" href="/Subtyping/#33464" class="Bound">x</a><a id="33497" class="Symbol">)</a> <a id="33499" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="33501" href="/Subtyping/#33462" class="Bound">A</a>
</pre>
<p>The <code class="language-plaintext highlighter-rouge">exts</code> function sends well-typed substitutions from Γ to Δ to
well-typed substitutions from (Γ , B) to (Δ , B). In the case for <code class="language-plaintext highlighter-rouge">S</code>,
we note that <code class="language-plaintext highlighter-rouge">exts σ (suc x) ≡ rename sub (σ x)</code>, so we need to prove
<code class="language-plaintext highlighter-rouge">Δ , B ⊢ rename suc (σ x) ⦂ A</code>, which we obtain by the <code class="language-plaintext highlighter-rouge">rename-pres</code>
lemma.</p>

<pre class="Agda"><a id="exts-pres"></a><a id="33796" href="/Subtyping/#33796" class="Function">exts-pres</a> <a id="33806" class="Symbol">:</a> <a id="33808" class="Symbol">∀</a> <a id="33810" class="Symbol">{</a><a id="33811" href="/Subtyping/#33811" class="Bound">Γ</a> <a id="33813" href="/Subtyping/#33813" class="Bound">Δ</a> <a id="33815" href="/Subtyping/#33815" class="Bound">σ</a> <a id="33817" href="/Subtyping/#33817" class="Bound">B</a><a id="33818" class="Symbol">}</a>
  <a id="33822" class="Symbol">→</a> <a id="33824" href="/Subtyping/#33815" class="Bound">σ</a> <a id="33826" href="/Subtyping/#33401" class="Function Operator">⦂</a> <a id="33828" href="/Subtyping/#33811" class="Bound">Γ</a> <a id="33830" href="/Subtyping/#33401" class="Function Operator">⇒</a> <a id="33832" href="/Subtyping/#33813" class="Bound">Δ</a>
    <a id="33838" class="Comment">--------------------------------</a>
  <a id="33873" class="Symbol">→</a> <a id="33875" href="/Subtyping/#21630" class="Function">exts</a> <a id="33880" href="/Subtyping/#33815" class="Bound">σ</a> <a id="33882" href="/Subtyping/#33401" class="Function Operator">⦂</a> <a id="33884" class="Symbol">(</a><a id="33885" href="/Subtyping/#33811" class="Bound">Γ</a> <a id="33887" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="33889" href="/Subtyping/#33817" class="Bound">B</a><a id="33890" class="Symbol">)</a> <a id="33892" href="/Subtyping/#33401" class="Function Operator">⇒</a> <a id="33894" class="Symbol">(</a><a id="33895" href="/Subtyping/#33813" class="Bound">Δ</a> <a id="33897" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="33899" href="/Subtyping/#33817" class="Bound">B</a><a id="33900" class="Symbol">)</a>
<a id="33902" href="/Subtyping/#33796" class="Function">exts-pres</a> <a id="33912" class="Symbol">{</a><a id="33913" class="Argument">σ</a> <a id="33915" class="Symbol">=</a> <a id="33917" href="/Subtyping/#33917" class="Bound">σ</a><a id="33918" class="Symbol">}</a> <a id="33920" href="/Subtyping/#33920" class="Bound">σ⦂</a> <a id="33923" href="/Subtyping/#16732" class="InductiveConstructor">Z</a> <a id="33925" class="Symbol">=</a> <a id="33927" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="33930" href="/Subtyping/#16732" class="InductiveConstructor">Z</a>
<a id="33932" href="/Subtyping/#33796" class="Function">exts-pres</a> <a id="33942" class="Symbol">{</a><a id="33943" class="Argument">σ</a> <a id="33945" class="Symbol">=</a> <a id="33947" href="/Subtyping/#33947" class="Bound">σ</a><a id="33948" class="Symbol">}</a> <a id="33950" href="/Subtyping/#33950" class="Bound">σ⦂</a> <a id="33953" class="Symbol">(</a><a id="33954" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="33956" class="Symbol">{</a><a id="33957" class="Argument">x</a> <a id="33959" class="Symbol">=</a> <a id="33961" href="/Subtyping/#33961" class="Bound">x</a><a id="33962" class="Symbol">}</a> <a id="33964" href="/Subtyping/#33964" class="Bound">∋x</a><a id="33966" class="Symbol">)</a> <a id="33968" class="Symbol">=</a> <a id="33970" href="/Subtyping/#32254" class="Function">rename-pres</a> <a id="33982" class="Symbol">{</a><a id="33983" class="Argument">ρ</a> <a id="33985" class="Symbol">=</a> <a id="33987" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a><a id="33990" class="Symbol">}</a> <a id="33992" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="33994" class="Symbol">(</a><a id="33995" href="/Subtyping/#33950" class="Bound">σ⦂</a> <a id="33998" href="/Subtyping/#33964" class="Bound">∋x</a><a id="34000" class="Symbol">)</a>
</pre>
<p>Now we prove that both <code class="language-plaintext highlighter-rouge">subst</code> and <code class="language-plaintext highlighter-rouge">subst-vec</code> preserve types.  We use
the <code class="language-plaintext highlighter-rouge">exts-pres</code> lemma in each of the cases with a variable binding:
<code class="language-plaintext highlighter-rouge">⊢ƛ</code>, <code class="language-plaintext highlighter-rouge">⊢μ</code>, and <code class="language-plaintext highlighter-rouge">⊢case</code>.</p>
<pre class="Agda"><a id="subst-vec-pres"></a><a id="34175" href="/Subtyping/#34175" class="Function">subst-vec-pres</a> <a id="34190" class="Symbol">:</a> <a id="34192" class="Symbol">∀</a> <a id="34194" class="Symbol">{</a><a id="34195" href="/Subtyping/#34195" class="Bound">Γ</a> <a id="34197" href="/Subtyping/#34197" class="Bound">Δ</a> <a id="34199" href="/Subtyping/#34199" class="Bound">σ</a><a id="34200" class="Symbol">}{</a><a id="34202" href="/Subtyping/#34202" class="Bound">n</a><a id="34203" class="Symbol">}{</a><a id="34205" href="/Subtyping/#34205" class="Bound">Ms</a> <a id="34208" class="Symbol">:</a> <a id="34210" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="34214" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="34219" href="/Subtyping/#34202" class="Bound">n</a><a id="34220" class="Symbol">}{</a><a id="34222" href="/Subtyping/#34222" class="Bound">A</a><a id="34223" class="Symbol">}</a>
  <a id="34227" class="Symbol">→</a> <a id="34229" href="/Subtyping/#34199" class="Bound">σ</a> <a id="34231" href="/Subtyping/#33401" class="Function Operator">⦂</a> <a id="34233" href="/Subtyping/#34195" class="Bound">Γ</a> <a id="34235" href="/Subtyping/#33401" class="Function Operator">⇒</a> <a id="34237" href="/Subtyping/#34197" class="Bound">Δ</a>  <a id="34240" class="Symbol">→</a>  <a id="34243" href="/Subtyping/#34195" class="Bound">Γ</a> <a id="34245" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="34248" href="/Subtyping/#34205" class="Bound">Ms</a> <a id="34251" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="34253" href="/Subtyping/#34222" class="Bound">A</a>  <a id="34256" class="Symbol">→</a>  <a id="34259" href="/Subtyping/#34197" class="Bound">Δ</a> <a id="34261" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="34264" href="/Subtyping/#21838" class="Function">subst-vec</a> <a id="34274" href="/Subtyping/#34199" class="Bound">σ</a> <a id="34276" href="/Subtyping/#34205" class="Bound">Ms</a> <a id="34279" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="34281" href="/Subtyping/#34222" class="Bound">A</a>

<a id="subst-pres"></a><a id="34284" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34295" class="Symbol">:</a> <a id="34297" class="Symbol">∀</a> <a id="34299" class="Symbol">{</a><a id="34300" href="/Subtyping/#34300" class="Bound">Γ</a> <a id="34302" href="/Subtyping/#34302" class="Bound">Δ</a> <a id="34304" href="/Subtyping/#34304" class="Bound">σ</a> <a id="34306" href="/Subtyping/#34306" class="Bound">N</a> <a id="34308" href="/Subtyping/#34308" class="Bound">A</a><a id="34309" class="Symbol">}</a>
  <a id="34313" class="Symbol">→</a> <a id="34315" href="/Subtyping/#34304" class="Bound">σ</a> <a id="34317" href="/Subtyping/#33401" class="Function Operator">⦂</a> <a id="34319" href="/Subtyping/#34300" class="Bound">Γ</a> <a id="34321" href="/Subtyping/#33401" class="Function Operator">⇒</a> <a id="34323" href="/Subtyping/#34302" class="Bound">Δ</a>
  <a id="34327" class="Symbol">→</a> <a id="34329" href="/Subtyping/#34300" class="Bound">Γ</a> <a id="34331" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="34333" href="/Subtyping/#34306" class="Bound">N</a> <a id="34335" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="34337" href="/Subtyping/#34308" class="Bound">A</a>
    <a id="34343" class="Comment">-----------------</a>
  <a id="34363" class="Symbol">→</a> <a id="34365" href="/Subtyping/#34302" class="Bound">Δ</a> <a id="34367" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="34369" href="/Subtyping/#21896" class="Function">subst</a> <a id="34375" href="/Subtyping/#34304" class="Bound">σ</a> <a id="34377" href="/Subtyping/#34306" class="Bound">N</a> <a id="34379" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="34381" href="/Subtyping/#34308" class="Bound">A</a>
<a id="34383" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34394" href="/Subtyping/#34394" class="Bound">σ⦂</a> <a id="34397" class="Symbol">(</a><a id="34398" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="34401" href="/Subtyping/#34401" class="Bound">eq</a><a id="34403" class="Symbol">)</a>            <a id="34416" class="Symbol">=</a> <a id="34418" href="/Subtyping/#34394" class="Bound">σ⦂</a> <a id="34421" href="/Subtyping/#34401" class="Bound">eq</a>
<a id="34424" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34435" class="Symbol">{</a><a id="34436" class="Argument">σ</a> <a id="34438" class="Symbol">=</a> <a id="34440" href="/Subtyping/#34440" class="Bound">σ</a><a id="34441" class="Symbol">}</a> <a id="34443" href="/Subtyping/#34443" class="Bound">σ⦂</a> <a id="34446" class="Symbol">(</a><a id="34447" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="34450" href="/Subtyping/#34450" class="Bound">⊢N</a><a id="34452" class="Symbol">)</a>    <a id="34457" class="Symbol">=</a> <a id="34459" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="34462" class="Symbol">(</a><a id="34463" href="/Subtyping/#34284" class="Function">subst-pres</a><a id="34473" class="Symbol">{</a><a id="34474" class="Argument">σ</a> <a id="34476" class="Symbol">=</a> <a id="34478" href="/Subtyping/#21630" class="Function">exts</a> <a id="34483" href="/Subtyping/#34440" class="Bound">σ</a><a id="34484" class="Symbol">}(</a><a id="34486" href="/Subtyping/#33796" class="Function">exts-pres</a> <a id="34496" class="Symbol">{</a><a id="34497" class="Argument">σ</a> <a id="34499" class="Symbol">=</a> <a id="34501" href="/Subtyping/#34440" class="Bound">σ</a><a id="34502" class="Symbol">}</a> <a id="34504" href="/Subtyping/#34443" class="Bound">σ⦂</a><a id="34506" class="Symbol">)</a> <a id="34508" href="/Subtyping/#34450" class="Bound">⊢N</a><a id="34510" class="Symbol">)</a>
<a id="34512" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34523" class="Symbol">{</a><a id="34524" class="Argument">σ</a> <a id="34526" class="Symbol">=</a> <a id="34528" href="/Subtyping/#34528" class="Bound">σ</a><a id="34529" class="Symbol">}</a> <a id="34531" href="/Subtyping/#34531" class="Bound">σ⦂</a> <a id="34534" class="Symbol">(</a><a id="34535" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="34538" href="/Subtyping/#34538" class="Bound">⊢L</a> <a id="34541" href="/Subtyping/#34541" class="Bound">⊢M</a><a id="34543" class="Symbol">)</a> <a id="34545" class="Symbol">=</a> <a id="34547" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="34550" class="Symbol">(</a><a id="34551" href="/Subtyping/#34284" class="Function">subst-pres</a><a id="34561" class="Symbol">{</a><a id="34562" class="Argument">σ</a> <a id="34564" class="Symbol">=</a> <a id="34566" href="/Subtyping/#34528" class="Bound">σ</a><a id="34567" class="Symbol">}</a> <a id="34569" href="/Subtyping/#34531" class="Bound">σ⦂</a> <a id="34572" href="/Subtyping/#34538" class="Bound">⊢L</a><a id="34574" class="Symbol">)</a> <a id="34576" class="Symbol">(</a><a id="34577" href="/Subtyping/#34284" class="Function">subst-pres</a><a id="34587" class="Symbol">{</a><a id="34588" class="Argument">σ</a> <a id="34590" class="Symbol">=</a> <a id="34592" href="/Subtyping/#34528" class="Bound">σ</a><a id="34593" class="Symbol">}</a> <a id="34595" href="/Subtyping/#34531" class="Bound">σ⦂</a> <a id="34598" href="/Subtyping/#34541" class="Bound">⊢M</a><a id="34600" class="Symbol">)</a>
<a id="34602" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34613" class="Symbol">{</a><a id="34614" class="Argument">σ</a> <a id="34616" class="Symbol">=</a> <a id="34618" href="/Subtyping/#34618" class="Bound">σ</a><a id="34619" class="Symbol">}</a> <a id="34621" href="/Subtyping/#34621" class="Bound">σ⦂</a> <a id="34624" class="Symbol">(</a><a id="34625" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="34628" href="/Subtyping/#34628" class="Bound">⊢M</a><a id="34630" class="Symbol">)</a>    <a id="34635" class="Symbol">=</a> <a id="34637" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="34640" class="Symbol">(</a><a id="34641" href="/Subtyping/#34284" class="Function">subst-pres</a><a id="34651" class="Symbol">{</a><a id="34652" class="Argument">σ</a> <a id="34654" class="Symbol">=</a> <a id="34656" href="/Subtyping/#21630" class="Function">exts</a> <a id="34661" href="/Subtyping/#34618" class="Bound">σ</a><a id="34662" class="Symbol">}</a> <a id="34664" class="Symbol">(</a><a id="34665" href="/Subtyping/#33796" class="Function">exts-pres</a><a id="34674" class="Symbol">{</a><a id="34675" class="Argument">σ</a> <a id="34677" class="Symbol">=</a> <a id="34679" href="/Subtyping/#34618" class="Bound">σ</a><a id="34680" class="Symbol">}</a> <a id="34682" href="/Subtyping/#34621" class="Bound">σ⦂</a><a id="34684" class="Symbol">)</a> <a id="34686" href="/Subtyping/#34628" class="Bound">⊢M</a><a id="34688" class="Symbol">)</a>
<a id="34690" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34701" href="/Subtyping/#34701" class="Bound">σ⦂</a> <a id="34704" class="Symbol">(</a><a id="34705" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="34710" href="/Subtyping/#34710" class="Bound">⊢Ms</a> <a id="34714" href="/Subtyping/#34714" class="Bound">dls</a><a id="34717" class="Symbol">)</a> <a id="34719" class="Symbol">=</a> <a id="34721" href="/Subtyping/#18841" class="InductiveConstructor">⊢rcd</a> <a id="34726" class="Symbol">(</a><a id="34727" href="/Subtyping/#34175" class="Function">subst-vec-pres</a> <a id="34742" href="/Subtyping/#34701" class="Bound">σ⦂</a> <a id="34745" href="/Subtyping/#34710" class="Bound">⊢Ms</a> <a id="34749" class="Symbol">)</a> <a id="34751" href="/Subtyping/#34714" class="Bound">dls</a>
<a id="34755" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34766" class="Symbol">{</a><a id="34767" class="Argument">σ</a> <a id="34769" class="Symbol">=</a> <a id="34771" href="/Subtyping/#34771" class="Bound">σ</a><a id="34772" class="Symbol">}</a> <a id="34774" href="/Subtyping/#34774" class="Bound">σ⦂</a> <a id="34777" class="Symbol">(</a><a id="34778" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="34781" class="Symbol">{</a><a id="34782" class="Argument">d</a> <a id="34784" class="Symbol">=</a> <a id="34786" href="/Subtyping/#34786" class="Bound">d</a><a id="34787" class="Symbol">}</a> <a id="34789" href="/Subtyping/#34789" class="Bound">⊢M</a> <a id="34792" href="/Subtyping/#34792" class="Bound">lif</a> <a id="34796" href="/Subtyping/#34796" class="Bound">liA</a><a id="34799" class="Symbol">)</a> <a id="34801" class="Symbol">=</a>
    <a id="34807" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="34810" class="Symbol">{</a><a id="34811" class="Argument">d</a> <a id="34813" class="Symbol">=</a> <a id="34815" href="/Subtyping/#34786" class="Bound">d</a><a id="34816" class="Symbol">}</a> <a id="34818" class="Symbol">(</a><a id="34819" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34830" class="Symbol">{</a><a id="34831" class="Argument">σ</a> <a id="34833" class="Symbol">=</a> <a id="34835" href="/Subtyping/#34771" class="Bound">σ</a><a id="34836" class="Symbol">}</a> <a id="34838" href="/Subtyping/#34774" class="Bound">σ⦂</a> <a id="34841" href="/Subtyping/#34789" class="Bound">⊢M</a><a id="34843" class="Symbol">)</a> <a id="34845" href="/Subtyping/#34792" class="Bound">lif</a> <a id="34849" href="/Subtyping/#34796" class="Bound">liA</a>
<a id="34853" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34864" class="Symbol">{</a><a id="34865" class="Argument">σ</a> <a id="34867" class="Symbol">=</a> <a id="34869" href="/Subtyping/#34869" class="Bound">σ</a><a id="34870" class="Symbol">}</a> <a id="34872" href="/Subtyping/#34872" class="Bound">σ⦂</a> <a id="34875" class="Symbol">(</a><a id="34876" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="34880" href="/Subtyping/#34880" class="Bound">⊢N</a> <a id="34883" href="/Subtyping/#34883" class="Bound">lt</a><a id="34885" class="Symbol">)</a> <a id="34887" class="Symbol">=</a> <a id="34889" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="34893" class="Symbol">(</a><a id="34894" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34905" class="Symbol">{</a><a id="34906" class="Argument">σ</a> <a id="34908" class="Symbol">=</a> <a id="34910" href="/Subtyping/#34869" class="Bound">σ</a><a id="34911" class="Symbol">}</a> <a id="34913" href="/Subtyping/#34872" class="Bound">σ⦂</a> <a id="34916" href="/Subtyping/#34880" class="Bound">⊢N</a><a id="34918" class="Symbol">)</a> <a id="34920" href="/Subtyping/#34883" class="Bound">lt</a>
<a id="34923" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34934" href="/Subtyping/#34934" class="Bound">σ⦂</a> <a id="34937" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a> <a id="34943" class="Symbol">=</a> <a id="34945" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>
<a id="34951" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34962" href="/Subtyping/#34962" class="Bound">σ⦂</a> <a id="34965" class="Symbol">(</a><a id="34966" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="34971" href="/Subtyping/#34971" class="Bound">⊢M</a><a id="34973" class="Symbol">)</a> <a id="34975" class="Symbol">=</a> <a id="34977" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="34982" class="Symbol">(</a><a id="34983" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="34994" href="/Subtyping/#34962" class="Bound">σ⦂</a> <a id="34997" href="/Subtyping/#34971" class="Bound">⊢M</a><a id="34999" class="Symbol">)</a>
<a id="35001" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35012" href="/Subtyping/#35012" class="Bound">σ⦂</a> <a id="35015" class="Symbol">(</a><a id="35016" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="35022" href="/Subtyping/#35022" class="Bound">⊢L</a> <a id="35025" href="/Subtyping/#35025" class="Bound">⊢M</a> <a id="35028" href="/Subtyping/#35028" class="Bound">⊢N</a><a id="35030" class="Symbol">)</a> <a id="35032" class="Symbol">=</a>
    <a id="35038" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="35044" class="Symbol">(</a><a id="35045" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35056" href="/Subtyping/#35012" class="Bound">σ⦂</a> <a id="35059" href="/Subtyping/#35022" class="Bound">⊢L</a><a id="35061" class="Symbol">)</a> <a id="35063" class="Symbol">(</a><a id="35064" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35075" href="/Subtyping/#35012" class="Bound">σ⦂</a> <a id="35078" href="/Subtyping/#35025" class="Bound">⊢M</a><a id="35080" class="Symbol">)</a> <a id="35082" class="Symbol">(</a><a id="35083" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35094" class="Symbol">(</a><a id="35095" href="/Subtyping/#33796" class="Function">exts-pres</a> <a id="35105" href="/Subtyping/#35012" class="Bound">σ⦂</a><a id="35107" class="Symbol">)</a> <a id="35109" href="/Subtyping/#35028" class="Bound">⊢N</a><a id="35111" class="Symbol">)</a>

<a id="35114" href="/Subtyping/#34175" class="Function">subst-vec-pres</a> <a id="35129" href="/Subtyping/#35129" class="Bound">σ⦂</a> <a id="35132" href="/Subtyping/#19270" class="InductiveConstructor">⊢*-[]</a> <a id="35138" class="Symbol">=</a> <a id="35140" href="/Subtyping/#19270" class="InductiveConstructor">⊢*-[]</a>
<a id="35146" href="/Subtyping/#34175" class="Function">subst-vec-pres</a> <a id="35161" class="Symbol">{</a><a id="35162" class="Argument">σ</a> <a id="35164" class="Symbol">=</a> <a id="35166" href="/Subtyping/#35166" class="Bound">σ</a><a id="35167" class="Symbol">}</a> <a id="35169" href="/Subtyping/#35169" class="Bound">σ⦂</a> <a id="35172" class="Symbol">(</a><a id="35173" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="35178" href="/Subtyping/#35178" class="Bound">⊢M</a> <a id="35181" href="/Subtyping/#35181" class="Bound">⊢Ms</a><a id="35184" class="Symbol">)</a> <a id="35186" class="Symbol">=</a>
    <a id="35192" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="35197" class="Symbol">(</a><a id="35198" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35209" class="Symbol">{</a><a id="35210" class="Argument">σ</a> <a id="35212" class="Symbol">=</a> <a id="35214" href="/Subtyping/#35166" class="Bound">σ</a><a id="35215" class="Symbol">}</a> <a id="35217" href="/Subtyping/#35169" class="Bound">σ⦂</a> <a id="35220" href="/Subtyping/#35178" class="Bound">⊢M</a><a id="35222" class="Symbol">)</a> <a id="35224" class="Symbol">(</a><a id="35225" href="/Subtyping/#34175" class="Function">subst-vec-pres</a> <a id="35240" href="/Subtyping/#35169" class="Bound">σ⦂</a> <a id="35243" href="/Subtyping/#35181" class="Bound">⊢Ms</a><a id="35246" class="Symbol">)</a>
</pre>
<p>The fact that single substitution preserves types is a corollary
of <code class="language-plaintext highlighter-rouge">subst-pres</code>.</p>
<pre class="Agda"><a id="substitution"></a><a id="35339" href="/Subtyping/#35339" class="Function">substitution</a> <a id="35352" class="Symbol">:</a> <a id="35354" class="Symbol">∀{</a><a id="35356" href="/Subtyping/#35356" class="Bound">Γ</a> <a id="35358" href="/Subtyping/#35358" class="Bound">A</a> <a id="35360" href="/Subtyping/#35360" class="Bound">B</a> <a id="35362" href="/Subtyping/#35362" class="Bound">M</a> <a id="35364" href="/Subtyping/#35364" class="Bound">N</a><a id="35365" class="Symbol">}</a>
   <a id="35370" class="Symbol">→</a> <a id="35372" href="/Subtyping/#35356" class="Bound">Γ</a> <a id="35374" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="35376" href="/Subtyping/#35362" class="Bound">M</a> <a id="35378" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="35380" href="/Subtyping/#35358" class="Bound">A</a>
   <a id="35385" class="Symbol">→</a> <a id="35387" class="Symbol">(</a><a id="35388" href="/Subtyping/#35356" class="Bound">Γ</a> <a id="35390" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="35392" href="/Subtyping/#35358" class="Bound">A</a><a id="35393" class="Symbol">)</a> <a id="35395" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="35397" href="/Subtyping/#35364" class="Bound">N</a> <a id="35399" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="35401" href="/Subtyping/#35360" class="Bound">B</a>
     <a id="35408" class="Comment">---------------</a>
   <a id="35427" class="Symbol">→</a> <a id="35429" href="/Subtyping/#35356" class="Bound">Γ</a> <a id="35431" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="35433" href="/Subtyping/#35364" class="Bound">N</a> <a id="35435" href="/Subtyping/#22639" class="Function Operator">[</a> <a id="35437" href="/Subtyping/#35362" class="Bound">M</a> <a id="35439" href="/Subtyping/#22639" class="Function Operator">]</a> <a id="35441" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="35443" href="/Subtyping/#35360" class="Bound">B</a>
<a id="35445" href="/Subtyping/#35339" class="Function">substitution</a> <a id="35458" class="Symbol">{</a><a id="35459" href="/Subtyping/#35459" class="Bound">Γ</a><a id="35460" class="Symbol">}{</a><a id="35462" href="/Subtyping/#35462" class="Bound">A</a><a id="35463" class="Symbol">}{</a><a id="35465" href="/Subtyping/#35465" class="Bound">B</a><a id="35466" class="Symbol">}{</a><a id="35468" href="/Subtyping/#35468" class="Bound">M</a><a id="35469" class="Symbol">}{</a><a id="35471" href="/Subtyping/#35471" class="Bound">N</a><a id="35472" class="Symbol">}</a> <a id="35474" href="/Subtyping/#35474" class="Bound">⊢M</a> <a id="35477" href="/Subtyping/#35477" class="Bound">⊢N</a> <a id="35480" class="Symbol">=</a> <a id="35482" href="/Subtyping/#34284" class="Function">subst-pres</a> <a id="35493" class="Symbol">{</a><a id="35494" class="Argument">σ</a> <a id="35496" class="Symbol">=</a> <a id="35498" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="35509" href="/Subtyping/#35468" class="Bound">M</a><a id="35510" class="Symbol">}</a> <a id="35512" href="/Subtyping/#35531" class="Function">G</a> <a id="35514" href="/Subtyping/#35477" class="Bound">⊢N</a>
    <a id="35521" class="Keyword">where</a>
    <a id="35531" href="/Subtyping/#35531" class="Function">G</a> <a id="35533" class="Symbol">:</a> <a id="35535" class="Symbol">∀</a> <a id="35537" class="Symbol">{</a><a id="35538" href="/Subtyping/#35538" class="Bound">C</a> <a id="35540" class="Symbol">:</a> <a id="35542" href="/Subtyping/#8368" class="Datatype">Type</a><a id="35546" class="Symbol">}</a> <a id="35548" class="Symbol">{</a><a id="35549" href="/Subtyping/#35549" class="Bound">x</a> <a id="35551" class="Symbol">:</a> <a id="35553" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a><a id="35554" class="Symbol">}</a>
      <a id="35562" class="Symbol">→</a> <a id="35564" class="Symbol">(</a><a id="35565" href="/Subtyping/#35459" class="Bound">Γ</a> <a id="35567" href="/Subtyping/#16512" class="InductiveConstructor Operator">,</a> <a id="35569" href="/Subtyping/#35462" class="Bound">A</a><a id="35570" class="Symbol">)</a> <a id="35572" href="/Subtyping/#16690" class="Datatype Operator">∋</a> <a id="35574" href="/Subtyping/#35549" class="Bound">x</a> <a id="35576" href="/Subtyping/#16690" class="Datatype Operator">⦂</a> <a id="35578" href="/Subtyping/#35538" class="Bound">C</a> <a id="35580" class="Symbol">→</a> <a id="35582" href="/Subtyping/#35459" class="Bound">Γ</a> <a id="35584" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="35586" href="/Subtyping/#21896" class="Function">subst</a> <a id="35592" class="Symbol">(</a><a id="35593" href="/Subtyping/#22554" class="Function">subst-zero</a> <a id="35604" href="/Subtyping/#35468" class="Bound">M</a><a id="35605" class="Symbol">)</a> <a id="35607" class="Symbol">(</a><a id="35608" href="/Subtyping/#17450" class="InductiveConstructor Operator">`</a> <a id="35610" href="/Subtyping/#35549" class="Bound">x</a><a id="35611" class="Symbol">)</a> <a id="35613" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="35615" href="/Subtyping/#35538" class="Bound">C</a>
    <a id="35621" href="/Subtyping/#35531" class="Function">G</a> <a id="35623" class="Symbol">{</a><a id="35624" href="/Subtyping/#35624" class="Bound">C</a><a id="35625" class="Symbol">}</a> <a id="35627" class="Symbol">{</a><a id="35628" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="35632" class="Symbol">}</a> <a id="35634" href="/Subtyping/#16732" class="InductiveConstructor">Z</a> <a id="35636" class="Symbol">=</a> <a id="35638" href="/Subtyping/#35474" class="Bound">⊢M</a>
    <a id="35645" href="/Subtyping/#35531" class="Function">G</a> <a id="35647" class="Symbol">{</a><a id="35648" href="/Subtyping/#35648" class="Bound">C</a><a id="35649" class="Symbol">}</a> <a id="35651" class="Symbol">{</a><a id="35652" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="35656" href="/Subtyping/#35656" class="Bound">x</a><a id="35657" class="Symbol">}</a> <a id="35659" class="Symbol">(</a><a id="35660" href="/Subtyping/#16792" class="InductiveConstructor">S</a> <a id="35662" href="/Subtyping/#35662" class="Bound">∋x</a><a id="35664" class="Symbol">)</a> <a id="35666" class="Symbol">=</a> <a id="35668" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="35671" href="/Subtyping/#35662" class="Bound">∋x</a>
</pre>
<p>We require just one last lemma before we get to the proof of preservation.
The following lemma establishes that field access preserves types.</p>
<pre class="Agda"><a id="field-pres"></a><a id="35825" href="/Subtyping/#35825" class="Function">field-pres</a> <a id="35836" class="Symbol">:</a> <a id="35838" class="Symbol">∀{</a><a id="35840" href="/Subtyping/#35840" class="Bound">n</a><a id="35841" class="Symbol">}{</a><a id="35843" href="/Subtyping/#35843" class="Bound">As</a> <a id="35846" class="Symbol">:</a> <a id="35848" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="35852" href="/Subtyping/#8368" class="Datatype">Type</a> <a id="35857" href="/Subtyping/#35840" class="Bound">n</a><a id="35858" class="Symbol">}{</a><a id="35860" href="/Subtyping/#35860" class="Bound">A</a><a id="35861" class="Symbol">}{</a><a id="35863" href="/Subtyping/#35863" class="Bound">Ms</a> <a id="35866" class="Symbol">:</a> <a id="35868" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#935" class="Datatype">Vec</a> <a id="35872" href="/Subtyping/#17431" class="Datatype">Term</a> <a id="35877" href="/Subtyping/#35840" class="Bound">n</a><a id="35878" class="Symbol">}{</a><a id="35880" href="/Subtyping/#35880" class="Bound">i</a> <a id="35882" class="Symbol">:</a> <a id="35884" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1000" class="Datatype">Fin</a> <a id="35888" href="/Subtyping/#35840" class="Bound">n</a><a id="35889" class="Symbol">}</a>
         <a id="35900" class="Symbol">→</a> <a id="35902" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="35904" href="/Subtyping/#18103" class="Datatype Operator">⊢*</a> <a id="35907" href="/Subtyping/#35863" class="Bound">Ms</a> <a id="35910" href="/Subtyping/#18103" class="Datatype Operator">⦂</a> <a id="35912" href="/Subtyping/#35843" class="Bound">As</a>
         <a id="35924" class="Symbol">→</a> <a id="35926" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="35933" href="/Subtyping/#35843" class="Bound">As</a> <a id="35936" href="/Subtyping/#35880" class="Bound">i</a> <a id="35938" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">≡</a> <a id="35940" href="/Subtyping/#35860" class="Bound">A</a>
         <a id="35951" class="Symbol">→</a> <a id="35953" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="35955" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="35957" href="https://agda.github.io/agda-stdlib/v1.1/Data.Vec.Base.html#1491" class="Function">lookup</a> <a id="35964" href="/Subtyping/#35863" class="Bound">Ms</a> <a id="35967" href="/Subtyping/#35880" class="Bound">i</a> <a id="35969" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="35971" href="/Subtyping/#35860" class="Bound">A</a>
<a id="35973" href="/Subtyping/#35825" class="Function">field-pres</a> <a id="35984" class="Symbol">{</a><a id="35985" class="Argument">i</a> <a id="35987" class="Symbol">=</a> <a id="35989" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1022" class="InductiveConstructor">zero</a><a id="35993" class="Symbol">}</a> <a id="35995" class="Symbol">(</a><a id="35996" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="36001" href="/Subtyping/#36001" class="Bound">⊢M</a> <a id="36004" href="/Subtyping/#36004" class="Bound">⊢Ms</a><a id="36007" class="Symbol">)</a> <a id="36009" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="36014" class="Symbol">=</a> <a id="36016" href="/Subtyping/#36001" class="Bound">⊢M</a>
<a id="36019" href="/Subtyping/#35825" class="Function">field-pres</a> <a id="36030" class="Symbol">{</a><a id="36031" class="Argument">i</a> <a id="36033" class="Symbol">=</a> <a id="36035" href="https://agda.github.io/agda-stdlib/v1.1/Data.Fin.Base.html#1053" class="InductiveConstructor">suc</a> <a id="36039" href="/Subtyping/#36039" class="Bound">i</a><a id="36040" class="Symbol">}</a> <a id="36042" class="Symbol">(</a><a id="36043" href="/Subtyping/#19301" class="InductiveConstructor">⊢*-∷</a> <a id="36048" href="/Subtyping/#36048" class="Bound">⊢M</a> <a id="36051" href="/Subtyping/#36051" class="Bound">⊢Ms</a><a id="36054" class="Symbol">)</a> <a id="36056" href="/Subtyping/#36056" class="Bound">As[i]=A</a> <a id="36064" class="Symbol">=</a> <a id="36066" href="/Subtyping/#35825" class="Function">field-pres</a> <a id="36077" href="/Subtyping/#36051" class="Bound">⊢Ms</a> <a id="36081" href="/Subtyping/#36056" class="Bound">As[i]=A</a>
</pre>
<p>The proof is by induction on the typing derivation.</p>

<ul>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢-*-[]</code>: This case yields a contradiction because <code class="language-plaintext highlighter-rouge">Fin 0</code> is uninhabitable.</p>
  </li>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢-*-∷</code>: So we have <code class="language-plaintext highlighter-rouge">∅ ⊢ M ⦂ B</code> and <code class="language-plaintext highlighter-rouge">∅ ⊢* Ms ⦂ As</code>. We proceed by cases on <code class="language-plaintext highlighter-rouge">i</code>.</p>

    <ul>
      <li>
        <p>If it is <code class="language-plaintext highlighter-rouge">0</code>, then lookup yields term <code class="language-plaintext highlighter-rouge">M</code> and <code class="language-plaintext highlighter-rouge">A ≡ B</code>, so we conclude that <code class="language-plaintext highlighter-rouge">∅ ⊢ M ⦂ A</code>.</p>
      </li>
      <li>
        <p>If it is <code class="language-plaintext highlighter-rouge">suc i</code>, then we conclude by the induction hypothesis.</p>
      </li>
    </ul>
  </li>
</ul>

<p>We conclude this chapter with the proof of preservation. We discuss
the cases particular to records and subtyping in the paragraph
following the Agda proof.</p>
<pre class="Agda"><a id="preserve"></a><a id="36647" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36656" class="Symbol">:</a> <a id="36658" class="Symbol">∀</a> <a id="36660" class="Symbol">{</a><a id="36661" href="/Subtyping/#36661" class="Bound">M</a> <a id="36663" href="/Subtyping/#36663" class="Bound">N</a> <a id="36665" href="/Subtyping/#36665" class="Bound">A</a><a id="36666" class="Symbol">}</a>
  <a id="36670" class="Symbol">→</a> <a id="36672" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="36674" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="36676" href="/Subtyping/#36661" class="Bound">M</a> <a id="36678" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="36680" href="/Subtyping/#36665" class="Bound">A</a>
  <a id="36684" class="Symbol">→</a> <a id="36686" href="/Subtyping/#36661" class="Bound">M</a> <a id="36688" href="/Subtyping/#23491" class="Datatype Operator">—→</a> <a id="36691" href="/Subtyping/#36663" class="Bound">N</a>
    <a id="36697" class="Comment">----------</a>
  <a id="36710" class="Symbol">→</a> <a id="36712" href="/Subtyping/#16496" class="InductiveConstructor">∅</a> <a id="36714" href="/Subtyping/#18166" class="Datatype Operator">⊢</a> <a id="36716" href="/Subtyping/#36663" class="Bound">N</a> <a id="36718" href="/Subtyping/#18166" class="Datatype Operator">⦂</a> <a id="36720" href="/Subtyping/#36665" class="Bound">A</a>
<a id="36722" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36731" class="Symbol">(</a><a id="36732" href="/Subtyping/#18211" class="InductiveConstructor">⊢`</a> <a id="36735" class="Symbol">())</a>
<a id="36739" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36748" class="Symbol">(</a><a id="36749" href="/Subtyping/#18281" class="InductiveConstructor">⊢ƛ</a> <a id="36752" href="/Subtyping/#36752" class="Bound">⊢N</a><a id="36754" class="Symbol">)</a>                 <a id="36772" class="Symbol">()</a>
<a id="36775" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36784" class="Symbol">(</a><a id="36785" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="36788" href="/Subtyping/#36788" class="Bound">⊢L</a> <a id="36791" href="/Subtyping/#36791" class="Bound">⊢M</a><a id="36793" class="Symbol">)</a>              <a id="36808" class="Symbol">(</a><a id="36809" href="/Subtyping/#23525" class="InductiveConstructor">ξ-·₁</a> <a id="36814" href="/Subtyping/#36814" class="Bound">L—→L′</a><a id="36819" class="Symbol">)</a>     <a id="36825" class="Symbol">=</a>  <a id="36828" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="36831" class="Symbol">(</a><a id="36832" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36841" href="/Subtyping/#36788" class="Bound">⊢L</a> <a id="36844" href="/Subtyping/#36814" class="Bound">L—→L′</a><a id="36849" class="Symbol">)</a> <a id="36851" href="/Subtyping/#36791" class="Bound">⊢M</a>
<a id="36854" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36863" class="Symbol">(</a><a id="36864" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="36867" href="/Subtyping/#36867" class="Bound">⊢L</a> <a id="36870" href="/Subtyping/#36870" class="Bound">⊢M</a><a id="36872" class="Symbol">)</a>              <a id="36887" class="Symbol">(</a><a id="36888" href="/Subtyping/#23611" class="InductiveConstructor">ξ-·₂</a> <a id="36893" href="/Subtyping/#36893" class="Bound">VL</a> <a id="36896" href="/Subtyping/#36896" class="Bound">M—→M′</a><a id="36901" class="Symbol">)</a>  <a id="36904" class="Symbol">=</a>  <a id="36907" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="36910" href="/Subtyping/#36867" class="Bound">⊢L</a> <a id="36913" class="Symbol">(</a><a id="36914" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36923" href="/Subtyping/#36870" class="Bound">⊢M</a> <a id="36926" href="/Subtyping/#36896" class="Bound">M—→M′</a><a id="36931" class="Symbol">)</a>
<a id="36933" href="/Subtyping/#36647" class="Function">preserve</a> <a id="36942" class="Symbol">(</a><a id="36943" href="/Subtyping/#18370" class="InductiveConstructor">⊢·</a> <a id="36946" href="/Subtyping/#36946" class="Bound">⊢L</a> <a id="36949" href="/Subtyping/#36949" class="Bound">⊢M</a><a id="36951" class="Symbol">)</a>              <a id="36966" class="Symbol">(</a><a id="36967" href="/Subtyping/#23712" class="InductiveConstructor">β-ƛ</a> <a id="36971" href="/Subtyping/#36971" class="Bound">VL</a><a id="36973" class="Symbol">)</a>
    <a id="36979" class="Keyword">with</a> <a id="36984" href="/Subtyping/#25856" class="Function">canonical</a> <a id="36994" href="/Subtyping/#36946" class="Bound">⊢L</a> <a id="36997" href="/Subtyping/#23057" class="InductiveConstructor">V-ƛ</a>
<a id="37001" class="Symbol">...</a> <a id="37005" class="Symbol">|</a> <a id="37007" href="/Subtyping/#25309" class="InductiveConstructor">C-ƛ</a> <a id="37011" href="/Subtyping/#37011" class="Bound">⊢N</a> <a id="37014" class="Symbol">(</a><a id="37015" href="/Subtyping/#9270" class="InductiveConstructor">&lt;:-fun</a> <a id="37022" href="/Subtyping/#37022" class="Bound">CA</a> <a id="37025" href="/Subtyping/#37025" class="Bound">BC</a><a id="37027" class="Symbol">)</a>                       <a id="37051" class="Symbol">=</a>  <a id="37054" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="37058" class="Symbol">(</a><a id="37059" href="/Subtyping/#35339" class="Function">substitution</a> <a id="37072" class="Symbol">(</a><a id="37073" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="37077" class="Bound">⊢M</a> <a id="37080" href="/Subtyping/#37022" class="Bound">CA</a><a id="37082" class="Symbol">)</a> <a id="37084" href="/Subtyping/#37011" class="Bound">⊢N</a><a id="37086" class="Symbol">)</a> <a id="37088" href="/Subtyping/#37025" class="Bound">BC</a>
<a id="37091" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37100" href="/Subtyping/#18468" class="InductiveConstructor">⊢zero</a>                   <a id="37124" class="Symbol">()</a>
<a id="37127" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37136" class="Symbol">(</a><a id="37137" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="37142" href="/Subtyping/#37142" class="Bound">⊢M</a><a id="37144" class="Symbol">)</a>               <a id="37160" class="Symbol">(</a><a id="37161" href="/Subtyping/#23804" class="InductiveConstructor">ξ-suc</a> <a id="37167" href="/Subtyping/#37167" class="Bound">M—→M′</a><a id="37172" class="Symbol">)</a>    <a id="37177" class="Symbol">=</a>  <a id="37180" href="/Subtyping/#18527" class="InductiveConstructor">⊢suc</a> <a id="37185" class="Symbol">(</a><a id="37186" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37195" href="/Subtyping/#37142" class="Bound">⊢M</a> <a id="37198" href="/Subtyping/#37167" class="Bound">M—→M′</a><a id="37203" class="Symbol">)</a>
<a id="37205" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37214" class="Symbol">(</a><a id="37215" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="37221" href="/Subtyping/#37221" class="Bound">⊢L</a> <a id="37224" href="/Subtyping/#37224" class="Bound">⊢M</a> <a id="37227" href="/Subtyping/#37227" class="Bound">⊢N</a><a id="37229" class="Symbol">)</a>        <a id="37238" class="Symbol">(</a><a id="37239" href="/Subtyping/#23893" class="InductiveConstructor">ξ-case</a> <a id="37246" href="/Subtyping/#37246" class="Bound">L—→L′</a><a id="37251" class="Symbol">)</a>   <a id="37255" class="Symbol">=</a>  <a id="37258" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="37264" class="Symbol">(</a><a id="37265" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37274" href="/Subtyping/#37221" class="Bound">⊢L</a> <a id="37277" href="/Subtyping/#37246" class="Bound">L—→L′</a><a id="37282" class="Symbol">)</a> <a id="37284" href="/Subtyping/#37224" class="Bound">⊢M</a> <a id="37287" href="/Subtyping/#37227" class="Bound">⊢N</a>
<a id="37290" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37299" class="Symbol">(</a><a id="37300" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="37306" href="/Subtyping/#37306" class="Bound">⊢L</a> <a id="37309" href="/Subtyping/#37309" class="Bound">⊢M</a> <a id="37312" href="/Subtyping/#37312" class="Bound">⊢N</a><a id="37314" class="Symbol">)</a>        <a id="37323" class="Symbol">(</a><a id="37324" href="/Subtyping/#24063" class="InductiveConstructor">β-zero</a><a id="37330" class="Symbol">)</a>         <a id="37340" class="Symbol">=</a>  <a id="37343" href="/Subtyping/#37309" class="Bound">⊢M</a>
<a id="37346" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37355" class="Symbol">(</a><a id="37356" href="/Subtyping/#18606" class="InductiveConstructor">⊢case</a> <a id="37362" href="/Subtyping/#37362" class="Bound">⊢L</a> <a id="37365" href="/Subtyping/#37365" class="Bound">⊢M</a> <a id="37368" href="/Subtyping/#37368" class="Bound">⊢N</a><a id="37370" class="Symbol">)</a>        <a id="37379" class="Symbol">(</a><a id="37380" href="/Subtyping/#24173" class="InductiveConstructor">β-suc</a> <a id="37386" href="/Subtyping/#37386" class="Bound">VV</a><a id="37388" class="Symbol">)</a>
    <a id="37394" class="Keyword">with</a> <a id="37399" href="/Subtyping/#25856" class="Function">canonical</a> <a id="37409" href="/Subtyping/#37362" class="Bound">⊢L</a> <a id="37412" class="Symbol">(</a><a id="37413" href="/Subtyping/#23160" class="InductiveConstructor">V-suc</a> <a id="37419" href="/Subtyping/#37386" class="Bound">VV</a><a id="37421" class="Symbol">)</a>
<a id="37423" class="Symbol">...</a> <a id="37427" class="Symbol">|</a> <a id="37429" href="/Subtyping/#25504" class="InductiveConstructor">C-suc</a> <a id="37435" href="/Subtyping/#37435" class="Bound">CV</a>                                    <a id="37473" class="Symbol">=</a>  <a id="37476" href="/Subtyping/#35339" class="Function">substitution</a> <a id="37489" class="Symbol">(</a><a id="37490" href="/Subtyping/#27881" class="Function">typed</a> <a id="37496" href="/Subtyping/#37435" class="Bound">CV</a><a id="37498" class="Symbol">)</a> <a id="37500" class="Bound">⊢N</a>
<a id="37503" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37512" class="Symbol">(</a><a id="37513" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="37516" href="/Subtyping/#37516" class="Bound">⊢M</a><a id="37518" class="Symbol">)</a>                 <a id="37536" class="Symbol">(</a><a id="37537" href="/Subtyping/#24315" class="InductiveConstructor">β-μ</a><a id="37540" class="Symbol">)</a>            <a id="37553" class="Symbol">=</a>  <a id="37556" href="/Subtyping/#35339" class="Function">substitution</a> <a id="37569" class="Symbol">(</a><a id="37570" href="/Subtyping/#18765" class="InductiveConstructor">⊢μ</a> <a id="37573" href="/Subtyping/#37516" class="Bound">⊢M</a><a id="37575" class="Symbol">)</a> <a id="37577" href="/Subtyping/#37516" class="Bound">⊢M</a>
<a id="37580" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37589" class="Symbol">(</a><a id="37590" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="37593" class="Symbol">{</a><a id="37594" class="Argument">d</a> <a id="37596" class="Symbol">=</a> <a id="37598" href="/Subtyping/#37598" class="Bound">d</a><a id="37599" class="Symbol">}</a> <a id="37601" href="/Subtyping/#37601" class="Bound">⊢M</a> <a id="37604" href="/Subtyping/#37604" class="Bound">lsi</a> <a id="37608" href="/Subtyping/#37608" class="Bound">Asi</a><a id="37611" class="Symbol">)</a> <a id="37613" class="Symbol">(</a><a id="37614" href="/Subtyping/#24383" class="InductiveConstructor">ξ-#</a> <a id="37618" href="/Subtyping/#37618" class="Bound">M—→M′</a><a id="37623" class="Symbol">)</a>      <a id="37630" class="Symbol">=</a>  <a id="37633" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="37636" class="Symbol">{</a><a id="37637" class="Argument">d</a> <a id="37639" class="Symbol">=</a> <a id="37641" href="/Subtyping/#37598" class="Bound">d</a><a id="37642" class="Symbol">}</a> <a id="37644" class="Symbol">(</a><a id="37645" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37654" href="/Subtyping/#37601" class="Bound">⊢M</a> <a id="37657" href="/Subtyping/#37618" class="Bound">M—→M′</a><a id="37662" class="Symbol">)</a> <a id="37664" href="/Subtyping/#37604" class="Bound">lsi</a> <a id="37668" href="/Subtyping/#37608" class="Bound">Asi</a>
<a id="37672" href="/Subtyping/#36647" class="Function">preserve</a> <a id="37681" class="Symbol">(</a><a id="37682" href="/Subtyping/#18998" class="InductiveConstructor">⊢#</a> <a id="37685" class="Symbol">{</a><a id="37686" class="Argument">ls</a> <a id="37689" class="Symbol">=</a> <a id="37691" href="/Subtyping/#37691" class="Bound">ls</a><a id="37693" class="Symbol">}{</a><a id="37695" class="Argument">i</a> <a id="37697" class="Symbol">=</a> <a id="37699" href="/Subtyping/#37699" class="Bound">i</a><a id="37700" class="Symbol">}</a> <a id="37702" href="/Subtyping/#37702" class="Bound">⊢M</a> <a id="37705" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="37710" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="37714" class="Symbol">)</a> <a id="37716" class="Symbol">(</a><a id="37717" href="/Subtyping/#24447" class="InductiveConstructor">β-#</a> <a id="37721" class="Symbol">{</a><a id="37722" class="Argument">ls</a> <a id="37725" class="Symbol">=</a> <a id="37727" href="/Subtyping/#37727" class="Bound">ks</a><a id="37729" class="Symbol">}{</a><a id="37731" href="/Subtyping/#37731" class="Bound">Ms</a><a id="37733" class="Symbol">}{</a><a id="37735" class="Argument">j</a> <a id="37737" class="Symbol">=</a> <a id="37739" href="/Subtyping/#37739" class="Bound">j</a><a id="37740" class="Symbol">}</a> <a id="37742" href="/Subtyping/#37742" class="Bound">ks[j]=l</a><a id="37749" class="Symbol">)</a>
    <a id="37755" class="Keyword">with</a> <a id="37760" href="/Subtyping/#25856" class="Function">canonical</a> <a id="37770" href="/Subtyping/#37702" class="Bound">⊢M</a> <a id="37773" href="/Subtyping/#23233" class="InductiveConstructor">V-rcd</a>
<a id="37779" class="Symbol">...</a> <a id="37783" class="Symbol">|</a> <a id="37785" href="/Subtyping/#25600" class="InductiveConstructor">C-rcd</a> <a id="37791" class="Symbol">{</a><a id="37792" class="Argument">As</a> <a id="37795" class="Symbol">=</a> <a id="37797" href="/Subtyping/#37797" class="Bound">Bs</a><a id="37799" class="Symbol">}</a> <a id="37801" href="/Subtyping/#37801" class="Bound">⊢Ms</a> <a id="37805" href="/Subtyping/#37805" class="Bound">dks</a> <a id="37809" class="Symbol">(</a><a id="37810" href="/Subtyping/#9367" class="InductiveConstructor">&lt;:-rcd</a> <a id="37817" class="Symbol">{</a><a id="37818" class="Argument">ks</a> <a id="37821" class="Symbol">=</a> <a id="37823" class="Bound">ks</a><a id="37825" class="Symbol">}</a> <a id="37827" href="/Subtyping/#37827" class="Bound">ls⊆ks</a> <a id="37833" href="/Subtyping/#37833" class="Bound">Bs&lt;:As</a><a id="37839" class="Symbol">)</a>
    <a id="37845" class="Keyword">with</a> <a id="37850" href="/Subtyping/#7960" class="Function">lookup-⊆</a> <a id="37859" class="Symbol">{</a><a id="37860" class="Argument">i</a> <a id="37862" class="Symbol">=</a> <a id="37864" class="Bound">i</a><a id="37865" class="Symbol">}</a> <a id="37867" href="/Subtyping/#37827" class="Bound">ls⊆ks</a>
<a id="37873" class="Symbol">...</a> <a id="37877" class="Symbol">|</a> <a id="37879" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟨</a> <a id="37881" href="/Subtyping/#37881" class="Bound">k</a> <a id="37883" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="37885" href="/Subtyping/#37885" class="Bound">ls[i]=ks[k]</a> <a id="37897" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">⟩</a>
    <a id="37903" class="Keyword">with</a> <a id="37908" href="/Subtyping/#35825" class="Function">field-pres</a> <a id="37919" class="Symbol">{</a><a id="37920" class="Argument">i</a> <a id="37922" class="Symbol">=</a> <a id="37924" href="/Subtyping/#37881" class="Bound">k</a><a id="37925" class="Symbol">}</a> <a id="37927" class="Bound">⊢Ms</a> <a id="37931" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="37936" class="Symbol">...</a> <a id="37940" class="Symbol">|</a> <a id="37942" href="/Subtyping/#37942" class="Bound">⊢Ms[k]⦂Bs[k]</a>
    <a id="37959" class="Keyword">rewrite</a> <a id="37967" href="/Subtyping/#5527" class="Function">distinct-lookup-inj</a> <a id="37987" class="Bound">dks</a> <a id="37991" class="Symbol">(</a><a id="37992" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#984" class="Function">trans</a> <a id="37998" class="Bound">ks[j]=l</a> <a id="38006" class="Bound">ls[i]=ks[k]</a><a id="38017" class="Symbol">)</a> <a id="38019" class="Symbol">=</a>
    <a id="38025" class="Keyword">let</a> <a id="38029" href="/Subtyping/#38029" class="Bound">Ms[k]⦂As[i]</a> <a id="38041" class="Symbol">=</a> <a id="38043" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="38047" href="/Subtyping/#37942" class="Bound">⊢Ms[k]⦂Bs[k]</a> <a id="38060" class="Symbol">(</a><a id="38061" class="Bound">Bs&lt;:As</a> <a id="38068" class="Symbol">(</a><a id="38069" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="38073" class="Bound">ls[i]=ks[k]</a><a id="38084" class="Symbol">))</a> <a id="38087" class="Keyword">in</a>
    <a id="38094" href="/Subtyping/#38029" class="Bound">Ms[k]⦂As[i]</a>
<a id="38106" href="/Subtyping/#36647" class="Function">preserve</a> <a id="38115" class="Symbol">(</a><a id="38116" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="38120" href="/Subtyping/#38120" class="Bound">⊢M</a> <a id="38123" href="/Subtyping/#38123" class="Bound">B&lt;:A</a><a id="38127" class="Symbol">)</a> <a id="38129" href="/Subtyping/#38129" class="Bound">M—→N</a>                       <a id="38156" class="Symbol">=</a>  <a id="38159" href="/Subtyping/#19162" class="InductiveConstructor">⊢&lt;:</a> <a id="38163" class="Symbol">(</a><a id="38164" href="/Subtyping/#36647" class="Function">preserve</a> <a id="38173" href="/Subtyping/#38120" class="Bound">⊢M</a> <a id="38176" href="/Subtyping/#38129" class="Bound">M—→N</a><a id="38180" class="Symbol">)</a> <a id="38182" href="/Subtyping/#38123" class="Bound">B&lt;:A</a>
</pre>
<p>Recall that the proof is by induction on the derivation of <code class="language-plaintext highlighter-rouge">∅ ⊢ M ⦂ A</code>
with cases on <code class="language-plaintext highlighter-rouge">M —→ N</code>.</p>

<ul>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢#</code> and <code class="language-plaintext highlighter-rouge">ξ-#</code>: So <code class="language-plaintext highlighter-rouge">∅ ⊢ M ⦂ ｛ ls ⦂ As ｝</code>, <code class="language-plaintext highlighter-rouge">lookup ls i ≡ l</code>, <code class="language-plaintext highlighter-rouge">lookup As i ≡ A</code>,
and <code class="language-plaintext highlighter-rouge">M —→ M′</code>. We apply the induction hypothesis to obtain <code class="language-plaintext highlighter-rouge">∅ ⊢ M′ ⦂ ｛ ls ⦂ As ｝</code>
and then conclude by rule <code class="language-plaintext highlighter-rouge">⊢#</code>.</p>
  </li>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢#</code> and <code class="language-plaintext highlighter-rouge">β-#</code>. We have <code class="language-plaintext highlighter-rouge">∅ ⊢ ｛ ks := Ms ｝ ⦂ ｛ ls ⦂ As ｝</code>, <code class="language-plaintext highlighter-rouge">lookup ls i ≡ l</code>,
<code class="language-plaintext highlighter-rouge">lookup As i ≡ A</code>, <code class="language-plaintext highlighter-rouge">lookup ks j ≡ l</code>, and <code class="language-plaintext highlighter-rouge">｛ ks := Ms ｝ # l —→ lookup Ms j</code>.
By the canonical forms lemma, we have <code class="language-plaintext highlighter-rouge">∅ ⊢* Ms ⦂ Bs</code>, <code class="language-plaintext highlighter-rouge">ls ⊆ ks</code> and <code class="language-plaintext highlighter-rouge">ks ⦂ Bs &lt;: ls ⦂ As</code>.
By lemma <code class="language-plaintext highlighter-rouge">lookup-⊆</code> we have <code class="language-plaintext highlighter-rouge">lookup ls i ≡ lookup ks k</code> for some <code class="language-plaintext highlighter-rouge">k</code>.
Also, we have <code class="language-plaintext highlighter-rouge">∅ ⊢ lookup Ms k ⦂ lookup Bs k</code> by lemma <code class="language-plaintext highlighter-rouge">field-pres</code>.
Then because <code class="language-plaintext highlighter-rouge">ks ⦂ Bs &lt;: ls ⦂ As</code> and <code class="language-plaintext highlighter-rouge">lookup ks k ≡ lookup ls i</code>, we have
<code class="language-plaintext highlighter-rouge">lookup Bs k &lt;: lookup As i</code>. So by rule <code class="language-plaintext highlighter-rouge">⊢&lt;:</code> we have
<code class="language-plaintext highlighter-rouge">∅ ⊢ lookup Ms k ⦂ lookup As i</code>.
Finally, because <code class="language-plaintext highlighter-rouge">lookup</code> is injective and <code class="language-plaintext highlighter-rouge">lookup ks j ≡ lookup ks k</code>,
we have <code class="language-plaintext highlighter-rouge">j ≡ k</code> and conclude that <code class="language-plaintext highlighter-rouge">∅ ⊢ lookup Ms j ⦂ lookup As i</code>.</p>
  </li>
  <li>
    <p>Case <code class="language-plaintext highlighter-rouge">⊢&lt;:</code>. We have <code class="language-plaintext highlighter-rouge">∅ ⊢ M ⦂ B</code>, <code class="language-plaintext highlighter-rouge">B &lt;: A</code>, and <code class="language-plaintext highlighter-rouge">M —→ N</code>. We apply the induction hypothesis
to obtain <code class="language-plaintext highlighter-rouge">∅ ⊢ N ⦂ B</code> and then subsumption to conclude that <code class="language-plaintext highlighter-rouge">∅ ⊢ N ⦂ A</code>.</p>
  </li>
</ul>

<h4 id="exercise-intrinsic-records-stretch">Exercise <code class="language-plaintext highlighter-rouge">intrinsic-records</code> (stretch)</h4>

<p>Formulate the language of this chapter, STLC with records, using
intrinsically typed terms. This requires taking an algorithmic approach
to the type system, which means that there is no subsumption rule and
instead subtyping is used in the elimination rules. For example,
the rule for function application would be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>_·_ : ∀ {Γ A B C}
  → Γ ⊢ A ⇒ B
  → Γ ⊢ C
  → C &lt;: A
    -------
  → Γ ⊢ B
</code></pre></div></div>

<h4 id="exercise-type-check-records-practice">Exercise <code class="language-plaintext highlighter-rouge">type-check-records</code> (practice)</h4>

<p>Write a recursive function whose input is a <code class="language-plaintext highlighter-rouge">Term</code> and whose output
is a typing derivation for that term, if one exists.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type-check : (M : Term) → (Γ : Context) → Maybe (Σ[ A ∈ Type ] Γ ⊢ M ⦂ A)
</code></pre></div></div>

<h4 id="exercise-variants-recommended">Exercise <code class="language-plaintext highlighter-rouge">variants</code> (recommended)</h4>

<p>Add variants to the language of this chapter and update the proofs of
progress and preservation. The variant type is a generalization of a
sum type, similar to the way the record type is a generalization of
product. The following summarizes the treatment of variants in the
book Types and Programming Languages. A variant type is traditionally
written:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>〈l₁:A₁, ..., lᵤ:Aᵤ〉
</code></pre></div></div>

<p>The term for introducing a variant is</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>〈l=t〉
</code></pre></div></div>

<p>and the term for eliminating a variant is</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case L of 〈l₁=x₁〉 ⇒ M₁ | ... | 〈lᵤ=xᵤ〉 ⇒ Mᵤ
</code></pre></div></div>

<p>The typing rules for these terms are</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(T-Variant)
Γ ⊢ Mⱼ : Aⱼ
---------------------------------
Γ ⊢ 〈lⱼ=Mⱼ〉 : 〈l₁=A₁, ... , lᵤ=Aᵤ〉


(T-Case)
Γ ⊢ L : 〈l₁=A₁, ... , lᵤ=Aᵤ〉
∀ i ∈ 1..u,   Γ,xᵢ:Aᵢ ⊢ Mᵢ : B
---------------------------------------------------
Γ ⊢ case L of 〈l₁=x₁〉 ⇒ M₁ | ... | 〈lᵤ=xᵤ〉 ⇒ Mᵤ  : B
</code></pre></div></div>

<p>The non-algorithmic subtyping rules for variants are</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(S-VariantWidth)
------------------------------------------------------------
〈l₁=A₁, ..., lᵤ=Aᵤ〉   &lt;:   〈l₁=A₁, ..., lᵤ=Aᵤ, ..., lᵤ₊ₓ=Aᵤ₊ₓ〉

(S-VariantDepth)
∀ i ∈ 1..u,    Aᵢ &lt;: Bᵢ
---------------------------------------------
〈l₁=A₁, ..., lᵤ=Aᵤ〉   &lt;:   〈l₁=B₁, ..., lᵤ=Bᵤ〉

(S-VariantPerm)
∀i∈1..u, ∃j∈1..u, kⱼ = lᵢ and Aⱼ = Bᵢ
----------------------------------------------
〈k₁=A₁, ..., kᵤ=Aᵤ〉   &lt;:   〈l₁=B₁, ..., lᵤ=Bᵤ〉
</code></pre></div></div>

<p>Come up with an algorithmic subtyping rule for variant types.</p>

<h4 id="exercise--alternative-stretch">Exercise <code class="language-plaintext highlighter-rouge">&lt;:-alternative</code> (stretch)</h4>

<p>Revise this formalization of records with subtyping (including proofs
of progress and preservation) to use the non-algorithmic subtyping
rules for Chapter 15 of Types and Programming Languages, which we list here:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(S-RcdWidth)
--------------------------------------------------------------
{ l₁:A₁, ..., lᵤ:Aᵤ, ..., lᵤ₊ₓ:Aᵤ₊ₓ } &lt;: { l₁:A₁, ..., lᵤ:Aᵤ }

(S-RcdDepth)
    ∀i∈1..u, Aᵢ &lt;: Bᵢ
----------------------------------------------
{ l₁:A₁, ..., lᵤ:Aᵤ } &lt;: { l₁:B₁, ..., lᵤ:Bᵤ }

(S-RcdPerm)
∀i∈1..u, ∃j∈1..u, kⱼ = lᵢ and Aⱼ = Bᵢ
----------------------------------------------
{ k₁:A₁, ..., kᵤ:Aᵤ } &lt;: { l₁:B₁, ..., lᵤ:Bᵤ }
</code></pre></div></div>

<p>You will most likely need to prove inversion lemmas for the subtype relation
of the form:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If S &lt;: T₁ ⇒ T₂, then S ≡ S₁ ⇒ S₂, T₁ &lt;: S₁, and S₂ &lt;: T₂, for some S₁, S₂.

If S &lt;: { lᵢ : Tᵢ | i ∈ 1..n }, then S ≡ { kⱼ : Sⱼ | j ∈ 1..m }
and { lᵢ | i ∈ 1..n } ⊆ { kⱼ | j ∈ 1..m }
and Sⱼ &lt;: Tᵢ for every i and j such that lᵢ = kⱼ.
</code></pre></div></div>

<h2 id="references">References</h2>

<ul>
  <li>
    <p>John C. Reynolds. Using Category Theory to Design Implicit
Conversions and Generic Operators.
In Semantics-Directed Compiler Generation, 1980.
LNCS Volume 94.</p>
  </li>
  <li>
    <p>Luca Cardelli. A semantics of multiple inheritance.  In Semantics of
Data Types, 1984. Springer.</p>
  </li>
  <li>
    <p>Barbara H. Liskov and Jeannette M. Wing.  A Behavioral Notion of
Subtyping. In ACM Trans. Program. Lang. Syst.  Volume 16, 1994.</p>
  </li>
  <li>
    <p>Types and Programming Languages. Benjamin C. Pierce. The MIT Press. 2002.</p>
  </li>
</ul>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/More/">Prev</a>
    
    
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/part2/Subtyping.lagda.md">Source</a>
    
    
    &bullet;
    
    
    <a alt="Next chapter" href="/Bisimulation/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jeremy G. Siek</li>
          <li><a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jsiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jsiek</span></a></li><li><a href="https://www.twitter.com/jeremysiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jeremysiek</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<script type="text/javascript">
     // Fix sandwich menu
     $('.menu-icon').click(function(){
         $('.trigger').toggle();
     });
    </script><!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha256-E4RlfxwyJVmkkk0szw7LYJxuPlp6evtPSBDlWHsYYL8=" crossorigin="anonymous"></script>
<script type="text/javascript">
 // Add anchors on DOMContentLoaded
 document.addEventListener('DOMContentLoaded', function(event) {
     anchors.add();
 });
</script>

<script type="text/javascript">
 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
