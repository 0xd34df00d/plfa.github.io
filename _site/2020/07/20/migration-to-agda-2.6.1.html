<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Migration to Agda 2.6.1 | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Migration to Agda 2.6.1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We upgraded to Agda 2.6.1 and version 1.3 of the standard library. If you want to continue working with the latest version of the book, you’ll have to update your versions locally. Please follow the instructions in Getting Started to reinstall Agda and the standard library." />
<meta property="og:description" content="We upgraded to Agda 2.6.1 and version 1.3 of the standard library. If you want to continue working with the latest version of the book, you’ll have to update your versions locally. Please follow the instructions in Getting Started to reinstall Agda and the standard library." />
<link rel="canonical" href="https://plfa.github.io/2020/07/20/migration-to-agda-2.6.1.html" />
<meta property="og:url" content="https://plfa.github.io/2020/07/20/migration-to-agda-2.6.1.html" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-20T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"We upgraded to Agda 2.6.1 and version 1.3 of the standard library. If you want to continue working with the latest version of the book, you’ll have to update your versions locally. Please follow the instructions in Getting Started to reinstall Agda and the standard library.","headline":"Migration to Agda 2.6.1","dateModified":"2020-07-20T00:00:00+00:00","datePublished":"2020-07-20T00:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://plfa.github.io/2020/07/20/migration-to-agda-2.6.1.html"},"url":"https://plfa.github.io/2020/07/20/migration-to-agda-2.6.1.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">The Book</a>
                <a class="page-link" href="/Announcements/">Announcements</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
                <a class="page-link" href="/Citing/">Citing</a>
                <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Migration to Agda 2.6.1</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-07-20T00:00:00+00:00" itemprop="datePublished">Jul 20, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>We upgraded to <a href="https://github.com/agda/agda/releases/tag/v2.6.1">Agda 2.6.1</a> and <a href="https://github.com/agda/agda-stdlib/releases/tag/v1.3">version 1.3 of the standard library</a>. If you want to continue working with the latest version of the book, you’ll have to update your versions locally. Please follow the instructions in <a href="/GettingStarted/">Getting Started</a> to reinstall Agda and the standard library.</p>

<!--more-->

<h3 id="changes-to-the-termination-checker">Changes to the termination checker</h3>

<p>Agda 2.6.1 made several <a href="https://github.com/agda/agda/blob/master/doc/release-notes/2.6.1.md#termination-checking">changes to the termination checker</a>. As a result of these changes, Agda is no longer able to see that our evaluation functions, e.g., in <a href="https://plfa.github.io/Properties/#31408">Properties</a>, are terminating. In response, we changed the definition of <code class="language-plaintext highlighter-rouge">Gas</code> to be a record type, rather than a data type:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- data Gas : Set where
-   gas : ℕ → Gas
</span><span class="gi">+ record Gas : Set where
+   constructor gas
+   field
+     amount : ℕ
</span></code></pre></div></div>

<p>The reason this works is that η-equality holds <em>by definition</em> for records. Agda uses this to see that unwrapping and rewrapping numbers as <code class="language-plaintext highlighter-rouge">Gas</code> is the identity, and hence the amount of gas is decreasing if that number is decreasing.</p>

<h3 id="changes-to-equational-reasoning">Changes to equational reasoning</h3>

<p>The function <code class="language-plaintext highlighter-rouge">_≡⟨_⟩_</code>, part of the equational reasoning syntax, was renamed to <code class="language-plaintext highlighter-rouge">step-≡</code>, for <a href="https://github.com/agda/agda-stdlib/blob/master/CHANGELOG/v1.3.md#changes-to-how-equational-reasoning-is-implemented">various reasons</a>. The new function has the same semantics, but flips the order of the arguments. This does not mean you have to change your equational reasoning proofs, as the module also defines a syntax macro, which recovers the original argument order:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infixr -2 step-≡

step-≡ : ∀ x {y z : A} → y ≡ z → x ≡ y → x ≡ z
step-≡ y≡z x≡y = trans x≡y y≡z

syntax step-≡ x y≡z x≡y = x ≡⟨ x≡y ⟩ y≡z
</code></pre></div></div>

<p>Syntax macros aren’t quite definitions in Agda, so you cannot import them by “name”. Instead, they’re imported together with the function for which they’re defined, i.e., as <code class="language-plaintext highlighter-rouge">step-≡</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- open Eq.≡-Reasoning using (begin_; _≡⟨⟩_; _≡⟨_⟩_; _∎)
</span><span class="gi">+ open Eq.≡-Reasoning using (begin_; _≡⟨⟩_; step-≡; _∎)
</span></code></pre></div></div>

<p>If you’d like more details, there’s a lot of discussion of why this change was made in the <a href="https://github.com/agda/agda-stdlib/blob/master/CHANGELOG/v1.3.md#changes-to-how-equational-reasoning-is-implemented">CHANGELOG</a>. For PLFA, we make a note of the incongruence in the chapter on <a href="https://plfa.github.io/Equality/#standard-library">Equality</a>, but leave our definitions of equational reasoning unchanged.</p>

<h3 id="deprecation-of-datalistallany">Deprecation of <code class="language-plaintext highlighter-rouge">Data.List.{All,Any}</code></h3>

<p>The modules <code class="language-plaintext highlighter-rouge">Data.List.{All,Any}</code> were deprecated in v1.0,
and were moved to <code class="language-plaintext highlighter-rouge">Data.List.Relation.Unary.{All,Any}</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- import Data.List.All using (All; []; _∷_)
- import Data.List.Any using (Any; here; there)
</span><span class="gi">+ import Data.List.Relation.Unary.All using (All; []; _∷_)
+ import Data.List.Relation.Unary.Any using (Any; here; there)
</span></code></pre></div></div>

  </div><a class="u-url" href="/2020/07/20/migration-to-agda-2.6.1.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jeremy G. Siek</li>
          <li><a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jsiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jsiek</span></a></li><li><a href="https://www.twitter.com/jeremysiek"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jeremysiek</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<script type="text/javascript">
     // Fix sandwich menu
     $('.menu-icon').click(function(){
         $('.trigger').toggle();
     });
    </script><!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha256-E4RlfxwyJVmkkk0szw7LYJxuPlp6evtPSBDlWHsYYL8=" crossorigin="anonymous"></script>
<script type="text/javascript">
 // Add anchors on DOMContentLoaded
 document.addEventListener('DOMContentLoaded', function(event) {
     anchors.add();
 });
</script>

<script type="text/javascript">
 // Script which allows for foldable code blocks
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
